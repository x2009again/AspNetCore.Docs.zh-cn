<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#30417;&#35270;&#21644;&#35843;&#35797; - &#36890;&#36807; ASP.NET Core &#21644; Azure &#23454;&#29616; DevOps </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#30417;&#35270;&#21644;&#35843;&#35797; - &#36890;&#36807; ASP.NET Core &#21644; Azure &#23454;&#29616; DevOps ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="azure/devops/monitor">
<h1 id="monitor-and-debug">监视和调试</h1>

<p>部署了应用并构建了 DevOps 管道后，必须了解如何对应用进行监视和故障排除。</p>
<p>在本部分中，你将完成以下任务：</p>
<ul>
<li>在 Azure 门户中查找基本监视和故障排除数据</li>
<li>了解如何通过 Azure Monitor 更深入地了解所有 Azure 服务中的指标</li>
<li>将 Web 应用与 Application Insights 连接以进行应用分析</li>
<li>打开日志记录并了解在何处下载日志</li>
<li>实时流式传输日志</li>
<li>了解在何处设置警报</li>
<li>了解远程调试 Azure 应用服务 Web 应用。</li>
</ul>
<h2 id="basic-monitoring-and-troubleshooting">基本监视和故障排除</h2>
<p>应用服务 Web 应用可轻松地实时进行监视。 Azure 门户在易于理解的图表和图形中呈现指标。</p>
<ol>
<li><p>打开 <a href="https://portal.azure.com">Azure 门户</a>，然后导航到 mywebapp&lt;unique_number&gt; 应用服务。</p>
</li>
<li><p>“概览”选项卡显示有用的“一览式”信息，其中包括显示最近指标的图形。</p>
<p><img src="./media/monitoring/overview.png" alt="显示概览面板的屏幕截图"></p>
<ul>
<li>Http 5xx：服务器端错误计数，通常是 ASP.NET Core 代码中的异常。</li>
<li><strong>数据输入</strong>：进入 Web 应用的数据流入量。</li>
<li><strong>数据输出</strong>：从 Web 应用到客户端的数据流出量。</li>
<li><strong>请求</strong>：HTTP 请求计数。</li>
<li><strong>平均响应时间</strong>：Web 应用响应 HTTP 请求的平均时间。</li>
</ul>
<p>此页面还提供一些用于故障排除和优化的自助服务工具。</p>
<p><img src="./media/monitoring/wizards.png" alt="显示自助服务工具的屏幕截图"></p>
<ul>
<li>“诊断并解决问题”是一种自助服务故障排除程序。</li>
<li>Application Insights 用于分析性能和应用行为，会在此部分后面进行讨论。</li>
<li>“应用服务顾问”为优化应用体验提供建议。</li>
</ul>
</li>
</ol>
<h2 id="advanced-monitoring">高级监视</h2>
<p><a href="/azure/monitoring-and-diagnostics/">Azure Monitor</a> 是一种用于在 Azure 服务间监视所有指标和设置警报的集中服务。 在 Azure Monitor 中，管理员可以精细地跟踪性能和确定趋势。 每个 Azure 服务都向 Azure Monitor 提供自己的<a href="/azure/monitoring-and-diagnostics/monitoring-supported-metrics#microsoftwebsites-excluding-functions">指标集</a>。</p>
<h2 id="profile-with-application-insights">使用 Application Insights 进行分析</h2>
<p><a href="/azure/application-insights/app-insights-overview">Application Insights</a> 是一种 Azure 服务，用于分析 Web 应用的性能和稳定性以及用户使用它们的方式。 Application Insights 中的数据比 Azure Monitor 更广泛且更深入。 数据可以为开发者和管理员提供重要信息来改善应用。 Application Insights 可以添加到 Azure 应用服务资源，而无需更改代码。</p>
<ol>
<li><p>打开 <a href="https://portal.azure.com">Azure 门户</a>，然后导航到 mywebapp&lt;unique_number&gt; 应用服务。</p>
</li>
<li><p>在“概览”选项卡上，单击“Application Insights”磁贴。</p>
<p><img src="./media/monitoring/app-insights.png" alt="Application Insights 磁贴"></p>
</li>
<li><p>选择“新建资源”单选按钮。 使用默认资源名称，并选择 Application Insights 资源的位置。 该位置不需要与 Web 应用的位置匹配。</p>
<p><img src="./media/monitoring/new-app-insights.png" alt="Application Insights 设置"></p>
</li>
<li><p>对于“运行时/框架”，选择“ASP.NET Core”。 接受默认设置。</p>
</li>
<li><p>选择“确定”。 如果系统提示进行确认，请选择“继续”。</p>
</li>
<li><p>创建资源之后，单击 Application Insights 资源的名称，直接导航到 Application Insights 页面。</p>
<p><img src="./media/monitoring/new-app-insights-done.png" alt="新 Application Insights 资源已准备就绪"></p>
</li>
</ol>
<p>使用应用时，数据会累积。 选择“刷新”以使用新数据重载边栏选项卡。</p>
<p><img src="./media/monitoring/app-insights-overview.png" alt="Application Insights 概览选项卡"></p>
<p>Application Insights 可提供有用的服务器端信息，无需额外配置。 若要从 Application Insights 获得最大价值，请<a href="/azure/application-insights/app-insights-asp-net-core">通过 Application Insights SDK 检测应用</a>。 正确配置后，该服务会在 Web 服务器和浏览器中提供端到端监视，包括客户端性能。 有关详细信息，请参阅 <a href="/azure/application-insights/app-insights-overview">Application Insights 文档</a>。</p>
<h2 id="logging">Logging</h2>
<p>默认情况下，Web 服务器和应用日志在 Azure 应用服务中处于禁用状态。 可通过以下步骤启用日志：</p>
<ol>
<li><p>打开 <a href="https://portal.azure.com">Azure 门户</a>，然后导航到 mywebapp&lt;unique_number&gt; 应用服务。</p>
</li>
<li><p>在左侧菜单中，向下滚动到“监视”部分。 选择“诊断日志”。</p>
<p><img src="./media/monitoring/logging.png" alt="诊断日志链接"></p>
</li>
<li><p>打开“应用程序日志记录(文件系统)”。 如果出现提示，请单击框来安装扩展，以在 Web 应用中启用应用日志记录。</p>
</li>
<li><p>将“Web 服务器日志记录”设置为“文件系统”。</p>
</li>
<li><p>输入“保留期”（以天为单位）。 例如 30。</p>
</li>
<li><p>单击“保存”  。</p>
</li>
</ol>
<p>会为 Web 应用生成 ASP.NET Core 和 Web 服务器（应用服务）日志。 可以使用显示的 FTP/FTPS 信息下载它们。 密码与本指南前面部分中创建的部署凭据相同。 日志可以<a href="/azure/app-service/web-sites-enable-diagnostic-log#download">通过 PowerShell 或 Azure CLI 直接流式传输到本地计算机</a>。 也可以<a href="/azure/app-service/web-sites-enable-diagnostic-log#how-to-view-logs-in-application-insights">在 Application Insights 中查看</a>日志。</p>
<h2 id="log-streaming">日志流式处理</h2>
<p>应用和 Web 服务器日志可以通过门户实时流式传输。</p>
<ol>
<li><p>打开 <a href="https://portal.azure.com">Azure 门户</a>，然后导航到 mywebapp&lt;unique_number&gt; 应用服务。</p>
</li>
<li><p>在左侧菜单中，向下滚动到“监视”部分并选择“日志流”。</p>
<p><img src="./media/monitoring/log-stream.png" alt="显示日志流链接的屏幕截图"></p>
</li>
</ol>
<p>也可以通过 <a href="/azure/app-service/web-sites-enable-diagnostic-log#streamlogs">Azure CLI 或 Azure PowerShell 流式传输</a>日志（包括通过 Cloud Shell）。</p>
<h2 id="alerts">警报</h2>
<p>Azure Monitor 还会基于指标、管理事件和其他条件提供<a href="/azure/monitoring-and-diagnostics/insights-alerts-portal">实时警报</a>。</p>
<blockquote>
<p><em>注意：当前仅在警报（经典）服务中提供有关 Web 应用指标的警报。</em></p>
</blockquote>
<p><a href="/azure/monitoring-and-diagnostics/monitor-quick-resource-metric-alert-portal">警报（经典）服务</a>可以在 Azure Monitor 或是应用服务设置的“监视”部分下找到。</p>
<p><img src="./media/monitoring/alerts.png" alt="警报（经典）链接"></p>
<h2 id="live-debugging">实时调试</h2>
<p>当日志未提供足够信息时，可以通过 <a href="/azure/app-service/web-sites-dotnet-troubleshoot-visual-studio#remotedebug">Visual Studio 远程调试</a> Azure 应用服务。 但是，远程调试需要使用调试符号编译应用。 除非万不得已，否则不应在生产中进行调试。</p>
<h2 id="conclusion">结束语</h2>
<p>在此部分中，已完成以下任务：</p>
<ul>
<li>在 Azure 门户中查找基本监视和故障排除数据</li>
<li>了解如何通过 Azure Monitor 更深入地了解所有 Azure 服务中的指标</li>
<li>将 Web 应用与 Application Insights 连接以进行应用分析</li>
<li>打开日志记录并了解在何处下载日志</li>
<li>实时流式传输日志</li>
<li>了解在何处设置警报</li>
<li>了解远程调试 Azure 应用服务 Web 应用。</li>
</ul>
<h2 id="additional-reading">其他阅读材料</h2>
<ul>
<li><a class="xref" href="../../test/troubleshoot-azure-iis.html">对 Azure 应用服务和 IIS 上的 ASP.NET Core 进行故障排除</a></li>
<li><a class="xref" href="../../host-and-deploy/azure-iis-errors-reference.html">Azure 应用服务和 IIS 上 ASP.NET Core 的常见错误参考</a></li>
<li><a href="/azure/application-insights/app-insights-azure-web-apps">使用 Application Insights 监视 Azure Web 应用性能</a></li>
<li><a href="/azure/app-service/web-sites-enable-diagnostic-log">在 Azure 应用服务中为应用启用诊断日志记录</a></li>
<li><a href="/azure/app-service/web-sites-dotnet-troubleshoot-visual-studio">使用 Visual Studio 对 Azure 应用服务中的 Web 应用进行故障排除</a></li>
<li><a href="/azure/monitoring-and-diagnostics/insights-alerts-portal">在 Azure Monitor 中为 Azure 服务创建经典指标警报 - Azure 门户</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
