<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>IIS &#27169;&#22359;&#19982; ASP.NET Core </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="IIS &#27169;&#22359;&#19982; ASP.NET Core ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="host-and-deploy/iis/modules">
<h1 id="iis-modules-with-aspnet-core">IIS 模块与 ASP.NET Core</h1>

<p>某些本机 IIS 模块和所有 IIS 托管模块无法处理 ASP.NET Core 应用的请求。 在许多情况下，ASP.NET Core 提供了 IIS 本机和托管模块解决的方案的替代方案。</p>
<h2 id="native-modules">本机模块</h2>
<p>该表指示在使用 ASP.NET Core 应用和 ASP.NET Core 模块时正常工作的本机 IIS 模块。</p>
<table>
<thead>
<tr>
<th>模块</th>
<th style="text-align: center;">在 ASP.NET Core 应用内可用</th>
<th>ASP.NET Core 选项</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>匿名身份验证</strong><br><code>AnonymousAuthenticationModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>基本身份验证</strong><br><code>BasicAuthenticationModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>客户端证书映射身份验证</strong><br><code>CertificateMappingAuthenticationModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>CGI</strong><br><code>CgiModule</code></td>
<td style="text-align: center;">否</td>
<td></td>
</tr>
<tr>
<td><strong>配置验证</strong><br><code>ConfigurationValidationModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>HTTP 错误</strong><br><code>CustomErrorModule</code></td>
<td style="text-align: center;">否</td>
<td><a class="xref" href="../../fundamentals/error-handling.html#usestatuscodepages">状态代码页中间件</a></td>
</tr>
<tr>
<td><strong>自定义日志记录</strong><br><code>CustomLoggingModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>默认文档</strong><br><code>DefaultDocumentModule</code></td>
<td style="text-align: center;">否</td>
<td><a class="xref" href="../../fundamentals/static-files.html#serve-a-default-document">默认文件中间件</a></td>
</tr>
<tr>
<td><strong>摘要式身份验证</strong><br><code>DigestAuthenticationModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>目录浏览</strong><br><code>DirectoryListingModule</code></td>
<td style="text-align: center;">否</td>
<td><a class="xref" href="../../fundamentals/static-files.html#enable-directory-browsing">目录浏览中间件</a></td>
</tr>
<tr>
<td><strong>动态压缩</strong><br><code>DynamicCompressionModule</code></td>
<td style="text-align: center;">是</td>
<td><a class="xref" href="../../performance/response-compression.html">响应压缩中间件</a></td>
</tr>
<tr>
<td><strong>请求跟踪失败</strong><br><code>FailedRequestsTracingModule</code></td>
<td style="text-align: center;">是</td>
<td><a class="xref" href="../../fundamentals/logging/index.html#tracesource-provider">ASP.NET Core 日志记录</a></td>
</tr>
<tr>
<td><strong>文件缓存</strong><br><code>FileCacheModule</code></td>
<td style="text-align: center;">否</td>
<td><a class="xref" href="../../performance/caching/middleware.html">响应缓存中间件</a></td>
</tr>
<tr>
<td><strong>HTTP 缓存</strong><br><code>HttpCacheModule</code></td>
<td style="text-align: center;">否</td>
<td><a class="xref" href="../../performance/caching/middleware.html">响应缓存中间件</a></td>
</tr>
<tr>
<td><strong>HTTP 日志记录</strong><br><code>HttpLoggingModule</code></td>
<td style="text-align: center;">是</td>
<td><a class="xref" href="../../fundamentals/logging/index.html">ASP.NET Core 日志记录</a></td>
</tr>
<tr>
<td><strong>HTTP 重定向</strong><br><code>HttpRedirectionModule</code></td>
<td style="text-align: center;">是</td>
<td><a class="xref" href="../../fundamentals/url-rewriting.html">URL 重写中间件</a></td>
</tr>
<tr>
<td><strong>HTTP 跟踪</strong><br><code>TracingModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>IIS 客户端证书映射身份验证</strong><br><code>IISCertificateMappingAuthenticationModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>IP 和域限制</strong><br><code>IpRestrictionModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>ISAPI 筛选器</strong><br><code>IsapiFilterModule</code></td>
<td style="text-align: center;">是</td>
<td><a class="xref" href="../../fundamentals/middleware/index.html">中间件</a></td>
</tr>
<tr>
<td><strong>ISAPI</strong><br><code>IsapiModule</code></td>
<td style="text-align: center;">是</td>
<td><a class="xref" href="../../fundamentals/middleware/index.html">中间件</a></td>
</tr>
<tr>
<td><strong>协议支持</strong><br><code>ProtocolSupportModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>请求筛选</strong><br><code>RequestFilteringModule</code></td>
<td style="text-align: center;">是</td>
<td><a class="xref" href="../../fundamentals/url-rewriting.html#irule-based-rule">URL 重写中间件<code>IRule</code></a></td>
</tr>
<tr>
<td><strong>请求监视器</strong><br><code>RequestMonitorModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>URL 重写</strong>&amp;#8224；<br><code>RewriteModule</code></td>
<td style="text-align: center;">是</td>
<td><a class="xref" href="../../fundamentals/url-rewriting.html">URL 重写中间件</a></td>
</tr>
<tr>
<td><strong>服务器端包括</strong><br><code>ServerSideIncludeModule</code></td>
<td style="text-align: center;">否</td>
<td></td>
</tr>
<tr>
<td><strong>静态压缩</strong><br><code>StaticCompressionModule</code></td>
<td style="text-align: center;">否</td>
<td><a class="xref" href="../../performance/response-compression.html">响应压缩中间件</a></td>
</tr>
<tr>
<td><strong>静态内容</strong><br><code>StaticFileModule</code></td>
<td style="text-align: center;">否</td>
<td><a class="xref" href="../../fundamentals/static-files.html">静态文件中间件</a></td>
</tr>
<tr>
<td><strong>令牌缓存</strong><br><code>TokenCacheModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>URI 缓存</strong><br><code>UriCacheModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
<tr>
<td><strong>URL 授权</strong><br><code>UrlAuthorizationModule</code></td>
<td style="text-align: center;">是</td>
<td><a class="xref" href="../../security/authentication/identity.html">ASP.NET Core Identity</a></td>
</tr>
<tr>
<td><strong>Windows 身份验证</strong><br><code>WindowsAuthenticationModule</code></td>
<td style="text-align: center;">是</td>
<td></td>
</tr>
</tbody>
</table>
<p>†由于<a class="xref" href="../directory-structure.html">目录结构</a>中的更改，URL 重写模块的 <code>isFile</code> 和 <code>isDirectory</code> 匹配类型不适用于 ASP.NET Core 应用。</p>
<h2 id="managed-modules">托管模块</h2>
<p>当应用池的 .NET CLR 版本设置为“无托管代码”时，托管 ASP.NET Core 应用的托管模块无法使用。 ASP.NET Core 在几种情况下提供了中间件替代方案。</p>
<table>
<thead>
<tr>
<th>模块</th>
<th>ASP.NET Core 选项</th>
</tr>
</thead>
<tbody>
<tr>
<td>AnonymousIdentification</td>
<td></td>
</tr>
<tr>
<td>DefaultAuthentication</td>
<td></td>
</tr>
<tr>
<td>FileAuthorization</td>
<td></td>
</tr>
<tr>
<td>FormsAuthentication</td>
<td><a class="xref" href="../../security/authentication/cookie.html">Cookie 身份验证中间件</a></td>
</tr>
<tr>
<td>OutputCache</td>
<td><a class="xref" href="../../performance/caching/middleware.html">响应缓存中间件</a></td>
</tr>
<tr>
<td>配置文件</td>
<td></td>
</tr>
<tr>
<td>RoleManager</td>
<td></td>
</tr>
<tr>
<td>ScriptModule-4.0</td>
<td></td>
</tr>
<tr>
<td>会话</td>
<td><a class="xref" href="../../fundamentals/app-state.html">会话中间件</a></td>
</tr>
<tr>
<td>UrlAuthorization</td>
<td></td>
</tr>
<tr>
<td>UrlMappingsModule</td>
<td><a class="xref" href="../../fundamentals/url-rewriting.html">URL 重写中间件</a></td>
</tr>
<tr>
<td>UrlRoutingModule-4.0</td>
<td><a class="xref" href="../../security/authentication/identity.html">ASP.NET Core Identity</a></td>
</tr>
<tr>
<td>WindowsAuthentication</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="iis-manager-application-changes">IIS 管理器应用程序更改</h2>
<p>使用 IIS 管理器配置设置时，应用的 web.config 文件已更改。 如果部署应用并包括 web.config，则使用 IIS 管理器所做的任何更改都会被部署的 web.config 文件覆盖。 如果更改服务器的 web.config 文件，请立即将服务器上已更新的 web.config 文件复制到本地项目。</p>
<h2 id="disabling-iis-modules">禁用 IIS 模块</h2>
<p>如果在服务器级别配置了必须为应用禁用的 IIS 模块，则应用 web.config 文件还可以禁用该模块。 将模块留在原位并使用配置设置（如果可用）将其停用或从应用中移除模块。</p>
<h3 id="module-deactivation">模块停用</h3>
<p>许多模块提供一个配置设置，允许在不从应用中删除模块的情况下禁用它们。 这是停用模块最简单、快捷的方式。 例如，可使用 web.config 中的 <code>&lt;httpRedirect&gt;</code> 元素禁用 HTTP 重定向模块：</p>
<pre><code class="lang-xml">&lt;configuration&gt;
  &lt;system.webServer&gt;
    &lt;httpRedirect enabled=&quot;false&quot; /&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre>
<p>有关通过配置设置禁用模块的详细信息，请按照 <a href="/iis/configuration/system.webServer/">IIS &lt;system.webServer&gt;</a> 的“子元素”部分中的链接进行操作。</p>
<h3 id="module-removal">模块删除</h3>
<p>如果选择使用 web.config 中的设置删除模块，请先解锁此模块和 web.config 的 <code>&lt;modules&gt;</code> 部分 ：</p>
<ol>
<li><p>解锁服务器级别的模块。 在 IIS 管理器“连接”边栏中选择 IIS 服务器。 打开 IIS 区域中的模块。 在列表中选择该模块。 在右侧的“操作”边栏中，选择“解锁”。 如果该模块的操作条目显示为“锁定”，则该模块已被解锁，且无需任何操作。 解锁尽可能多稍后计划从 web.config 中删除的模块。</p>
</li>
<li><p>在不使用 web.config 的 <code>&lt;modules&gt;</code> 部分的情况下部署应用。如果使用包含 <code>&lt;modules&gt;</code> 部分的 web.config 部署应用，但未先在 IIS 管理器中解锁该部分，则配置管理器会在尝试解锁该部分时引发异常。 因此，请在不使用 <code>&lt;modules&gt;</code> 部分的情况下部署该应用。</p>
</li>
<li><p>解锁 web.config 的 <code>&lt;modules&gt;</code> 部分。在“连接”边栏中，选择“站点”中的网站。 在“管理”区域中，打开“配置编辑器”。 使用导航控件选择 <code>system.webServer/modules</code> 部分。 在右侧的“操作”边栏中，选择“解锁”该部分。 如果该模块的操作条目显示为“锁定部分”，则该模块已被解锁，且无需任何操作。</p>
</li>
<li><p>可使用 <code>&lt;remove&gt;</code> 元素将 <code>&lt;modules&gt;</code> 部分添加到应用的本地 web.config 文件，从应用中删除模块。 可添加多个 <code>&lt;remove&gt;</code> 元素来删除多个模块。 如果在服务器上更改 web.config，请立即在本地对项目的 web.config 文件执行相同的更改。 以这种方式删除模块不会影响模块的使用与服务器上的其他应用。</p>
<pre><code class="lang-xml">&lt;configuration&gt;
 &lt;system.webServer&gt;
   &lt;modules&gt;
     &lt;remove name=&quot;MODULE_NAME&quot; /&gt;
   &lt;/modules&gt;
 &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre>
</li>
</ol>
<p>要使用 web.config 为 IIS Express 添加或删除模块，请修改 applicationHost.config 以解锁 <code>&lt;modules&gt;</code> 部分 ：</p>
<ol>
<li><p>打开 {APPLICATION ROOT}\.vs\config\applicationhost.config。</p>
</li>
<li><p>找到 IIS 模块的 <code>&lt;section&gt;</code> 元素，并将 <code>overrideModeDefault</code> 从 <code>Deny</code> 更改为 <code>Allow</code>：</p>
<pre><code class="lang-xml">&lt;section name=&quot;modules&quot;
         allowDefinition=&quot;MachineToApplication&quot;
         overrideModeDefault=&quot;Allow&quot; /&gt;
</code></pre>
</li>
<li><p>找到 <code>&lt;location path=&quot;&quot; overrideMode=&quot;Allow&quot;&gt;&lt;system.webServer&gt;&lt;modules&gt;</code> 部分。 对于任何要删除的模块，请将 <code>lockItem</code> 从 <code>true</code> 设置为 <code>false</code>。 在以下示例中，已解锁 CGI 模块：</p>
<pre><code class="lang-xml">&lt;add name=&quot;CgiModule&quot; lockItem=&quot;false&quot; /&gt;
</code></pre>
</li>
<li><p>解锁 <code>&lt;modules&gt;</code> 部分和单个模块后，可使用应用的 web.config 文件添加或删除 IIS 模块，以便在 IIS Express 上运行应用。</p>
</li>
</ol>
<p>IIS 模块还可以使用 Appcmd.exe 删除。 该命令中提供 <code>MODULE_NAME</code> 和 <code>APPLICATION_NAME</code>：</p>
<pre><code class="lang-console">Appcmd.exe delete module MODULE_NAME /app.name:APPLICATION_NAME
</code></pre>
<p>例如，从默认网站中删除 <code>DynamicCompressionModule</code>：</p>
<pre><code class="lang-console">%windir%\system32\inetsrv\appcmd.exe delete module DynamicCompressionModule /app.name:&quot;Default Web Site&quot;
</code></pre>
<h2 id="minimum-module-configuration">最小模块配置</h2>
<p>要求运行 ASP.NET Core 应用的模块只有匿名身份验证模块和 ASP.NET Core 模块。</p>
<p>URI 缓存模块 (<code>UriCacheModule</code>) 允许 IIS 在 URL 级别缓存网站配置。 不使用此模块的话，即使重复请求相同的 URL，IIS 也必须读取并分析每个请求的配置。 分析每个请求的配置会导致严重的性能损失。 虽然托管的 ASP.NET Core 应用并非严格要求运行 URI 缓存模块，但我们建议为所有 ASP.NET Core 部署启用 URI 缓存模块。</p>
<p>HTTP 缓存模块 (<code>HttpCacheModule</code>) 实现 IIS 输出缓存以及用于在 HTTP.sys 缓存中缓存项目的逻辑。 如果不使用此模块，内容不再以内核模式缓存，并且缓存配置文件将被忽略。 删除 HTTP 缓存模块通常会对性能和资源使用情况产生不利影响。 虽然托管的 ASP.NET Core 应用程序并非严格要求运行 HTTP 缓存模块，但我们建议为所有 ASP.NET Core 部署启用 HTTP 缓存模块。</p>
<h2 id="additional-resources">其他资源</h2>
<ul>
<li><a href="/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#modules-in-iis">IIS 体系结构简介：IIS 中的模块</a></li>
<li><a href="/iis/get-started/introduction-to-iis/iis-modules-overview">IIS 模块概述</a></li>
<li><a href="/previous-versions/tn-archive/cc627313(v=technet.10)">自定义 IIS 7.0 角色和模块</a></li>
<li><a href="/iis/configuration/system.webServer/">IIS &lt;system.webServer&gt;</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
