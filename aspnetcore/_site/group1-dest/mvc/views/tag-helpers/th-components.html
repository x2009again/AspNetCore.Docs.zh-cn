<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ASP.NET Core &#20013;&#30340;&#26631;&#35760;&#24110;&#21161;&#31243;&#24207;&#32452;&#20214; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ASP.NET Core &#20013;&#30340;&#26631;&#35760;&#24110;&#21161;&#31243;&#24207;&#32452;&#20214; ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="mvc/views/tag-helpers/th-components">
<h1 id="tag-helper-components-in-aspnet-core">ASP.NET Core 中的标记帮助程序组件</h1>

<p>作者：<a href="https://twitter.com/Scott_Addie">Scott Addie</a> 和 <a href="https://github.com/fiyazbinhasan">Fiyaz Bin Hasan</a></p>
<p>标记帮助程序组件是可用于有条件地修改或添加服务器端代码中的 HTML 元素的标记帮助程序。 ASP.NET Core 2.0 或更高版本中提供了此功能。</p>
<p>ASP.NET Core 包括两个内置标记帮助程序组件：<code>head</code> 和 <code>body</code>。 它们位于 &lt;xref:Microsoft.AspNetCore.Mvc.Razor.TagHelpers&gt; 命名空间中，并且可在 MVC 和页面中使用 Razor 。 标记帮助程序组件不需要在 <em>_ViewImports.cshtml</em> 中注册应用。</p>
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/mvc/views/tag-helpers/th-components/samples">查看或下载示例代码</a>（<a class="xref" href="../../../introduction-to-aspnet-core.html#how-to-download-a-sample">如何下载</a>）</p>
<h2 id="use-cases">用例</h2>
<p>标记帮助程序组件的两个常见用例包括：</p>
<ol>
<li><a href="#inject-into-html-head-element">将 <code>&lt;link&gt;</code> 插入 <code>&lt;head&gt;</code> 。</a></li>
<li><a href="#inject-into-html-body-element">将 <code>&lt;script&gt;</code> 插入 <code>&lt;body&gt;</code> 。</a></li>
</ol>
<p>以下各节介绍了这些用例。</p>
<h3 id="inject-into-html-head-element">注入到 HTML head 元素中</h3>
<p>在 HTML <code>&lt;head&gt;</code> 元素中，通常使用 HTML <code>&lt;link&gt;</code> 元素导入 CSS 文件。 以下代码使用 <code>head</code> 标记帮助程序组件将 <code>&lt;link&gt;</code> 元素注入到 <code>&lt;head&gt;</code> 元素中：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>在上述代码中：</p>
<ul>
<li><code>AddressStyleTagHelperComponent</code> 可实现 &lt;xref:Microsoft.AspNetCore.Razor.TagHelpers.TagHelperComponent&gt;。 抽象：
<ul>
<li>允许初始化带有 &lt;xref:Microsoft.AspNetCore.Razor.TagHelpers.TagHelperContext&gt; 的类。</li>
<li>启用标记帮助程序组件以添加或修改 HTML 元素。</li>
</ul>
</li>
<li>&lt;xref:Microsoft.AspNetCore.Razor.TagHelpers.TagHelperComponent.Order*&gt; 属性可定义呈现组件的顺序。 应用中的标记帮助程序组件有多种用法时，<code>Order</code> 是必需的。</li>
<li>&lt;xref:Microsoft.AspNetCore.Razor.TagHelpers.TagHelperComponent.ProcessAsync*&gt; 会将执行上下文的 &lt;xref:Microsoft.AspNetCore.Razor.TagHelpers.TagHelperContext.TagName*&gt; 属性值与 <code>head</code> 进行比较。 如果比较的计算结果为 true，则 <code>_style</code> 字段的内容将注入到 HTML <code>&lt;head&gt;</code> 元素中。</li>
</ul>
<h3 id="inject-into-html-body-element">注入到 HTML body 元素中</h3>
<p><code>body</code> 标记帮助程序组件可以将 <code>&lt;script&gt;</code> 元素注入到 <code>&lt;body&gt;</code> 元素中。 以下代码演示了此项技术：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>单独的 HTML 文件用于存储 <code>&lt;script&gt;</code> 元素。 HTML 文件使代码更清洁且更易于维护。 上述代码可读取 <em>TagHelpers/Templates/AddressToolTipScript.html</em> 的内容并将其追加到标记帮助程序输出中。 <em>AddressToolTipScript.html</em> 文件包括以下标记：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>上述代码可将<a href="https://getbootstrap.com/docs/3.3/javascript/#tooltips">启动工具提示小组件</a>绑定到包含 <code>printable</code> 属性的任何 <code>&lt;address&gt;</code> 元素。 当鼠标指针悬停在元素上时，可以显示效果。</p>
<h2 id="register-a-component">注册组件</h2>
<p>标记帮助程序组件必须添加到应用的标记帮助程序组件集合。 有以下三种方法可添加到集合：</p>
<ul>
<li><a href="#registration-via-services-container">通过服务容器注册</a></li>
<li><a href="#registration-via-razor-file">通过 Razor 文件注册</a></li>
<li><a href="#registration-via-page-model-or-controller">通过页面模型或控制器注册</a></li>
</ul>
<h3 id="registration-via-services-container">通过服务容器注册</h3>
<p>如果未使用 &lt;xref:Microsoft.AspNetCore.Mvc.Razor.TagHelpers.ITagHelperComponentManager&gt; 管理标记帮助程序组件类，则必须向<a class="xref" href="../../../fundamentals/dependency-injection.html">依赖关系注入 (DI)</a> 系统注册。 以下 <code>Startup.ConfigureServices</code> 代码可注册带有<a class="xref" href="../../../fundamentals/dependency-injection.html#lifetime-and-registration-options">瞬态生存期</a>的 <code>AddressStyleTagHelperComponent</code> 和 <code>AddressScriptTagHelperComponent</code> 类:</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><h3 id="registration-via-no-locrazor-file">通过 Razor 文件注册</h3>
<p>如果标记帮助程序组件未使用 DI 注册，则可以从 Razor 页面页或 MVC 视图注册。 此方法用于控制来自文件的注入标记和组件执行顺序 Razor 。</p>
<p><code>ITagHelperComponentManager</code> 用于添加标记帮助程序组件或从应用中删除这些组件。 以下代码演示了使用 <code>AddressTagHelperComponent</code> 的此项技术：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>在上述代码中：</p>
<ul>
<li><code>@inject</code> 指令提供了 <code>ITagHelperComponentManager</code> 的实例。 在文件中，将实例分配给一个名 <code>manager</code> 为的用于访问的变量 Razor 。</li>
<li><code>AddressTagHelperComponent</code> 的实例将添加到应用的标记帮助程序组件集合。</li>
</ul>
<p>修改 <code>AddressTagHelperComponent</code> 以适应接受 <code>markup</code> 和 <code>order</code> 参数的构造函数：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>提供的 <code>markup</code> 参数用于 <code>ProcessAsync</code>，如下所示：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><h3 id="registration-via-page-model-or-controller">通过页面模型或控制器注册</h3>
<p>如果标记帮助程序组件未使用 DI 注册，则可以从 Razor 页面模型或 MVC 控制器注册它。 此方法可用于分隔文件中的 c # 逻辑 Razor 。</p>
<p>构造函数注入用于访问 <code>ITagHelperComponentManager</code> 的实例。 标记帮助程序组件将添加到该实例的标记帮助程序组件集合。 以下 Razor 页面模型演示了此方法 <code>AddressTagHelperComponent</code> ：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>在上述代码中：</p>
<ul>
<li>构造函数注入用于访问 <code>ITagHelperComponentManager</code> 的实例。</li>
<li><code>AddressTagHelperComponent</code> 的实例将添加到应用的标记帮助程序组件集合。</li>
</ul>
<h2 id="create-a-component">创建组件</h2>
<p>创建自定义标记帮助程序组件：</p>
<ul>
<li>创建派生自 &lt;xref:Microsoft.AspNetCore.Mvc.Razor.TagHelpers.TagHelperComponentTagHelper&gt; 的公共类。</li>
<li>将特性应用于 <a href="xref:Microsoft.AspNetCore.Razor.TagHelpers.HtmlTargetElementAttribute"><code>[HtmlTargetElement]</code></a> 类。 指定目标 HTML 元素的名称。</li>
<li><em>可选</em> ：将特性应用于 <a href="xref:System.ComponentModel.EditorBrowsableAttribute"><code>[EditorBrowsable(EditorBrowsableState.Never)]</code></a> 类，以在 IntelliSense 中取消显示该类型的显示内容。</li>
</ul>
<p>以下代码可创建面向 <code>&lt;address&gt;</code> HTML 元素的自定义标记帮助程序组件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>按如下所示使用自定义 <code>address</code> 标记帮助程序组件注入 HTML 标记：</p>
<pre><code class="lang-csharp">public class AddressTagHelperComponent : TagHelperComponent
{
    private readonly string _printableButton =
        &quot;&lt;button type='button' class='btn btn-info' onclick=\&quot;window.open(&quot; +
        &quot;'https://binged.it/2AXRRYw')\&quot;&gt;&quot; +
        &quot;&lt;span class='glyphicon glyphicon-road' aria-hidden='true'&gt;&lt;/span&gt;&quot; +
        &quot;&lt;/button&gt;&quot;;

    public override int Order =&gt; 3;

    public override async Task ProcessAsync(TagHelperContext context,
                                            TagHelperOutput output)
    {
        if (string.Equals(context.TagName, &quot;address&quot;,
                StringComparison.OrdinalIgnoreCase) &amp;&amp;
            output.Attributes.ContainsName(&quot;printable&quot;))
        {
            var content = await output.GetChildContentAsync();
            output.Content.SetHtmlContent(
                $&quot;&lt;div&gt;{content.GetContent()}&lt;/div&gt;{_printableButton}&quot;);
        }
    }
}
</code></pre>
<p>上述 <code>ProcessAsync</code> 方法可将向 &lt;xref:Microsoft.AspNetCore.Razor.TagHelpers.TagHelperContent.SetHtmlContent*&gt; 提供的 HTML 注入到匹配的 <code>&lt;address&gt;</code> 元素中。 在以下情况下进行注入：</p>
<ul>
<li>执行上下文的 <code>TagName</code> 属性值等于 <code>address</code>。</li>
<li>相应的 <code>&lt;address&gt;</code> 元素具有 <code>printable</code> 属性。</li>
</ul>
<p>例如，在处理以下 <code>&lt;address&gt;</code> 元素时，<code>if</code> 语句的计算结果为 true：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><h2 id="additional-resources">其他资源</h2>
<ul>
<li><a class="xref" href="../../../fundamentals/dependency-injection.html">ASP.NET Core 依赖注入</a></li>
<li><a class="xref" href="../dependency-injection.html">在 ASP.NET Core 中将依赖项注入到视图</a></li>
<li><a class="xref" href="built-in/index.html">ASP.NET Core 内置标记帮助程序</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
