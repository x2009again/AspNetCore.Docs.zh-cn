<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>SignalR&#21644; ASP.NET Core &#20043;&#38388;&#30340;&#24046;&#24322;SignalR </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="SignalR&#21644; ASP.NET Core &#20043;&#38388;&#30340;&#24046;&#24322;SignalR ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="signalr/version-differences">
<h1 id="differences-between-aspnet-no-locsignalr-and-aspnet-core-no-locsignalr">ASP.NET SignalR 与 ASP.NET Core 之间的差异 SignalR</h1>

<p>ASP.NET Core SignalR 与 ASP.NET 的客户端或服务器不兼容 SignalR 。 本文详细介绍了 ASP.NET Core 中已删除或更改的功能 SignalR 。</p>
<h2 id="how-to-identify-the-no-locsignalr-version">如何标识 SignalR 版本</h2>
<div range="&gt;= aspnetcore-3.0">
<table>
<thead>
<tr>
<th></th>
<th>ASP.NET SignalR</th>
<th>ASP.NET Core SignalR</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>服务器 NuGet 包</strong></td>
<td><a href="https://www.nuget.org/packages/Microsoft.AspNet.SignalR/">Microsoft。SignalR</a></td>
<td>无。 包含在 <a class="xref" href="../fundamentals/metapackage-app.html">AspNetCore</a> 共享框架中。</td>
</tr>
<tr>
<td><strong>客户端 NuGet 包</strong></td>
<td><a href="https://www.nuget.org/packages/Microsoft.AspNet.SignalR.Client/">Microsoft SignalR 。机</a><br><a href="https://www.nuget.org/packages/Microsoft.AspNet.SignalR.JS/">Microsoft SignalR 。JS</a></td>
<td><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Client/">AspNetCore SignalR 。机</a></td>
</tr>
<tr>
<td><strong>JavaScript 客户端 npm 包</strong></td>
<td><a href="https://www.npmjs.com/package/signalr">signalr</a></td>
<td><a href="https://www.npmjs.com/package/@microsoft/signalr"><code>@microsoft/signalr</code></a></td>
</tr>
<tr>
<td><strong>Java 客户端</strong></td>
<td><a href="https://github.com/SignalR/java-client">GitHub 存储库</a> (弃用)</td>
<td>Maven 包 <a href="https://search.maven.org/artifact/com.microsoft.signalr/signalr">signalr</a></td>
</tr>
<tr>
<td><strong>服务器应用类型</strong></td>
<td>ASP.NET (system.web) 或 OWIN Self-Host</td>
<td>ASP.NET Core</td>
</tr>
<tr>
<td><strong>支持的服务器平台</strong></td>
<td>.NET Framework 4.5 或更高版本</td>
<td>.NET Core 3.0 或更高版本</td>
</tr>
</tbody>
</table>
</div>
<div range="&lt;= aspnetcore-2.2">
<table>
<thead>
<tr>
<th></th>
<th>ASP.NET SignalR</th>
<th>ASP.NET Core SignalR</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>服务器 NuGet 包</strong></td>
<td><a href="https://www.nuget.org/packages/Microsoft.AspNet.SignalR/">Microsoft。SignalR</a></td>
<td><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.App/">AspNetCore</a> ( .net Core) <br><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR/">AspNetCore。SignalR</a> (.NET Framework)</td>
</tr>
<tr>
<td><strong>客户端 NuGet 包</strong></td>
<td><a href="https://www.nuget.org/packages/Microsoft.AspNet.SignalR.Client/">Microsoft SignalR 。机</a><br><a href="https://www.nuget.org/packages/Microsoft.AspNet.SignalR.JS/">Microsoft SignalR 。JS</a></td>
<td><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Client/">AspNetCore SignalR 。机</a></td>
</tr>
<tr>
<td><strong>JavaScript 客户端 npm 包</strong></td>
<td><a href="https://www.npmjs.com/package/signalr">signalr</a></td>
<td><a href="https://www.npmjs.com/package/@aspnet/signalr"><code>@aspnet/signalr</code></a></td>
</tr>
<tr>
<td><strong>Java 客户端</strong></td>
<td><a href="https://github.com/SignalR/java-client">GitHub 存储库</a> (弃用)</td>
<td>Maven 包 <a href="https://search.maven.org/artifact/com.microsoft.signalr/signalr">signalr</a></td>
</tr>
<tr>
<td><strong>服务器应用类型</strong></td>
<td>ASP.NET (system.web) 或 OWIN Self-Host</td>
<td>ASP.NET Core</td>
</tr>
<tr>
<td><strong>支持的服务器平台</strong></td>
<td>.NET Framework 4.5 或更高版本</td>
<td>.NET Framework 4.6.1 或更高版本<br>.NET Core 2.1 或更高版本</td>
</tr>
</tbody>
</table>
</div>
<h2 id="feature-differences">功能差异</h2>
<h3 id="automatic-reconnects">自动重新连接</h3>
<div range="&gt;= aspnetcore-3.0">
<p>在 ASP.NET 中 SignalR ：</p>
<ul>
<li>默认情况下， SignalR 如果断开连接，则将尝试重新连接到服务器。</li>
</ul>
<p>在 ASP.NET Core 中 SignalR ：</p>
<ul>
<li>自动重新连接同时选择<a class="xref" href="dotnet-client.html#automatically-reconnect">.net 客户</a><a class="xref" href="javascript-client.html#automatically-reconnect">端和 JavaScript 客户端</a>：</li>
</ul>
<pre><code class="lang-csharp">HubConnection connection = new HubConnectionBuilder()
    .WithUrl(new Uri(&quot;http://127.0.0.1:5000/chathub&quot;))
    .WithAutomaticReconnect()
    .Build();
</code></pre>
<pre><code class="lang-javascript">const connection = new signalR.HubConnectionBuilder()
    .withUrl(&quot;/chathub&quot;)
    .withAutomaticReconnect()
    .build();
</code></pre>
</div>
<div range="&lt; aspnetcore-3.0">
<p>ASP.NET Core 3.0 之前， SignalR 不支持自动重新连接。 如果客户端已断开连接，用户必须显式启动新连接才能重新连接。 SignalR如果断开连接，则在 ASP.NET 中 SignalR 尝试重新连接到服务器。</p>
</div>
<h3 id="protocol-support">协议支持</h3>
<p>ASP.NET Core SignalR 支持 JSON，以及基于 <a class="xref" href="messagepackhubprotocol.html">MessagePack</a>的新二进制协议。 此外，还可以创建自定义协议。</p>
<h3 id="transports">传输</h3>
<p>ASP.NET Core 中不支持永久帧传输 SignalR 。</p>
<h2 id="differences-on-the-server">服务器上的差异</h2>
<p>ASP.NET Core 的 SignalR 服务器端库包含在 <a class="xref" href="../fundamentals/metapackage-app.html">AspNetCore</a>中，该应用程序用于和 MVC 项目的 <strong>ASP.NET Core Web 应用程序</strong> 模板 Razor 。</p>
<p>ASP.NET Core SignalR 是 ASP.NET Core 的中间件。 必须通过在中调用来配置它 &lt;xref:Microsoft.Extensions.DependencyInjection.SignalRDependencyInjectionExtensions.AddSignalR%2A&gt; <code>Startup.ConfigureServices</code> 。</p>
<pre><code class="lang-csharp">services.AddSignalR()
</code></pre>
<div range="&gt;= aspnetcore-3.0">
<p>若要配置路由，请将路由映射到 &lt;xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints%2A&gt; 方法中的方法调用内的中心 <code>Startup.Configure</code> 。</p>
<pre><code class="lang-csharp">app.UseRouting();

app.UseEndpoints(endpoints =&gt;
{
    endpoints.MapHub&lt;ChatHub&gt;(&quot;/hub&quot;);
});
</code></pre>
</div>
<div range="&lt;= aspnetcore-2.2">
<p>若要配置路由，请将路由映射到 &lt;xref:Microsoft.AspNetCore.Builder.SignalRAppBuilderExtensions.UseSignalR%2A&gt; 方法中的方法调用内的中心 <code>Startup.Configure</code> 。</p>
<pre><code class="lang-csharp">app.UseSignalR(routes =&gt;
{
    routes.MapHub&lt;ChatHub&gt;(&quot;/hub&quot;);
});
</code></pre>
</div>
<h3 id="sticky-sessions">粘滞会话</h3>
<p>ASP.NET 的扩展模型 SignalR 允许客户端将消息重新连接到场中的任何服务器并向其发送消息。 在 ASP.NET Core 中 SignalR ，客户端必须在连接期间与同一服务器交互。 对于使用 Redis 的扩展，这意味着需要使用粘滞会话。 对于使用 <a href="/azure/azure-signalr/">Azure SignalR 服务</a>的扩展，无需使用粘滞会话，因为服务会处理与客户端的连接。</p>
<h3 id="single-hub-per-connection">单个集线器每个连接</h3>
<p>在 ASP.NET Core 中 SignalR ，连接模型已简化。 直接连接到单个集线器，而不是使用单个连接来共享对多个中心的访问。</p>
<h3 id="streaming">流式处理</h3>
<p>ASP.NET Core SignalR 现在支持从中心到客户端的 <a class="xref" href="streaming.html">流数据</a> 。</p>
<h3 id="state">状态</h3>
<p>能够在客户端和中心之间传递任意状态 (经常称为 <code>HubState</code>) ，并支持进度消息。 目前没有集线器代理。</p>
<h3 id="persistentconnection-removal">删除 PersistentConnection</h3>
<p>在 ASP.NET Core 中 SignalR ，已删除 <a href="/previous-versions/aspnet/jj919047(v=vs.118)">PersistentConnection</a> 类。</p>
<h3 id="globalhost">GlobalHost</h3>
<p>ASP.NET Core 在框架中内置了 (DI) 依赖关系注入。 服务可以使用 DI 来访问 <a class="xref" href="hubcontext.html">HubContext</a>。 在 <code>GlobalHost</code> ASP.NET SignalR 中用于获取的对象 <code>HubContext</code> 在 ASP.NET Core 中不存在 SignalR 。</p>
<h3 id="hubpipeline">HubPipeline</h3>
<p>ASP.NET Core SignalR 不支持 <code>HubPipeline</code> 模块。</p>
<h2 id="differences-on-the-client">与客户端之间的差异</h2>
<h3 id="typescript">TypeScript</h3>
<p>ASP.NET Core SignalR 客户端是以 <a href="https://www.typescriptlang.org/">TypeScript</a>编写的。 使用 <a class="xref" href="javascript-client.html">javascript 客户端</a>时，可以使用 Javascript 或 TypeScript 来编写。</p>
<h3 id="the-javascript-client-is-hosted-at-npm">JavaScript 客户端托管在 npm</h3>
<div range="&gt;= aspnetcore-3.0">
<p>在 ASP.NET 版本中，JavaScript 客户端通过 Visual Studio 中的 NuGet 包获得。 在 ASP.NET Core 版本中， <a href="https://www.npmjs.com/package/@microsoft/signalr"><code>@microsoft/signalr</code></a> npm 包包含 JavaScript 库。 此包不包含在 <strong>ASP.NET Core Web 应用程序</strong> 模板中。 使用 npm 获取和安装 <code>@microsoft/signalr</code> npm 包。</p>
<pre><code class="lang-console">npm init -y
npm install @microsoft/signalr
</code></pre>
</div>
<div range="&lt;= aspnetcore-2.2">
<p>在 ASP.NET 版本中，JavaScript 客户端通过 Visual Studio 中的 NuGet 包获得。 在 ASP.NET Core 版本中， <a href="https://www.npmjs.com/package/@aspnet/signalr"><code>@aspnet/signalr</code></a> npm 包包含 JavaScript 库。 此包不包含在 <strong>ASP.NET Core Web 应用程序</strong> 模板中。 使用 npm 获取和安装 <code>@aspnet/signalr</code> npm 包。</p>
<pre><code class="lang-console">npm init -y
npm install @aspnet/signalr
</code></pre>
</div>
<h3 id="jquery">jQuery</h3>
<p>已移除 jQuery 的依赖项，但项目仍可使用 jQuery。</p>
<h3 id="internet-explorer-support">Internet Explorer 支持</h3>
<p>ASP.NET Core SignalR 支持 Microsoft Internet explorer 11 或更高版本，而 ASP.NET SignalR 支持 Microsoft internet explorer 8 或更高版本。
有关浏览器支持的详细信息，请参阅 <a class="xref" href="supported-platforms.html#javascript-client">支持的平台</a>。</p>
<h3 id="javascript-client-method-syntax">JavaScript 客户端方法语法</h3>
<div range="&gt;= aspnetcore-3.0">
<p>JavaScript 语法已在的 ASP.NET 版本中发生了更改 SignalR 。 不要使用 <code>$connection</code> 对象，而是使用 <a href="/javascript/api/@aspnet/signalr/hubconnectionbuilder">HubConnectionBuilder</a> API 创建连接。</p>
<pre><code class="lang-javascript">const connection = new signalR.HubConnectionBuilder()
    .withUrl(&quot;/hub&quot;)
    .build();
</code></pre>
<p>使用 <a href="/javascript/api/@microsoft/signalr/HubConnection#on">on</a> 方法可指定中心可调用的客户端方法。</p>
</div>
<div range="&lt;= aspnetcore-2.2">
<p>JavaScript 语法已在的 ASP.NET 版本中发生了更改 SignalR 。 不要使用 <code>$connection</code> 对象，而是使用 <a href="/javascript/api/@microsoft/signalr/hubconnectionbuilder">HubConnectionBuilder</a> API 创建连接。</p>
<pre><code class="lang-javascript">const connection = new signalR.HubConnectionBuilder()
    .withUrl(&quot;/hub&quot;)
    .build();
</code></pre>
<p>使用 <a href="/javascript/api/@aspnet/signalr/HubConnection#on">on</a> 方法可指定中心可调用的客户端方法。</p>
</div>
<pre><code class="lang-javascript">connection.on(&quot;ReceiveMessage&quot;, (user, message) =&gt; {
    const msg = message.replace(/&amp;/g, &quot;&amp;amp;&quot;).replace(/&lt;/g, &quot;&amp;lt;&quot;).replace(/&gt;/g, &quot;&amp;gt;&quot;);
    const encodedMsg = `${user} says ${msg}`;
    console.log(encodedMsg);
});
</code></pre>
<p>创建客户端方法后，启动集线器连接。 将 <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch">catch</a> 方法链接到日志或处理错误。</p>
<pre><code class="lang-javascript">connection.start().catch(err =&gt; console.error(err));
</code></pre>
<h3 id="hub-proxies">中心代理</h3>
<div range="&gt;= aspnetcore-3.0">
<p>中心代理不再自动生成。 相反，方法名称将作为字符串传递到 <a href="/javascript/api/@microsoft/signalr/hubconnection#invoke">调用</a> API。</p>
</div>
<div range="&lt;= aspnetcore-2.2">
<p>中心代理不再自动生成。 相反，方法名称将作为字符串传递到 <a href="/javascript/api/@aspnet/signalr/hubconnection#invoke">调用</a> API。</p>
</div>
<h3 id="net-and-other-clients">.NET 和其他客户端</h3>
<p><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.SignalR.Client">AspNetCore. SignalR客户端</a>NuGet 包包含用于 ASP.NET Core 的 .net 客户端库 SignalR 。</p>
<p>使用 &lt;xref:Microsoft.AspNetCore.SignalR.Client.HubConnectionBuilder&gt; 创建和生成与集线器的连接的实例。</p>
<pre><code class="lang-csharp">connection = new HubConnectionBuilder()
    .WithUrl(&quot;url&quot;)
    .Build();
</code></pre>
<h2 id="scaleout-differences">扩展差异</h2>
<p>ASP.NET SignalR 支持 SQL Server 和 Redis。 ASP.NET Core SignalR 支持 Azure SignalR 服务和 Redis。</p>
<h3 id="aspnet">ASP.NET</h3>
<ul>
<li><a href="/aspnet/signalr/overview/performance/scaleout-with-windows-azure-service-bus">SignalR 与 Azure 服务总线扩展</a></li>
<li><a href="/aspnet/signalr/overview/performance/scaleout-with-redis">SignalR 带 Redis 的扩展</a></li>
<li><a href="/aspnet/signalr/overview/performance/scaleout-with-sql-server">SignalR 扩展与 SQL Server</a></li>
</ul>
<h3 id="aspnet-core">ASP.NET Core</h3>
<ul>
<li><a href="/azure/azure-signalr/">Azure SignalR 服务</a></li>
<li><a class="xref" href="redis-backplane.html">Redis 底板</a></li>
</ul>
<h2 id="additional-resources">其他资源</h2>
<ul>
<li><a class="xref" href="hubs.html">中心</a></li>
<li><a class="xref" href="javascript-client.html">JavaScript 客户端</a></li>
<li><a class="xref" href="dotnet-client.html">.NET 客户端</a></li>
<li><a class="xref" href="supported-platforms.html">支持的平台</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
