<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#31532; 2 &#37096;&#20998;&#65292;&#22312; ASP.NET Core &#20013;&#21521; Razor &#39029;&#38754;&#24212;&#29992;&#28155;&#21152;&#27169;&#22411; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#31532; 2 &#37096;&#20998;&#65292;&#22312; ASP.NET Core &#20013;&#21521; Razor &#39029;&#38754;&#24212;&#29992;&#28155;&#21152;&#27169;&#22411; ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="tutorials/razor-pages/model">
<h1 id="part-2-add-a-model-to-a-no-locrazor-pages-app-in-aspnet-core">第 2 部分，在 ASP.NET Core 中向 Razor 页面应用添加模型</h1>

<p>作者：<a href="https://twitter.com/RickAndMSFT">Rick Anderson</a></p>
<div range="&gt;= aspnetcore-3.0">
<!-- In the next update on the CLI version, let the scaffolder do the same work the VS driven scaffolder does. That is, create the DB context, etc -->
<p>在该部分，会添加类管理影片。 应用的模型类使用 <a href="/ef/core">Entity Framework Core (EF Core)</a> 来处理数据库。 EF Core 是一种对象关系映射器 (ORM)，可简化数据访问。</p>
<p>模型类称为 POCO 类（源自“简单传统 CLR 对象”），因为它们与 EF Core 没有任何依赖关系。 它们定义数据库中存储的数据属性。</p>
<div range="&gt;= aspnetcore-3.0">
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/tutorials/razor-pages/razor-pages-start/sample/RazorPagesMovie30">查看或下载示例代码</a>（<a class="xref" href="../../introduction-to-aspnet-core.html#how-to-download-a-sample">如何下载</a>）。</p>
</div>
<div range="&lt; aspnetcore-3.0">
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/tutorials/razor-pages/razor-pages-start">查看或下载示例代码</a>（<a class="xref" href="../../introduction-to-aspnet-core.html#how-to-download-a-sample">如何下载</a>）。</p>
</div>
<h2 id="add-a-data-model">添加数据模型</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>右键单击“RazorPagesMovie”项目 &gt;“添加” &gt; “新建文件夹”  。 将文件夹命名为“Models”。</p>
<p>右键单击“Models”文件夹。 选择“添加” &gt; “类” 。 将类命名“Movie”。</p>
<!-- THIS INCLUDE USED BY MVC AND RP -->
<p>向 <code>Movie</code> 类添加以下属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>Movie</code> 类包含：</p>
<ul>
<li><p>数据库需要 <code>ID</code> 字段以获取主键。</p>
</li>
<li><p><code>[DataType(DataType.Date)]</code>：<a href="xref:System.ComponentModel.DataAnnotations.DataTypeAttribute">DataType</a> 属性指定数据的类型（日期）。 通过此特性：</p>
<ul>
<li>用户无需在数据字段中输入时间信息。</li>
<li>仅显示日期，而非时间信息。</li>
</ul>
</li>
</ul>
<p><a href="/dotnet/api/system.componentmodel.dataannotations">DataAnnotations</a> 会在后续教程中介绍。</p>
</section>
<section id="tabpanel_CeZOj-G++Q_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<ul>
<li>添加名为“Models”的文件夹。</li>
<li>将类添加到名为“Movie.cs”的“Models”文件夹。</li>
</ul>
<!-- THIS INCLUDE USED BY MVC AND RP -->
<p>向 <code>Movie</code> 类添加以下属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>Movie</code> 类包含：</p>
<ul>
<li><p>数据库需要 <code>ID</code> 字段以获取主键。</p>
</li>
<li><p><code>[DataType(DataType.Date)]</code>：<a href="xref:System.ComponentModel.DataAnnotations.DataTypeAttribute">DataType</a> 属性指定数据的类型（日期）。 通过此特性：</p>
<ul>
<li>用户无需在数据字段中输入时间信息。</li>
<li>仅显示日期，而非时间信息。</li>
</ul>
</li>
</ul>
<p><a href="/dotnet/api/system.componentmodel.dataannotations">DataAnnotations</a> 会在后续教程中介绍。</p>
<p><a name="dc"></a></p>
<h3 id="add-nuget-packages-and-ef-tools">添加 NuGet 包和 EF 工具</h3>
<p>运行以下 .NET Core CLI 命令：</p>
<pre><code class="lang-dotnetcli">dotnet tool install --global dotnet-ef
dotnet tool install --global dotnet-aspnet-codegenerator
dotnet add package Microsoft.EntityFrameworkCore.SQLite
dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design
dotnet add package Microsoft.EntityFrameworkCore.Design
dotnet add package Microsoft.EntityFrameworkCore.SqlServer
dotnet add package Microsoft.Extensions.Logging.Debug
</code></pre>
<p>上述命令添加：</p>
<ul>
<li><a class="xref" href="../../fundamentals/tools/dotnet-aspnet-codegenerator.html">aspnet-codegenerator 基架工具</a>。</li>
<li>适用于 .NET Core CLI 的 Entity Framework Core 工具。</li>
<li>EF Core SQLite 提供程序将 EF Core 包作为依赖项进行安装。</li>
<li>基架需要的包：<code>Microsoft.VisualStudio.Web.CodeGeneration.Design</code> 和 <code>Microsoft.EntityFrameworkCore.SqlServer</code>。</li>
</ul>
<p>有关允许应用按环境配置其数据库上下文的多个环境配置指南，请参阅 <a class="xref" href="../../fundamentals/environments.html#environment-based-startup-class-and-methods">在 ASP.NET Core 中使用多个环境</a>。</p>
<p>如果出现基架错误，请验证目标框架名字对象 (TFM) 是否与项目文件中的 NuGet 包版本相匹配。 例如，以下项目文件包含适用于 .NET Core 的版本 3.1 和所列的 NuGet 包：</p>
<pre><code class="lang-xml">&lt;Project Sdk=&quot;Microsoft.NET.Sdk.Web&quot;&gt;

  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;netcoreapp3.1&lt;/TargetFramework&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Identity.EntityFrameworkCore&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Identity.UI&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.EntityFrameworkCore.Design&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.EntityFrameworkCore.SqlServer&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.EntityFrameworkCore.Tools&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.VisualStudio.Web.CodeGeneration.Design&quot; Version=&quot;3.1.0&quot; /&gt;
  &lt;/ItemGroup&gt;

&lt;/Project&gt;
</code></pre>
<h3 id="add-a-database-context-class">添加数据库上下文类</h3>
<p>在 RazorPagesMovie 项目中，创建名为“数据”的新文件夹。 将以下 <code>RazorPagesMovieContext</code> 类添加到“Data”文件夹：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的代码为实体集创建 <code>DbSet</code> 属性。 在 Entity Framework 中，实体集通常与数据表相对应，具体实体与表中的行相对应。 直至在后续步骤中添加依赖项，代码才可编译。</p>
<p><a name="cs"></a></p>
<h3 id="add-a-database-connection-string">添加数据库连接字符串</h3>
<p>向 appsettings.json 文件添加一个连接字符串，如以下突出显示的代码所示：</p>
<div range="&gt;= aspnetcore-3.0">
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><a name="reg"></a></p>
<h3 id="register-the-database-context">注册数据库上下文</h3>
<p>将以下 <code>using</code> 语句添加到 Startup.cs 顶部：</p>
<pre><code class="lang-csharp">using RazorPagesMovie.Data;
using Microsoft.EntityFrameworkCore;
</code></pre>
<p>使用 <code>Startup.ConfigureServices</code> 中的<a class="xref" href="../../fundamentals/dependency-injection.html">依赖关系注入</a>容器注册数据库上下文。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></div>
<div range="&lt; aspnetcore-3.0">
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><h3 id="add-required-nuget-packages">添加所需的 NuGet 包</h3>
<p>运行以下 .NET Core CLI 命令，将 SQLite 和 CodeGeneration.Design 添加到项目中：</p>
<pre><code class="lang-dotnetcli">dotnet add package Microsoft.EntityFrameworkCore.SQLite
dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design
dotnet add package Microsoft.EntityFrameworkCore.Design
</code></pre>
<p><code>Microsoft.VisualStudio.Web.CodeGeneration.Design</code> 包对基架是必需的。</p>
<p><a name="reg"></a></p>
<h3 id="register-the-database-context">注册数据库上下文</h3>
<p>将以下 <code>using</code> 语句添加到 Startup.cs 顶部：</p>
<pre><code class="lang-csharp">using RazorPagesMovie.Models;
using Microsoft.EntityFrameworkCore;
</code></pre>
<p>使用 <code>Startup.ConfigureServices</code> 中的<a class="xref" href="../../fundamentals/dependency-injection.html">依赖关系注入</a>容器注册数据库上下文。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>生成项目以检查错误。</p>
</div>
</section>
<section id="tabpanel_CeZOj-G++Q_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<ul>
<li><p>在 Solution Pad 中，右键单击“RazorPagesMovie”项目，然后选择“添加”&gt;“新建文件夹...”  。将文件夹命名为“Models”。</p>
</li>
<li><p>右键单击“Models”文件夹，然后选择“添加”&gt;“新建文件...”。</p>
</li>
<li><p>在“新建文件”对话框中：</p>
<ul>
<li>在左侧窗格中，选择“常规”。</li>
<li>在中间窗格中，选择“空类”。</li>
<li>将此类命名为“Movie”，然后选择“新建”。</li>
</ul>
</li>
</ul>
<!-- THIS INCLUDE USED BY MVC AND RP -->
<p>向 <code>Movie</code> 类添加以下属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>Movie</code> 类包含：</p>
<ul>
<li><p>数据库需要 <code>ID</code> 字段以获取主键。</p>
</li>
<li><p><code>[DataType(DataType.Date)]</code>：<a href="xref:System.ComponentModel.DataAnnotations.DataTypeAttribute">DataType</a> 属性指定数据的类型（日期）。 通过此特性：</p>
<ul>
<li>用户无需在数据字段中输入时间信息。</li>
<li>仅显示日期，而非时间信息。</li>
</ul>
</li>
</ul>
<p><a href="/dotnet/api/system.componentmodel.dataannotations">DataAnnotations</a> 会在后续教程中介绍。</p>
</section>
</div>

<p>生成项目以验证没有任何编译错误。</p>
<h2 id="scaffold-the-movie-model">搭建“电影”模型的基架</h2>
<p>在此部分，将搭建“电影”模型的基架。 确切地说，基架工具将生成页面，用于对“电影”模型执行创建、读取、更新和删除 (CRUD) 操作。</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>创建“Pages/Movies”文件夹：</p>
<ul>
<li>右键单击“Pages”文件夹 &gt;“添加”&gt;“新建文件夹”。</li>
<li>将文件夹命名为“Movies”</li>
</ul>
<p>右键单击“Pages/Movies”文件夹 &gt;“添加”&gt;“新搭建基架的项目”。</p>
<p><img src="model/_static/sca.png" alt="上述说明的图像。"></p>
<p>在“添加基架”对话框中，依次选择“使用实体框架的 Razor 页面 (CRUD)”&gt;“添加”。</p>
<p><img src="model/_static/add_scaffold.png" alt="上述说明的图像。"></p>
<p>完成“添加使用实体框架的 Razor 页面 (CRUD)”对话框：</p>
<ul>
<li>在“模型类”下拉列表中，选择“Movie (RazorPagesMovie.Models)” 。</li>
<li>在“数据上下文类”行中，选择 +（加号）并将生成的名称从 RazorPagesMovie.Models.RazorPagesMovieContext 更改为 RazorPagesMovie.Data.RazorPagesMovieContext   。 不需要<a href="https://developercommunity.visualstudio.com/content/problem/652166/aspnet-core-ef-scaffolder-uses-incorrect-namespace.html">此更新</a>。 它创建具有正确命名空间的数据库上下文类。</li>
<li>选择“添加”。</li>
</ul>
<p><img src="model/_static/3/arp.png" alt="上述说明的图像。"></p>
<p>appsettings.json 文件通过用于连接到本地数据的连接字符串进行更新。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">
<!--  Until https://github.com/aspnet/Scaffolding/issues/582 is fixed windows needs backslash or the namespace is namespace RazorPagesMovie.Pages_Movies rather than namespace RazorPagesMovie.Pages.Movies
-->
<ul>
<li><p>打开项目目录（包含 Program.cs、Startup.cs 和 .csproj 文件的目录）中的命令窗口。</p>
</li>
<li><p>安装基架工具：</p>
<pre><code class="lang-dotnetcli">dotnet tool install --global dotnet-aspnet-codegenerator
</code></pre>
</li>
<li><p><strong>对于 Windows</strong>：运行下面的命令：</p>
<pre><code class="lang-dotnetcli">dotnet aspnet-codegenerator razorpage -m Movie -dc RazorPagesMovieContext -udl -outDir Pages\Movies --referenceScriptLibraries
</code></pre>
</li>
<li><p><strong>对于 macOS 和 Linux</strong>：运行下面的命令：</p>
<pre><code class="lang-dotnetcli">dotnet aspnet-codegenerator razorpage -m Movie -dc RazorPagesMovieContext -udl -outDir Pages/Movies --referenceScriptLibraries
dotnet tool install --global dotnet-aspnet-codegenerator
</code></pre>
</li>
</ul>
<p><a name="codegenerator"></a> 下表详细说明了 ASP.NET Core 代码生成器参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>-m</td>
<td>模型的名称。</td>
</tr>
<tr>
<td>-dc</td>
<td>要使用的 <code>DbContext</code> 类。</td>
</tr>
<tr>
<td>-udl</td>
<td>使用默认布局。</td>
</tr>
<tr>
<td>-outDir</td>
<td>用于创建视图的相对输出文件夹路径。</td>
</tr>
<tr>
<td>--referenceScriptLibraries</td>
<td>向“编辑”和“创建”页面添加 <code>_ValidationScriptsPartial</code></td>
</tr>
</tbody>
</table>
<p>使用 <code>h</code> 开关获取 <code>aspnet-codegenerator razorpage</code> 命令方面的帮助：</p>
<pre><code class="lang-dotnetcli">dotnet aspnet-codegenerator razorpage -h
</code></pre>
<p>有关详细信息，请查看 <a class="xref" href="../../fundamentals/tools/dotnet-aspnet-codegenerator.html">dotnet aspnet-codegenerator</a>。</p>
<h3 id="use-sqlite-for-development-sql-server-for-production">将 SQLite 用于开发，将 SQL Server 用于生产</h3>
<p>选择 SQLite 后，模板生成的代码便可用于开发。 下面的代码演示如何将 &lt;xref:Microsoft.AspNetCore.Hosting.IWebHostEnvironment&gt; 注入到 Startup 中。 注入 <code>IWebHostEnvironment</code>，以便 <code>ConfigureServices</code> 可以在开发中使用 SQLite 并在生产中使用 SQL Server。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></section>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<p>创建“Pages/Movies”文件夹：</p>
<ul>
<li>右键单击“Pages”文件夹 &gt;“添加”&gt;“新建文件夹”。</li>
<li>将文件夹命名为“Movies”</li>
</ul>
<p>右键单击“Pages/Movies”文件夹 &gt;“添加”&gt;“新基架...”。</p>
<p><img src="model/_static/scaMac.png" alt="上述说明的图像。"></p>
<p>在“新基架”对话框中，依次选择“使用实体框架的 Razor 页面 (CRUD)”&gt;“下一步”。</p>
<p><img src="model/_static/add_scaffoldMac.png" alt="上述说明的图像。"></p>
<p>完成“添加使用实体框架的 Razor 页面 (CRUD)”对话框：</p>
<ul>
<li>在“模型类”下拉列表中，选择或键入“Movie (RazorPagesMovie.Models)” 。</li>
<li>在“数据上下文类”行中，键入新类的名称“RazorPagesMovie.Data.RazorPagesMovieContext”。  不需要<a href="https://developercommunity.visualstudio.com/content/problem/652166/aspnet-core-ef-scaffolder-uses-incorrect-namespace.html">此更新</a>。 它创建具有正确命名空间的数据库上下文类。</li>
<li>选择“添加”。</li>
</ul>
<p><img src="model/_static/arpMac.png" alt="上述说明的图像。"></p>
<p>appsettings.json 文件通过用于连接到本地数据的连接字符串进行更新。</p>
<h3 id="add-ef-tools">添加 EF 工具</h3>
<p>运行以下 .NET Core CLI 命令：</p>
<pre><code class="lang-dotnetcli">dotnet tool install --global dotnet-ef
</code></pre>
<p>前面的命令将添加适用于 .NET Core CLI 的 Entity Framework Core 工具。</p>
</section>
</div>
<h3 id="files-created">创建的文件</h3>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-2_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>在搭建基架时，会创建并更新以下文件：</p>
<ul>
<li><em>Pages/Movies</em>：“创建”、“删除”、“详细信息”、“编辑”和“索引”。</li>
<li>Data/RazorPagesMovieContext.cs</li>
</ul>
<h3 id="updated">已更新</h3>
<ul>
<li><em>Startup.cs</em></li>
</ul>
<p>创建和更新的文件将在下一节中说明。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-2_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<p>在搭建基架时，会创建并更新以下文件：</p>
<ul>
<li><em>Pages/Movies</em>：“创建”、“删除”、“详细信息”、“编辑”和“索引”。</li>
<li>Data/RazorPagesMovieContext.cs</li>
</ul>
<h3 id="updated">已更新</h3>
<ul>
<li><em>Startup.cs</em></li>
</ul>
<p>创建和更新的文件将在下一节中说明。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-2_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<p>在搭建基架时，会创建以下文件：</p>
<ul>
<li><em>Pages/Movies</em>：“创建”、“删除”、“详细信息”、“编辑”和“索引”。</li>
</ul>
<p>创建的文件将在下一节中说明。</p>
</section>
</div>

<p><a name="pmc"></a></p>
<h2 id="initial-migration">初始迁移</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-3_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-3_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-3_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-3_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-3_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-3_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-3_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>在此部分中，程序包管理器控制台 (PMC) 用于：</p>
<ul>
<li>添加初始迁移。</li>
<li>使用初始迁移来更新数据库。</li>
</ul>
<p>从“工具”菜单中，选择“NuGet 包管理器”&gt;“包管理器控制台” 。</p>
<p><img src="../first-mvc-app/adding-model/_static/pmc.png" alt="PMC 菜单"></p>
<p>在 PMC 中，输入以下命令：</p>
<pre><code class="lang-powershell">Add-Migration InitialCreate
Update-Database
</code></pre>
</section>
<section id="tabpanel_CeZOj-G++Q-3_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">
<p>如果尚未 <code>dotnet ef</code> 安装，请将其安装为全局工具：</p>
<pre><code class="lang-dotnetcli">  dotnet tool install --global dotnet-ef
</code></pre>
<p>有关 EF Core 的 CLI 的详细信息，请参阅 <a href="/ef/core/miscellaneous/cli/dotnet">.Net CLI 的 EF Core 工具引用</a>。</p>

<p>运行以下 .NET Core CLI 命令：</p>
<pre><code class="lang-dotnetcli">dotnet ef migrations add InitialCreate
dotnet ef database update
</code></pre>
</section>
<section id="tabpanel_CeZOj-G++Q-3_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">
<p>如果尚未 <code>dotnet ef</code> 安装，请将其安装为全局工具：</p>
<pre><code class="lang-dotnetcli">  dotnet tool install --global dotnet-ef
</code></pre>
<p>有关 EF Core 的 CLI 的详细信息，请参阅 <a href="/ef/core/miscellaneous/cli/dotnet">.Net CLI 的 EF Core 工具引用</a>。</p>

<p>运行以下 .NET Core CLI 命令：</p>
<pre><code class="lang-dotnetcli">dotnet ef migrations add InitialCreate
dotnet ef database update
</code></pre>
</section>
</div>

<p>前面的命令生成以下警告：“No type was specified for the decimal column 'Price' on entity type 'Movie'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'.”</p>
<p>你可以忽略该警告，它将后面的教程中得到修复。</p>
<p>migrations 命令生成用于创建初始数据库架构的代码。 该架构基于在 <code>DbContext</code> 中指定的模型。 <code>InitialCreate</code> 参数用于为迁移命名。 可以使用任何名称，但是按照惯例，会选择可说明迁移的名称。</p>
<p><code>update</code> 命令在尚未应用的迁移中运行 <code>Up</code> 方法。 在这种情况下，<code>update</code> 在用于创建数据库的 Migrations/&lt;time-stamp&gt;_InitialCreate.cs 文件中运行 <code>Up</code> 方法。</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-4">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-4_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-4_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-4_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-4_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-4_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-4_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-4_visual-studio" role="tabpanel" data-tab="visual-studio">
<h3 id="examine-the-context-registered-with-dependency-injection">检查通过依赖关系注入注册的上下文</h3>
<p>ASP.NET Core 通过<a class="xref" href="../../fundamentals/dependency-injection.html">依赖关系注入</a>进行生成。 服务（例如 EF Core 数据库上下文）在应用程序启动期间通过依赖关系注入进行注册。 需要这些服务（如 Razor 页面）的组件通过构造函数参数提供相应服务。 本教程的后续部分介绍了用于获取 DB 上下文实例的构造函数代码。</p>
<p>基架工具自动创建 DB 上下文并将其注册到依赖关系注入容器。</p>
<p>检查 <code>Startup.ConfigureServices</code> 方法。 基架添加了突出显示的行：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>RazorPagesMovieContext</code> 为 <code>Movie</code> 模型协调 EF Core 功能（创建、读取、更新、删除等）。 数据上下文 (<code>RazorPagesMovieContext</code>) 派生自 <a href="/dotnet/api/microsoft.entityframeworkcore.dbcontext">Microsoft.EntityFrameworkCore.DbContext</a>。 数据上下文指定数据模型中包含哪些实体。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的代码为实体集创建 <a href="/dotnet/api/microsoft.entityframeworkcore.dbset-1">DbSet&lt;Movie&gt;</a> 属性。 在实体框架术语中，实体集通常与数据表相对应。 实体对应表中的行。</p>
<p>通过调用 <a href="/dotnet/api/microsoft.entityframeworkcore.dbcontextoptions">DbContextOptions</a> 对象中的一个方法将连接字符串名称传递到上下文。 进行本地开发时， <a class="xref" href="../../fundamentals/configuration/index.html">ASP.NET Core 配置系统</a> 在 <em>appsettings.json</em> 文件中读取数据库连接字符串。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-4_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<p>检查 <code>Up</code> 方法。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-4_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<p>检查 <code>Up</code> 方法。</p>
</section>
</div>

<p><a name="test"></a></p>
<h3 id="test-the-app">测试应用</h3>
<ul>
<li>运行应用并将 <code>/Movies</code> 追加到浏览器中的 URL (<code>http://localhost:port/movies</code>)。</li>
</ul>
<p>如果收到错误：</p>
<pre><code class="lang-console">SqlException: Cannot open database &quot;RazorPagesMovieContext-GUID&quot; requested by the login. The login failed.
Login failed for user 'User-name'.
</code></pre>
<p>缺少<a href="#pmc">迁移步骤</a>。</p>
<ul>
<li><p>测试“创建”链接。</p>
<p><img src="model/_static/conan.png" alt="创建页面"></p>
<div class="NOTE">
<h5>Note</h5>
<p>可能无法在 <code>Price</code> 字段中输入十进制逗号。 若要使 <a href="https://jqueryvalidation.org/">jQuery 验证</a>支持使用逗号（“,”）表示小数点的非英语区域设置，以及支持非美国英语日期格式，应用必须进行全球化。 有关全球化的说明，请参阅<a href="https://github.com/dotnet/AspNetCore.Docs/issues/4076#issuecomment-326590420">此 GitHub 问题</a>。</p>
</div>
</li>
<li><p>测试“编辑”、“详细信息”和“删除”链接。</p>
</li>
</ul>
<p>下一个教程介绍由基架创建的文件。</p>
<h2 id="additional-resources">其他资源</h2>
<div class="step-by-step">
<p><a class="xref" href="razor-pages-start.html">上一篇：入门</a>
<a class="xref" href="page.html">下一篇：基架 Razor Pages</a></p>
</div>
</div>
<!--  ::: moniker previous version   -->
<div range="&lt; aspnetcore-3.0">
<p>在本节中，添加了用于管理跨平台 <a href="https://www.sqlite.org/index.html">SQLite 数据库</a>中的电影的类。 从 ASP.NET Core 模板创建的应用使用 SQLite 数据库。 应用的模型类配合 <a href="/ef/core">Entity Framework Core (EF Core)</a>（<a href="/ef/core/providers/sqlite">SQLite EF Core 数据库提供程序</a>）使用，以处理数据库。 EF Core 是一种对象关系映射 (ORM) 框架，可以简化数据访问。</p>
<p>模型类称为 POCO 类（源自“简单传统 CLR 对象”），因为它们与 EF Core 没有任何依赖关系。 它们定义数据库中存储的数据属性。</p>
<div range="&gt;= aspnetcore-3.0">
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/tutorials/razor-pages/razor-pages-start/sample/RazorPagesMovie30">查看或下载示例代码</a>（<a class="xref" href="../../introduction-to-aspnet-core.html#how-to-download-a-sample">如何下载</a>）。</p>
</div>
<div range="&lt; aspnetcore-3.0">
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/tutorials/razor-pages/razor-pages-start">查看或下载示例代码</a>（<a class="xref" href="../../introduction-to-aspnet-core.html#how-to-download-a-sample">如何下载</a>）。</p>
</div>
<h2 id="add-a-data-model">添加数据模型</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-5">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-5_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-5_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-5_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-5_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-5_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-5_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-5_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>右键单击“RazorPagesMovie”项目 &gt;“添加” &gt; “新建文件夹”  。 将文件夹命名为“Models”。</p>
<p>右键单击“Models”文件夹。 选择“添加” &gt; “类” 。 将类命名“Movie”。</p>
<!-- THIS INCLUDE USED BY MVC AND RP -->
<p>向 <code>Movie</code> 类添加以下属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>Movie</code> 类包含：</p>
<ul>
<li><p>数据库需要 <code>ID</code> 字段以获取主键。</p>
</li>
<li><p><code>[DataType(DataType.Date)]</code>：<a href="xref:System.ComponentModel.DataAnnotations.DataTypeAttribute">DataType</a> 属性指定数据的类型（日期）。 通过此特性：</p>
<ul>
<li>用户无需在数据字段中输入时间信息。</li>
<li>仅显示日期，而非时间信息。</li>
</ul>
</li>
</ul>
<p><a href="/dotnet/api/system.componentmodel.dataannotations">DataAnnotations</a> 会在后续教程中介绍。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-5_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<ul>
<li>添加名为“Models”的文件夹。</li>
<li>将类添加到名为“Movie.cs”的“Models”文件夹。</li>
</ul>
<!-- THIS INCLUDE USED BY MVC AND RP -->
<p>向 <code>Movie</code> 类添加以下属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>Movie</code> 类包含：</p>
<ul>
<li><p>数据库需要 <code>ID</code> 字段以获取主键。</p>
</li>
<li><p><code>[DataType(DataType.Date)]</code>：<a href="xref:System.ComponentModel.DataAnnotations.DataTypeAttribute">DataType</a> 属性指定数据的类型（日期）。 通过此特性：</p>
<ul>
<li>用户无需在数据字段中输入时间信息。</li>
<li>仅显示日期，而非时间信息。</li>
</ul>
</li>
</ul>
<p><a href="/dotnet/api/system.componentmodel.dataannotations">DataAnnotations</a> 会在后续教程中介绍。</p>
<p><a name="dc"></a></p>
<h3 id="add-nuget-packages-and-ef-tools">添加 NuGet 包和 EF 工具</h3>
<p>运行以下 .NET Core CLI 命令：</p>
<pre><code class="lang-dotnetcli">dotnet tool install --global dotnet-ef
dotnet tool install --global dotnet-aspnet-codegenerator
dotnet add package Microsoft.EntityFrameworkCore.SQLite
dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design
dotnet add package Microsoft.EntityFrameworkCore.Design
dotnet add package Microsoft.EntityFrameworkCore.SqlServer
dotnet add package Microsoft.Extensions.Logging.Debug
</code></pre>
<p>上述命令添加：</p>
<ul>
<li><a class="xref" href="../../fundamentals/tools/dotnet-aspnet-codegenerator.html">aspnet-codegenerator 基架工具</a>。</li>
<li>适用于 .NET Core CLI 的 Entity Framework Core 工具。</li>
<li>EF Core SQLite 提供程序将 EF Core 包作为依赖项进行安装。</li>
<li>基架需要的包：<code>Microsoft.VisualStudio.Web.CodeGeneration.Design</code> 和 <code>Microsoft.EntityFrameworkCore.SqlServer</code>。</li>
</ul>
<p>有关允许应用按环境配置其数据库上下文的多个环境配置指南，请参阅 <a class="xref" href="../../fundamentals/environments.html#environment-based-startup-class-and-methods">在 ASP.NET Core 中使用多个环境</a>。</p>
<p>如果出现基架错误，请验证目标框架名字对象 (TFM) 是否与项目文件中的 NuGet 包版本相匹配。 例如，以下项目文件包含适用于 .NET Core 的版本 3.1 和所列的 NuGet 包：</p>
<pre><code class="lang-xml">&lt;Project Sdk=&quot;Microsoft.NET.Sdk.Web&quot;&gt;

  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;netcoreapp3.1&lt;/TargetFramework&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Identity.EntityFrameworkCore&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Identity.UI&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.EntityFrameworkCore.Design&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.EntityFrameworkCore.SqlServer&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.EntityFrameworkCore.Tools&quot; Version=&quot;3.1.0&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.VisualStudio.Web.CodeGeneration.Design&quot; Version=&quot;3.1.0&quot; /&gt;
  &lt;/ItemGroup&gt;

&lt;/Project&gt;
</code></pre>
<h3 id="add-a-database-context-class">添加数据库上下文类</h3>
<p>在 RazorPagesMovie 项目中，创建名为“数据”的新文件夹。 将以下 <code>RazorPagesMovieContext</code> 类添加到“Data”文件夹：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的代码为实体集创建 <code>DbSet</code> 属性。 在 Entity Framework 中，实体集通常与数据表相对应，具体实体与表中的行相对应。 直至在后续步骤中添加依赖项，代码才可编译。</p>
<p><a name="cs"></a></p>
<h3 id="add-a-database-connection-string">添加数据库连接字符串</h3>
<p>向 appsettings.json 文件添加一个连接字符串，如以下突出显示的代码所示：</p>
<div range="&gt;= aspnetcore-3.0">
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><a name="reg"></a></p>
<h3 id="register-the-database-context">注册数据库上下文</h3>
<p>将以下 <code>using</code> 语句添加到 Startup.cs 顶部：</p>
<pre><code class="lang-csharp">using RazorPagesMovie.Data;
using Microsoft.EntityFrameworkCore;
</code></pre>
<p>使用 <code>Startup.ConfigureServices</code> 中的<a class="xref" href="../../fundamentals/dependency-injection.html">依赖关系注入</a>容器注册数据库上下文。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></div>
<div range="&lt; aspnetcore-3.0">
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><h3 id="add-required-nuget-packages">添加所需的 NuGet 包</h3>
<p>运行以下 .NET Core CLI 命令，将 SQLite 和 CodeGeneration.Design 添加到项目中：</p>
<pre><code class="lang-dotnetcli">dotnet add package Microsoft.EntityFrameworkCore.SQLite
dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design
dotnet add package Microsoft.EntityFrameworkCore.Design
</code></pre>
<p><code>Microsoft.VisualStudio.Web.CodeGeneration.Design</code> 包对基架是必需的。</p>
<p><a name="reg"></a></p>
<h3 id="register-the-database-context">注册数据库上下文</h3>
<p>将以下 <code>using</code> 语句添加到 Startup.cs 顶部：</p>
<pre><code class="lang-csharp">using RazorPagesMovie.Models;
using Microsoft.EntityFrameworkCore;
</code></pre>
<p>使用 <code>Startup.ConfigureServices</code> 中的<a class="xref" href="../../fundamentals/dependency-injection.html">依赖关系注入</a>容器注册数据库上下文。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>生成项目以检查错误。</p>
</div>
</section>
<section id="tabpanel_CeZOj-G++Q-5_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<ul>
<li><p>在解决方案资源管理器中，右键单击“RazorPagesMovie”项目，然后选择“添加” &gt; “新建文件夹”  。 将文件夹命名为“Models”。</p>
</li>
<li><p>右键单击“Models”文件夹，然后选择“添加”&gt;“新建文件”。</p>
</li>
<li><p>在“新建文件”对话框中：</p>
<ul>
<li>在左侧窗格中，选择“常规”。</li>
<li>在中间窗格中，选择“空类”。</li>
<li>将此类命名为“Movie”，然后选择“新建”。</li>
</ul>
</li>
</ul>
<!-- THIS INCLUDE USED BY MVC AND RP -->
<p>向 <code>Movie</code> 类添加以下属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>Movie</code> 类包含：</p>
<ul>
<li><p>数据库需要 <code>ID</code> 字段以获取主键。</p>
</li>
<li><p><code>[DataType(DataType.Date)]</code>：<a href="xref:System.ComponentModel.DataAnnotations.DataTypeAttribute">DataType</a> 属性指定数据的类型（日期）。 通过此特性：</p>
<ul>
<li>用户无需在数据字段中输入时间信息。</li>
<li>仅显示日期，而非时间信息。</li>
</ul>
</li>
</ul>
<p><a href="/dotnet/api/system.componentmodel.dataannotations">DataAnnotations</a> 会在后续教程中介绍。</p>
</section>
</div>

<p>生成项目以验证没有任何编译错误。</p>
<h2 id="scaffold-the-movie-model">搭建“电影”模型的基架</h2>
<p>在此部分，将搭建“电影”模型的基架。 确切地说，基架工具将生成页面，用于对“电影”模型执行创建、读取、更新和删除 (CRUD) 操作。</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-6">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-6_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-6_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-6_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-6_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-6_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-6_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-6_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>创建“Pages/Movies”文件夹：</p>
<ul>
<li>右键单击“Pages”文件夹 &gt;“添加”&gt;“新建文件夹”。</li>
<li>将文件夹命名为“Movies”</li>
</ul>
<p>右键单击“Pages/Movies”文件夹 &gt;“添加”&gt;“新搭建基架的项目”。</p>
<p><img src="model/_static/sca.png" alt="上述说明的图像。"></p>
<p>在“添加基架”对话框中，依次选择“使用实体框架的 Razor 页面 (CRUD)”&gt;“添加”。</p>
<p><img src="model/_static/add_scaffold.png" alt="上述说明的图像。"></p>
<p>完成“添加使用实体框架的 Razor 页面 (CRUD)”对话框：</p>
<!-- In the next section, change 
(plus) sign and accept the generated name 
to use Data, it should not use models. That will make the namespace the same for the VS version and the CLI version
-->
<ul>
<li>在“模型类”下拉列表中，选择“Movie (RazorPagesMovie.Models)” 。</li>
<li>在“数据上下文类”行中，选择 +（加号）并接受生成的名称“RazorPagesMovie.Models.RazorPagesMovieContext”  。</li>
<li>选择“添加”。</li>
</ul>
<p><img src="model/_static/arp.png" alt="上述说明的图像。"></p>
<p>appsettings.json 文件通过用于连接到本地数据的连接字符串进行更新。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-6_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">
<!--  Until https://github.com/aspnet/Scaffolding/issues/582 is fixed windows needs backslash or the namespace is namespace RazorPagesMovie.Pages_Movies rather than namespace RazorPagesMovie.Pages.Movies
-->
<ul>
<li><p>打开项目目录（包含 Program.cs、Startup.cs 和 .csproj 文件的目录）中的命令窗口。</p>
</li>
<li><p><strong>对于 Windows</strong>：运行下面的命令：</p>
<pre><code class="lang-dotnetcli">dotnet aspnet-codegenerator razorpage -m Movie -dc RazorPagesMovieContext -udl -outDir Pages\Movies --referenceScriptLibraries
</code></pre>
</li>
<li><p><strong>对于 macOS 和 Linux</strong>：运行下面的命令：</p>
<pre><code class="lang-dotnetcli">dotnet aspnet-codegenerator razorpage -m Movie -dc RazorPagesMovieContext -udl -outDir Pages/Movies --referenceScriptLibraries
</code></pre>
</li>
</ul>
<p><a name="codegenerator"></a> 下表详细说明了 ASP.NET Core 代码生成器参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>-m</td>
<td>模型的名称。</td>
</tr>
<tr>
<td>-dc</td>
<td>要使用的 <code>DbContext</code> 类。</td>
</tr>
<tr>
<td>-udl</td>
<td>使用默认布局。</td>
</tr>
<tr>
<td>-outDir</td>
<td>用于创建视图的相对输出文件夹路径。</td>
</tr>
<tr>
<td>--referenceScriptLibraries</td>
<td>向“编辑”和“创建”页面添加 <code>_ValidationScriptsPartial</code></td>
</tr>
</tbody>
</table>
<p>使用 <code>h</code> 开关获取 <code>aspnet-codegenerator razorpage</code> 命令方面的帮助：</p>
<pre><code class="lang-dotnetcli">dotnet aspnet-codegenerator razorpage -h
</code></pre>
<p>有关详细信息，请查看 <a class="xref" href="../../fundamentals/tools/dotnet-aspnet-codegenerator.html">dotnet aspnet-codegenerator</a>。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-6_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<p>创建“Pages/Movies”文件夹：</p>
<ul>
<li>右键单击“Pages”文件夹 &gt;“添加”&gt;“新建文件夹”。</li>
<li>将文件夹命名为“Movies”</li>
</ul>
<p>右键单击“Pages/Movies”文件夹 &gt;“添加”&gt;“新搭建基架的项目”。</p>
<p><img src="model/_static/scaMac.png" alt="上述说明的图像。"></p>
<p>在“添加新基架”对话框中，依次选择“使用实体框架的 Razor 页面 (CRUD)”&gt;“添加”。</p>
<p><img src="model/_static/add_scaffoldMac.png" alt="上述说明的图像。"></p>
<p>完成“添加使用实体框架的 Razor 页面 (CRUD)”对话框：</p>
<ul>
<li>在“模型类”下拉列表中，选择或键入“Movie” 。</li>
<li>在“数据上下文类”行中，键入或选择“RazorPagesMovieContext”，这将创建一个具有正确命名空间的新数据库上下文类 。 在此示例中为“RazorPagesMovie.Models.RazorPagesMovieContext”。</li>
<li>选择“添加”。</li>
</ul>
<p><img src="model/_static/arpMac.png" alt="上述说明的图像。"></p>
<p>appsettings.json 文件通过用于连接到本地数据的连接字符串进行更新。</p>
</section>
</div>

<p>在搭建基架时，会创建并更新以下文件：</p>
<h3 id="files-created">创建的文件</h3>
<ul>
<li><em>Pages/Movies</em>：“创建”、“删除”、“详细信息”、“编辑”和“索引”。</li>
<li>Data/RazorPagesMovieContext.cs</li>
</ul>
<h3 id="file-updated">文件已更新</h3>
<ul>
<li><em>Startup.cs</em></li>
</ul>
<p>创建和更新的文件将在下一节中说明。</p>
<p><a name="pmc"></a></p>
<h2 id="initial-migration">初始迁移</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-7">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-7_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-7_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-7_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-7_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-7_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-7_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-7_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>在此部分中，程序包管理器控制台 (PMC) 用于：</p>
<ul>
<li>添加初始迁移。</li>
<li>使用初始迁移来更新数据库。</li>
</ul>
<p>从“工具”菜单中，选择“NuGet 包管理器”&gt;“包管理器控制台” 。</p>
<p><img src="../first-mvc-app/adding-model/_static/pmc.png" alt="PMC 菜单"></p>
<p>在 PMC 中，输入以下命令：</p>
<pre><code class="lang-powershell">Add-Migration Initial
Update-Database
</code></pre>
<p><code>Add-Migration</code> 命令生成用于创建初始数据库架构的代码。 此架构的依据为 <code>DbContext</code> 中指定的模型（在 RazorPagesMovieContext.cs 文件中）。 <code>InitialCreate</code> 参数用于为迁移命名。 可以使用任何名称，但是按照惯例，会使用可说明迁移的名称。 有关详细信息，请参阅 <a class="xref" href="../../data/ef-mvc/migrations.html">教程：使用迁移功能 - ASP.NET MVC 和 EF Core</a>。</p>
<p><code>Update-Database</code> 命令在 Migrations/&lt;time-stamp&gt;_InitialCreate.cs 文件中运行 <code>Up</code> 方法。 <code>Up</code> 方法会创建数据库。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-7_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">
<p>如果尚未 <code>dotnet ef</code> 安装，请将其安装为全局工具：</p>
<pre><code class="lang-dotnetcli">  dotnet tool install --global dotnet-ef
</code></pre>
<p>有关 EF Core 的 CLI 的详细信息，请参阅 <a href="/ef/core/miscellaneous/cli/dotnet">.Net CLI 的 EF Core 工具引用</a>。</p>

<p>运行以下 .NET Core CLI 命令：</p>
<pre><code class="lang-dotnetcli">dotnet ef migrations add InitialCreate
dotnet ef database update
</code></pre>
</section>
<section id="tabpanel_CeZOj-G++Q-7_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">
<p>如果尚未 <code>dotnet ef</code> 安装，请将其安装为全局工具：</p>
<pre><code class="lang-dotnetcli">  dotnet tool install --global dotnet-ef
</code></pre>
<p>有关 EF Core 的 CLI 的详细信息，请参阅 <a href="/ef/core/miscellaneous/cli/dotnet">.Net CLI 的 EF Core 工具引用</a>。</p>

<p>运行以下 .NET Core CLI 命令：</p>
<pre><code class="lang-dotnetcli">dotnet ef migrations add InitialCreate
dotnet ef database update
</code></pre>
</section>
</div>

<div class="NOTE">
<h5>Note</h5>
<p>前面的命令生成以下警告：&quot;<em>No type was specified for the decimal column 'Price' on entity type 'Movie'.This will cause values to be silently truncated if they do not fit in the default precision and scale.Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'.</em> &quot; 你可以忽略该警告，它将后面的教程中得到修复。</p>
</div>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-8">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-8_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-8_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-8_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-8_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-8_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-8_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-8_visual-studio" role="tabpanel" data-tab="visual-studio">
<h3 id="examine-the-context-registered-with-dependency-injection">检查通过依赖关系注入注册的上下文</h3>
<p>ASP.NET Core 通过<a class="xref" href="../../fundamentals/dependency-injection.html">依赖关系注入</a>进行生成。 服务（例如 EF Core 数据库上下文）在应用程序启动期间通过依赖关系注入进行注册。 需要这些服务（如 Razor 页面）的组件通过构造函数参数提供相应服务。 本教程的后续部分介绍了用于获取 DB 上下文实例的构造函数代码。</p>
<p>基架工具自动创建 DB 上下文并将其注册到依赖关系注入容器。</p>
<p>检查 <code>Startup.ConfigureServices</code> 方法。 基架添加了突出显示的行：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>RazorPagesMovieContext</code> 为 <code>Movie</code> 模型协调 EF Core 功能（创建、读取、更新、删除等）。 数据上下文 (<code>RazorPagesMovieContext</code>) 派生自 <a href="/dotnet/api/microsoft.entityframeworkcore.dbcontext">Microsoft.EntityFrameworkCore.DbContext</a>。 数据上下文指定数据模型中包含哪些实体。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的代码为实体集创建 <a href="/dotnet/api/microsoft.entityframeworkcore.dbset-1">DbSet&lt;Movie&gt;</a> 属性。 在实体框架术语中，实体集通常与数据表相对应。 实体对应表中的行。</p>
<p>通过调用 <a href="/dotnet/api/microsoft.entityframeworkcore.dbcontextoptions">DbContextOptions</a> 对象中的一个方法将连接字符串名称传递到上下文。 进行本地开发时， <a class="xref" href="../../fundamentals/configuration/index.html">ASP.NET Core 配置系统</a> 在 <em>appsettings.json</em> 文件中读取数据库连接字符串。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-8_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<p>检查 <code>Up</code> 方法。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-8_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<p>检查 <code>Up</code> 方法。</p>
</section>
</div>

<p><a name="test"></a></p>
<h3 id="test-the-app">测试应用</h3>
<ul>
<li>运行应用并将 <code>/Movies</code> 追加到浏览器中的 URL (<code>http://localhost:port/movies</code>)。</li>
</ul>
<p>如果收到错误：</p>
<pre><code class="lang-console">SqlException: Cannot open database &quot;RazorPagesMovieContext-GUID&quot; requested by the login. The login failed.
Login failed for user 'User-name'.
</code></pre>
<p>缺少<a href="#pmc">迁移步骤</a>。</p>
<ul>
<li><p>测试“创建”链接。</p>
<p><img src="model/_static/conan.png" alt="创建页面"></p>
<div class="NOTE">
<h5>Note</h5>
<p>可能无法在 <code>Price</code> 字段中输入十进制逗号。 若要使 <a href="https://jqueryvalidation.org/">jQuery 验证</a>支持使用逗号（“,”）表示小数点的非英语区域设置，以及支持非美国英语日期格式，应用必须进行全球化。 有关全球化的说明，请参阅<a href="https://github.com/dotnet/AspNetCore.Docs/issues/4076#issuecomment-326590420">此 GitHub 问题</a>。</p>
</div>
</li>
<li><p>测试“编辑”、“详细信息”和“删除”链接。</p>
</li>
</ul>
<p>下一个教程介绍由基架创建的文件。</p>
<h2 id="additional-resources">其他资源</h2>
<div class="step-by-step">
<p><a class="xref" href="razor-pages-start.html">上一篇：入门</a>
<a class="xref" href="page.html">下一篇：基架 Razor Pages</a></p>
</div>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
