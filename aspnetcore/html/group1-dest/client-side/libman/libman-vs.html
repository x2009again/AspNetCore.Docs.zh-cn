<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#22312; Visual Studio &#20013;&#23558; LibMan &#19982; ASP.NET Core &#37197;&#21512;&#20351;&#29992; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#22312; Visual Studio &#20013;&#23558; LibMan &#19982; ASP.NET Core &#37197;&#21512;&#20351;&#29992; ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="client-side/libman/libman-vs">
<h1 id="use-libman-with-aspnet-core-in-visual-studio">在 Visual Studio 中将 LibMan 与 ASP.NET Core 配合使用</h1>

<p>作者：<a href="https://twitter.com/Scott_Addie">Scott Addie</a></p>
<p>Visual Studio 对 ASP.NET Core 项目中的 <a class="xref" href="index.html">LibMan</a> 提供内置支持，包括：</p>
<ul>
<li>支持在生成时配置和运行 LibMan 还原操作。</li>
<li>用于触发 LibMan 还原和清理操作的菜单项。</li>
<li>用于查找库并将文件添加到项目的搜索对话框。</li>
<li>编辑对 libman.json（LibMan 清单文件）的支持。</li>
</ul>
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/client-side/libman/samples/">查看或下载示例代码</a><a class="xref" href="../../introduction-to-aspnet-core.html#how-to-download-a-sample">（如何下载）</a></p>
<h2 id="prerequisites">先决条件</h2>
<ul>
<li><a href="https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&amp;utm_source=docs.microsoft.com&amp;utm_campaign=inline+link&amp;utm_content=download+vs2019">Visual Studio 2019</a> 与 ASP.NET 和 Web 开发工作负载</li>
</ul>
<h2 id="add-library-files">添加库文件</h2>
<p>可以通过两种不同的方式将库文件添加到 ASP.NET Core 项目中：</p>
<ol>
<li><a href="#use-the-add-client-side-library-dialog">使用“添加客户端库”对话框</a></li>
<li><a href="#manually-configure-libman-manifest-file-entries">手动配置 LibMan 清单文件项</a></li>
</ol>
<h3 id="use-the-add-client-side-library-dialog">使用“添加客户端库”对话框</h3>
<p>按照以下步骤安装客户端库：</p>
<ul>
<li><p>在“解决方案资源管理器”中，右键单击要在其中添加文件的项目文件夹。 选择“添加” &gt; “客户端库” 。 此时将显示“添加客户端库”对话框：</p>
<p><img src="_static/add-library-dialog.png" alt="“添加客户端库”对话框"></p>
</li>
<li><p>从“提供程序”下拉列表中选择库提供程序。 CDNJS 是默认提供程序。</p>
</li>
<li><p>在“库”文本框中键入要提取的库名称。 IntelliSense 提供以所提供文本开头的库的列表。</p>
</li>
<li><p>从 IntelliSense 列表中选择库。 请注意，库名称后缀带有 <code>@</code> 符号和所选提供程序的已知最新稳定版本。</p>
</li>
<li><p>确定要包含的文件：</p>
<ul>
<li>选择“包含所有库文件”单选按钮以包含所有库文件。</li>
<li>选择“选择特定文件”单选按钮以包含库文件的子集。 选中此单选按钮后，将启用文件选择器树。 选中要下载的文件名左侧的框。</li>
</ul>
</li>
<li><p>在“目标位置”文本框中指定项目文件夹以存储文件。 建议将每个库存储在单独的文件夹中。</p>
<p>建议的“目标位置”文件夹基于启动对话框的位置：</p>
<ul>
<li>如果从项目根启动：
<ul>
<li>如果 wwwroot 存在，则使用 wwwroot/lib 。</li>
<li>如果 wwwroot 不存在，则使用 lib 。</li>
</ul>
</li>
<li>如果从项目文件夹启动，则使用相应的文件夹名称。</li>
</ul>
<p>文件夹建议带有库名称后缀。 下表说明了在 Razor Pages 项目中安装 jQuery 时的文件夹建议。</p>
<table>
<thead>
<tr>
<th>启动位置</th>
<th>建议的文件夹</th>
</tr>
</thead>
<tbody>
<tr>
<td>项目根（如果 wwwroot 存在）</td>
<td>wwwroot/lib/jquery/</td>
</tr>
<tr>
<td>项目根（如果 wwwroot 不存在）</td>
<td>lib/jquery/</td>
</tr>
<tr>
<td>项目中的 Pages 文件夹</td>
<td>Pages/jquery/</td>
</tr>
</tbody>
</table>
</li>
<li><p>单击“安装”按钮，根据 libman.json 中的配置下载文件。</p>
</li>
<li><p>有关安装详细信息，请查看“输出”窗口的“库管理器”源 。 例如：</p>
<pre><code class="lang-console">Restore operation started...
Restoring libraries for project LibManSample
Restoring library jquery@3.3.1... (LibManSample)
wwwroot/lib/jquery/jquery.min.js written to destination (LibManSample)
wwwroot/lib/jquery/jquery.js written to destination (LibManSample)
wwwroot/lib/jquery/jquery.min.map written to destination (LibManSample)
Restore operation completed
1 libraries restored in 2.32 seconds
</code></pre>
</li>
</ul>
<h3 id="manually-configure-libman-manifest-file-entries">手动配置 LibMan 清单文件项</h3>
<p>Visual Studio 中的所有 LibMan 操作都基于项目根的 LibMan 清单 (libman.json) 的内容。 可以手动编辑 libman.json，以配置项目的库文件。 保存 libman.json 后，Visual Studio 将还原所有库文件。</p>
<p>若要打开 libman.json 进行编辑，可以选择以下选项：</p>
<ul>
<li>在“解决方案资源管理器”中双击 libman.json 文件。</li>
<li>右键单击“解决方案资源管理器”中的项目，然后选择“管理客户端库” 。 †</li>
<li>从 Visual Studio“项目”菜单中选择“管理客户端库” 。 †</li>
</ul>
<p>† 如果项目根中不存在 libman.json 文件，则将使用默认项模板内容创建该文件。</p>
<p>Visual Studio 提供丰富的 JSON 编辑支持，如着色、格式设置、IntelliSense 和架构验证。 LibMan 清单的 JSON 架构位于 <a href="https://json.schemastore.org/libman">https://json.schemastore.org/libman</a>。</p>
<p>对于下面的清单文件，LibMan 根据 <code>libraries</code> 属性中定义的配置检索文件。 <code>libraries</code> 中定义的对象文字的说明如下所示：</p>
<ul>
<li>从 CDNJS 提供程序检索 <a href="https://jquery.com/">jQuery</a> 版本 3.3.1 的子集。 子集在 <code>files</code> 属性中定义—jquery node.js、jquery.js 和 jquery.min.map  。 文件位于项目的 wwwroot/lib/jquery 文件夹中。</li>
<li>检索整个<a href="https://getbootstrap.com/">启动</a>版本 4.1.3，并放入 wwwroot/lib/bootstrap 文件夹中。 对象文字的 <code>provider</code> 属性将覆盖 <code>defaultProvider</code> 属性值。 LibMan 从 unpkg 提供程序检索启动文件。</li>
<li>组织内的管理正文已批准 <a href="https://lodash.com/">Lodash</a> 的子集。 从本地文件系统 C:\temp\lodash\ 检索 lodash.js 和 lodash.min.js 文件  。 文件将复制到项目的 wwwroot/lib/lodash 文件夹中。</li>
</ul>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<div class="NOTE">
<h5>Note</h5>
<p>LibMan 仅支持每个提供程序的每个库的一个版本。 如果 libman.json 文件包含两个库，并且库名称与给定提供程序的库名称相同，则架构验证失败。</p>
</div>
<h2 id="restore-library-files">还原库文件</h2>
<p>若要从 Visual Studio 中还原库文件，项目根中必须有一个有效的 libman.json 文件。 还原的文件放置在项目中每个库指定的位置。</p>
<p>可以通过两种方式在 ASP.NET Core 项目中还原库文件：</p>
<ol>
<li><a href="#restore-files-during-build">在生成过程中还原文件</a></li>
<li><a href="#restore-files-manually">手动还原文件</a></li>
</ol>
<h3 id="restore-files-during-build">在生成过程中还原文件</h3>
<p>LibMan 可以在生成过程中还原定义的库文件。 默认情况下，禁用 restore-on-build 行为。</p>
<p>启用和测试 restore-on-build 行为：</p>
<ul>
<li><p>右键单击“解决方案资源管理器”中的 libman.json，然后从上下文菜单中选择“生成时启用还原客户端库” 。</p>
</li>
<li><p>系统提示安装 NuGet 包时，单击“是”按钮。 将 <a href="https://www.nuget.org/packages/Microsoft.Web.LibraryManager.Build/">Microsoft.Web.LibraryManager.Build</a> NuGet 包添加到项目中：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
<li><p>生成项目以确认 LibMan 文件已还原。 <code>Microsoft.Web.LibraryManager.Build</code> 包将插入在项目的生成操作期间运行 LibMan 的 MSBuild 目标。</p>
</li>
<li><p>查看 LibMan 活动日志“输出”窗口的“生成”源 ：</p>
<pre><code class="lang-console">1&gt;------ Build started: Project: LibManSample, Configuration: Debug Any CPU ------
1&gt;
1&gt;Restore operation started...
1&gt;Restoring library jquery@3.3.1...
1&gt;Restoring library bootstrap@4.1.3...
1&gt;
1&gt;2 libraries restored in 10.66 seconds
1&gt;LibManSample -&gt; C:\LibManSample\bin\Debug\netcoreapp2.1\LibManSample.dll
========== Build: 1 succeeded, 0 failed, 0 up-to-date, 0 skipped ==========
</code></pre>
</li>
</ul>
<p>当启用 restore-on-build 行为时，libman.json 上下文菜单将显示“生成时禁用还原客户端库”选项。 选择此选项将从项目文件中删除 <code>Microsoft.Web.LibraryManager.Build</code> 包引用。 因此，在每次生成时将不再还原客户端库。</p>
<p>无论 restore-on-build 设置如何，都可以随时从 libman.json 上下文菜单中手动进行还原。 有关详细信息，请参阅<a href="#restore-files-manually">还原文件</a>。</p>
<h3 id="restore-files-manually">手动还原文件</h3>
<p>手动还原库文件：</p>
<ul>
<li>对于解决方案中的所有项目：
<ul>
<li>右键单击“解决方案资源管理器”中的解决方案名称。</li>
<li>选择“还原客户端库”选项。</li>
</ul>
</li>
<li>对于特定项目：
<ul>
<li>右键单击“解决方案资源管理器”中的 libman.json 文件。</li>
<li>选择“还原客户端库”选项。</li>
</ul>
</li>
</ul>
<p>正在运行还原操作时：</p>
<ul>
<li><p>将对 Visual Studio 状态栏上的任务状态中心 (TSC) 图标进行动画处理，并将显示“已启动还原操作”。 单击该图标将打开一个工具提示，其中列出了已知的后台任务。</p>
</li>
<li><p>消息将发送到状态栏和“输出”窗口的“库管理器”源 。 例如：</p>
<pre><code class="lang-console">Restore operation started...
Restoring libraries for project LibManSample
Restoring library jquery@3.3.1... (LibManSample)
wwwroot/lib/jquery/jquery.min.js written to destination (LibManSample)
wwwroot/lib/jquery/jquery.js written to destination (LibManSample)
wwwroot/lib/jquery/jquery.min.map written to destination (LibManSample)
Restore operation completed
1 libraries restored in 2.32 seconds
</code></pre>
</li>
</ul>
<h2 id="delete-library-files">删除库文件</h2>
<p>执行清理操作，该操作将删除之前在 Visual Studio 中还原的库文件：</p>
<ul>
<li>右键单击“解决方案资源管理器”中的 libman.json 文件。</li>
<li>选择“清理客户端库”选项。</li>
</ul>
<p>为防止意外删除非库文件，清理操作不会删除整个目录。 它仅删除先前还原中包含的文件。</p>
<p>正在运行清理操作时：</p>
<ul>
<li>将对 Visual Studio 状态栏上的 TSC 图标进行动画处理，并将显示“已启动客户端库操作”。 单击该图标将打开一个工具提示，其中列出了已知的后台任务。</li>
<li>将消息发送到状态栏和“输出”窗口的“库管理器”源 。 例如：</li>
</ul>
<pre><code class="lang-console">Clean libraries operation started...
Clean libraries operation completed
2 libraries were successfully deleted in 1.91 secs
</code></pre>
<p>清理操作仅从项目中删除文件。 库文件保留在缓存中，以便在将来的还原操作中更快地检索。 若要管理存储在本地计算机缓存中的库文件，请使用 <a class="xref" href="libman-cli.html">LibMan CLI</a>。</p>
<h2 id="uninstall-library-files">卸载库文件</h2>
<p>卸载库文件：</p>
<ul>
<li><p>打开 libman.json。</p>
</li>
<li><p>将插入符号置于相应的 <code>libraries</code> 对象文字内。</p>
</li>
<li><p>单击左边距中显示的灯泡图标，然后选择“卸载 &lt;library_name&gt;@&lt;library_version&gt;”：</p>
<p><img src="_static/uninstall-menu-option.png" alt="卸载库上下文菜单选项"></p>
</li>
</ul>
<p>或者可以手动编辑并保存 LibMan 清单 (libman.json)。 保存文件后将运行<a href="#restore-library-files">还原操作</a>。 libman.json 中不再定义的库文件将从项目中删除。</p>
<h2 id="update-library-version">更新库版本</h2>
<p>检查更新的库版本：</p>
<ul>
<li>打开 libman.json。</li>
<li>将插入符号置于相应的 <code>libraries</code> 对象文字内。</li>
<li>单击左边距中显示的灯泡图标。 将鼠标悬停在“检查更新”上。</li>
</ul>
<p>LibMan 检查库版本是否比安装的版本更新。 可能出现以下结果：</p>
<ul>
<li><p>如果已安装最新版本，则不会显示“找不到更新”消息。</p>
</li>
<li><p>如果尚未安装，则会显示最新的稳定版本。</p>
<p><img src="_static/update-menu-option.png" alt="检查更新上下文菜单选项"></p>
</li>
<li><p>如果有比已安装版本更新的预发行版可用，则会显示该预发行版。</p>
</li>
</ul>
<p>若要降级到较旧的库版本，请手动编辑 libman.json 文件。 保存文件后，LibMan <a href="#restore-library-files">还原操作</a>将执行以下操作：</p>
<ul>
<li>删除先前版本中的冗余文件。</li>
<li>从新版本添加新文件和更新文件。</li>
</ul>
<h2 id="additional-resources">其他资源</h2>
<ul>
<li><a class="xref" href="libman-cli.html">将 LibMan CLI 与 ASP.NET Core 结合使用</a></li>
<li><a href="https://github.com/aspnet/LibraryManager">LibMan GitHub 存储库</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
