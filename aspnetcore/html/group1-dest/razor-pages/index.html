<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ASP.NET Core &#20013;&#30340; Razor Pages &#20171;&#32461; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ASP.NET Core &#20013;&#30340; Razor Pages &#20171;&#32461; ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="razor-pages/index">
<h1 id="introduction-to-no-locrazor-pages-in-aspnet-core">ASP.NET Core 中的 Razor Pages 介绍</h1>

<div range="&gt;= aspnetcore-3.0">
<p>作者：<a href="https://twitter.com/RickAndMSFT">Rick Anderson</a> 和 <a href="https://github.com/rynowak">Ryan Nowak</a></p>
<p>通过 Razor Pages 对基于页面的场景编码比使用控制器和视图更轻松、更高效。</p>
<p>若要查找使用模型视图控制器方法的教程，请参阅 <a class="xref" href="../tutorials/first-mvc-app/start-mvc.html">ASP.NET Core MVC 入门</a>。</p>
<p>本文档介绍 Razor Pages。 它并不是分步教程。 如果认为某些部分过于复杂，请参阅 <a class="xref" href="../tutorials/razor-pages/razor-pages-start.html">Razor Pages 入门</a>。 有关 ASP.NET Core 的概述，请参阅 <a class="xref" href="../introduction-to-aspnet-core.html">ASP.NET Core 简介</a>。</p>
<h2 id="prerequisites">先决条件</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_visual-studio" role="tabpanel" data-tab="visual-studio">
<ul>
<li>带有 ASP.NET 和 Web 开发工作负荷的 <a href="https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&amp;utm_source=docs.microsoft.com&amp;utm_campaign=inline+link&amp;utm_content=download+vs2019">Visual Studio 2019</a></li>
<li><p><a href="https://dotnet.microsoft.com/download/dotnet-core/3.0">.NET Core 3.0 SDK 或更高版本</a></p>
</li>
</ul>
</section>
<section id="tabpanel_CeZOj-G++Q_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">
<ul>
<li><a href="https://code.visualstudio.com/download">Visual Studio Code</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp">用于 Visual Studio Code 的 C#（最新版本）</a></li>
<li><p><a href="https://dotnet.microsoft.com/download/dotnet-core/3.0">.NET Core 3.0 SDK 或更高版本</a></p>
</li>
</ul>
<p>Visual Studio Code 说明使用用于 ASP.NET Core 的 .NET Core CLI 开发功能，如项目创建。 可在任何平台（macOS、Linux 或 Windows）上或在任何代码编辑器中遵循这些说明。 如果使用 Visual Studio Code 以外的其他内容，则可能需要进行少量更改。</p>
</section>
<section id="tabpanel_CeZOj-G++Q_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">
<ul>
<li><a href="https://visualstudio.microsoft.com/vs/mac/">Visual Studio for Mac 版本 8.0 或更高版本</a></li>
<li><p><a href="https://dotnet.microsoft.com/download/dotnet-core/3.0">.NET Core 3.0 SDK 或更高版本</a></p>
</li>
</ul>
</section>
</div>

<p><a name="rpvs17"></a></p>
<h2 id="create-a-no-locrazor-pages-project">创建 Razor Pages 项目</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>请参阅 <a class="xref" href="../tutorials/razor-pages/razor-pages-start.html">Razor Pages 入门</a>，获取关于如何创建 Razor Pages 项目的详细说明。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<p>在命令行中运行 <code>dotnet new webapp</code>。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<p>请参阅 <a class="xref" href="../tutorials/razor-pages/razor-pages-start.html">Razor Pages 入门</a>，获取关于如何创建 Razor Pages 项目的详细说明。</p>
</section>
</div>
<h2 id="no-locrazor-pages">Razor Pages</h2>
<p>Startup.cs 中已启用 Razor 页面：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>请考虑一个基本页面：<a name="OnGet"></a></p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的代码与具有控制器和视图的 ASP.NET Core 应用中使用的 <a class="xref" href="../tutorials/first-mvc-app/adding-view.html">Razor 视图文件</a>非常相似。 不同之处在于 <a class="xref" href="../mvc/views/razor.html#page"><code>@page</code></a> 指令。 <code>@page</code> 使文件转换为一个 MVC 操作 ，这意味着它将直接处理请求，而无需通过控制器处理。 <code>@page</code> 必须是页面上的第一个 Razor 指令。 <code>@page</code> 会影响其他的 <a class="xref" href="../mvc/views/razor.html">Razor</a> 构造。 Razor Pages 文件名有 .cshtml 后缀。</p>
<p>将在以下两个文件中显示使用 <code>PageModel</code> 类的类似页面。 Pages/Index2.cshtml 文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/Index2.cshtml.cs 页面模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>按照惯例，<code>PageModel</code> 类文件的名称与追加 .cs 的 Razor Page 文件名称相同。 例如，前面的 Razor Page 的名称为 Pages/Index2.cshtml。 包含 <code>PageModel</code> 类的文件的名称为 Pages/Index2.cshtml.cs。</p>
<p>页面的 URL 路径的关联由页面在文件系统中的位置决定。 下表显示了 Razor Page 路径及匹配的 URL：</p>
<table>
<thead>
<tr>
<th>文件名和路径</th>
<th>匹配的 URL</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>/Pages/Index.cshtml</em></td>
<td><code>/</code> 或 <code>/Index</code></td>
</tr>
<tr>
<td><em>/Pages/Contact.cshtml</em></td>
<td><code>/Contact</code></td>
</tr>
<tr>
<td><em>/Pages/Store/Contact.cshtml</em></td>
<td><code>/Store/Contact</code></td>
</tr>
<tr>
<td><em>/Pages/Store/Index.cshtml</em></td>
<td><code>/Store</code> 或 <code>/Store/Index</code></td>
</tr>
</tbody>
</table>
<p>注意：</p>
<ul>
<li>默认情况下，运行时在“Pages”文件夹中查找 Razor Pages 文件。</li>
<li>URL 未包含页面时，<code>Index</code> 为默认页面。</li>
</ul>
<h2 id="write-a-basic-form">编写基本窗体</h2>
<p>由于 Razor Pages 的设计，在构建应用时可轻松实施用于 Web 浏览器的常用模式。 <a class="xref" href="../mvc/models/model-binding.html">模型绑定</a>、<a class="xref" href="../mvc/views/tag-helpers/intro.html">标记帮助程序</a>和 HTML 帮助程序均只可用于 Razor Page 类中定义的属性。 请参考为 <code>Contact</code> 模型实现的基本的“联系我们”窗体页面：</p>
<p>在本文档中的示例中，<code>DbContext</code> 在 <a href="https://github.com/dotnet/AspNetCore.Docs/blob/master/aspnetcore/razor-pages/index/3.0sample/RazorPagesContacts/Startup.cs#L23-L24">Startup.cs</a> 文件中进行初始化。</p>
<p>内存中数据库需要 <code>Microsoft.EntityFrameworkCore.InMemory</code> NuGet 包。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>数据模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>数据库上下文：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/Create.cshtml 视图文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/Create.cshtml.cs 页面模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>按照惯例，<code>PageModel</code> 类命名为 <code>&lt;PageName&gt;Model</code>并且它与页面位于同一个命名空间中。</p>
<p>使用 <code>PageModel</code> 类，可以将页面的逻辑与其展示分离开来。 它定义了页面处理程序，用于处理发送到页面的请求和用于呈现页面的数据。 这种隔离可实现：</p>
<ul>
<li>通过<a class="xref" href="../fundamentals/dependency-injection.html">依赖关系注入</a>管理页面依赖项。</li>
<li><a class="xref" href="../test/razor-pages-tests.html">单元测试</a></li>
</ul>
<p>页面包含 <code>OnPostAsync</code> 处理程序方法，它在 <code>POST</code> 请求上运行（当用户发布窗体时）。 可以添加任何 HTTP 谓词的处理程序方法。 最常见的处理程序是：</p>
<ul>
<li><code>OnGet</code>，用于初始化页面所需的状态。 在上面的代码中，<code>OnGet</code> 方法显示 CreateModel.cshtml Razor Page。</li>
<li><code>OnPost</code>，用于处理窗体提交。</li>
</ul>
<p><code>Async</code> 命名后缀为可选，但是按照惯例通常会将它用于异步函数。 前面的代码通常用于 Razor Pages。</p>
<p>如果你熟悉使用控制器和视图的 ASP.NET 应用：</p>
<ul>
<li>前面示例中的 <code>OnPostAsync</code> 代码类似于典型的控制器代码。</li>
<li>大多数 MVC 基元（例如<a class="xref" href="../mvc/models/model-binding.html">模型绑定</a>、<a class="xref" href="../mvc/models/validation.html">验证</a>和操作结果）通过控制器和通过 Razor Pages 的运作方式相同。</li>
</ul>
<p>之前的 <code>OnPostAsync</code> 方法：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>OnPostAsync</code> 的基本流：</p>
<p>检查验证错误。</p>
<ul>
<li>如果没有错误，则保存数据并重定向。</li>
<li>如果有错误，则再次显示页面并附带验证消息。 很多情况下，都会在客户端上检测到验证错误，并且从不将它们提交到服务器。</li>
</ul>
<p>Pages/Create.cshtml 视图文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/Create.cshtml 中呈现的 HTML：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>在前面的代码中，发布窗体：</p>
<ul>
<li><p>对于有效数据：</p>
<ul>
<li><p><code>OnPostAsync</code> 处理程序方法调用 &lt;xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel.RedirectToPage*&gt; 帮助程序方法。 <code>RedirectToPage</code> 返回 &lt;xref:Microsoft.AspNetCore.Mvc.RedirectToPageResult&gt; 的实例。 <code>RedirectToPage</code>:</p>
<ul>
<li>是操作结果。</li>
<li>类似于 <code>RedirectToAction</code> 或 <code>RedirectToRoute</code>（用于控制器和视图）。</li>
<li>针对页面自定义。 在前面的示例中，它将重定向到根索引页 (<code>/Index</code>)。 <a href="#url_gen">页面 URL 生成</a>部分中详细介绍了 <code>RedirectToPage</code>。</li>
</ul>
</li>
</ul>
</li>
<li><p>对于传递给服务器的验证错误：</p>
<ul>
<li><code>OnPostAsync</code> 处理程序方法调用 &lt;xref:Microsoft.AspNetCore.Mvc.RazorPages.PageBase.Page*&gt; 帮助程序方法。 <code>Page</code> 返回 &lt;xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult&gt; 的实例。 返回 <code>Page</code> 的过程与控制器中的操作返回 <code>View</code> 的过程相似。 <code>PageResult</code> 是处理程序方法的默认返回类型。 返回 <code>void</code> 的处理程序方法将显示页面。</li>
<li>在前面的示例中，在 <a href="xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.IsValid">ModelState.IsValid</a> 中的值结果不返回 false 的情况下发布窗体。 在此示例中，客户端上不显示任何验证错误。 本文档的后面将介绍验证错误处理。</li>
</ul>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
<li><p>对于客户端验证检测到的验证错误：</p>
<ul>
<li>数据不会发布到服务器。</li>
<li>本文档的后面将介绍客户端验证。</li>
</ul>
</li>
</ul>
<p><code>Customer</code> 属性使用 <a href="xref:Microsoft.AspNetCore.Mvc.BindPropertyAttribute"><code>[BindProperty]</code></a> 特性来选择加入模型绑定：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>[BindProperty]</code> 不应 用于包含不应由客户端更改的属性的模型。 有关详细信息，请参阅<a class="xref" href="../data/ef-rp/crud.html#overposting">过度发布</a>。</p>
<p>Razor Pages 只绑定带有非 <code>GET</code> 谓词的属性。 如果绑定到属性，则无需通过编写代码将 HTTP 数据转换为模型类型。 绑定通过使用相同的属性显示窗体字段 (<code>&lt;input asp-for=&quot;Customer.Name&quot;&gt;</code>) 来减少代码，并接受输入。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>出于安全原因，必须选择绑定 <code>GET</code> 请求数据以对模型属性进行分页。 请在将用户输入映射到属性前对其进行验证。 当处理依赖查询字符串或路由值的方案时，选择加入 <code>GET</code> 绑定非常有用。</p>
<p>若要将属性绑定在 <code>GET</code> 请求上，请将 <a href="xref:Microsoft.AspNetCore.Mvc.BindPropertyAttribute"><code>[BindProperty]</code></a> 特性的 <code>SupportsGet</code> 属性设置为 <code>true</code>：</p>
<pre><code class="lang-csharp">[BindProperty(SupportsGet = true)]
</code></pre>
<p>有关详细信息，请参阅 <a href="https://www.youtube.com/watch?v=p7iHB9V-KVU&amp;feature=youtu.be&amp;t=54m27s">ASP.NET Core Community Standup:Bind on GET discussion (YouTube)</a>（绑定 GET 讨论）。</p>
</div>

<p>查看 Pages/Create.cshtml 视图文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<ul>
<li>在前面的代码中，<a class="xref" href="../mvc/views/working-with-forms.html#the-input-tag-helper">输入标记帮助程序</a> <code>&lt;input asp-for=&quot;Customer.Name&quot; /&gt;</code> 将 HTML <code>&lt;input&gt;</code> 元素绑定到 <code>Customer.Name</code> 模型表达式。</li>
<li>使用 <a class="xref" href="../mvc/views/tag-helpers/intro.html#addtaghelper-makes-tag-helpers-available"><code>@addTagHelper</code></a> 提供标记帮助程序。</li>
</ul>
<h3 id="the-home-page">主页</h3>
<p>Index.cshtml 是主页：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>关联的 <code>PageModel</code> 类 (Index.cshtml.cs)：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Index.cshtml 文件包含以下标记：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>&lt;a /a&gt;</code> <a class="xref" href="../mvc/views/tag-helpers/built-in/anchor-tag-helper.html">定位点标记帮助程序</a>使用 <code>asp-route-{value}</code> 属性生成“编辑”页面的链接。 此链接包含路由数据及联系人 ID。 例如 <code>https://localhost:5001/Edit/1</code>。 <a class="xref" href="../mvc/views/tag-helpers/intro.html">标记帮助程序</a>使服务器端代码可以在 Razor 文件中参与创建和呈现 HTML 元素。</p>
<p>Index.cshtml 文件包含用于为每个客户联系人创建删除按钮的标记：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>呈现的 HTML：</p>
<pre><code class="lang-html">&lt;button type=&quot;submit&quot; formaction=&quot;/Customers?id=1&amp;amp;handler=delete&quot;&gt;delete&lt;/button&gt;
</code></pre>
<p>删除按钮采用 HTML 呈现，其 <a href="https://developer.mozilla.org/docs/Web/HTML/Element/button#attr-formaction">formaction</a> 包括参数：</p>
<ul>
<li><code>asp-route-id</code> 属性指定的客户联系人 ID。</li>
<li><code>asp-page-handler</code> 属性指定的 <code>handler</code>。</li>
</ul>
<p>选中按钮时，向服务器发送窗体 <code>POST</code> 请求。 按照惯例，根据方案 <code>OnPost[handler]Async</code> 基于 <code>handler</code> 参数的值来选择处理程序方法的名称。</p>
<p>因为本示例中 <code>handler</code> 是 <code>delete</code>，因此 <code>OnPostDeleteAsync</code> 处理程序方法用于处理 <code>POST</code> 请求。 如果 <code>asp-page-handler</code> 设置为其他值（如 <code>remove</code>），则选择名称为 <code>OnPostRemoveAsync</code> 的处理程序方法。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>OnPostDeleteAsync</code> 方法：</p>
<ul>
<li>获取来自查询字符串的 <code>id</code>。</li>
<li>使用 <code>FindAsync</code> 查询客户联系人的数据库。</li>
<li>如果找到客户联系人，则会将其删除，并更新数据库。</li>
<li>调用 &lt;xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel.RedirectToPage*&gt;，重定向到根索引页 (<code>/Index</code>)。</li>
</ul>
<h3 id="the-editcshtml-file">Edit.cshtml 文件</h3>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>第一行包含 <code>@page &quot;{id:int}&quot;</code> 指令。 路由约束 <code>&quot;{id:int}&quot;</code> 告诉页面接受包含 <code>int</code> 路由数据的页面请求。 如果页面请求未包含可转换为 <code>int</code> 的路由数据，则运行时返回 HTTP 404（未找到）错误。 若要使 ID 可选，请将 <code>?</code> 追加到路由约束：</p>
<pre><code class="lang-cshtml">@page &quot;{id:int?}&quot;
</code></pre>
<p>Edit.cshtml.cs 文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><h2 id="validation">验证</h2>
<p>验证规则：</p>
<ul>
<li>在模型类中以声明方式指定。</li>
<li>在应用中的所有位置强制执行。</li>
</ul>
<p>&lt;xref:System.ComponentModel.DataAnnotations&gt; 命名空间提供一组内置验证特性，可通过声明方式应用于类或属性。 DataAnnotations 还包含 <a href="xref:System.ComponentModel.DataAnnotations.DataTypeAttribute"><code>[DataType]</code></a> 等格式特性，有助于格式设置但不提供任何验证。</p>
<p>请考虑 <code>Customer</code> 模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>使用以下 Create.cshtml 视图文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的代码：</p>
<ul>
<li><p>包括 jQuery 和 jQuery 验证脚本。</p>
</li>
<li><p>使用 <code>&lt;div /&gt;</code> 和 <code>&lt;span /&gt;</code> <a class="xref" href="../mvc/views/tag-helpers/intro.html">标记帮助程序</a>以实现：</p>
<ul>
<li>客户端验证。</li>
<li>验证错误呈现。</li>
</ul>
</li>
<li><p>则会生成以下 HTML：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
</ul>
<p>如果在不使用名称值的情况下发布“创建”窗体，则将显示错误消息“名称字段是必需的”。 窗体上。 如果客户端上已启用 JavaScript，浏览器会显示错误，而不会发布到服务器。</p>
<p><code>[StringLength(10)]</code> 特性在呈现的 HTML 上生成 <code>data-val-length-max=&quot;10&quot;</code>。 <code>data-val-length-max</code> 阻止浏览器输入超过指定最大长度的内容。 如果使用 <a href="https://www.telerik.com/fiddler">Fiddler</a> 等工具来编辑和重播文章：</p>
<ul>
<li>对于长度超过 10 的名称。</li>
<li>错误消息“字段名称必须是最大长度为 10 的字符串。” 将返回。</li>
</ul>
<p>考虑下列 <code>Movie</code> 模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>验证特性指定要对应用这些特性的模型属性强制执行的行为：</p>
<ul>
<li><p><code>Required</code> 和 <code>MinimumLength</code> 特性表示属性必须有值，但用户可输入空格来满足此验证。</p>
</li>
<li><p><code>RegularExpression</code> 特性用于限制可输入的字符。 在上述代码中，即“Genre”（分类）：</p>
<ul>
<li>只能使用字母。</li>
<li>第一个字母必须为大写。 不允许使用空格、数字和特殊字符。</li>
</ul>
</li>
<li><p><code>RegularExpression</code>“Rating”（分级）：</p>
<ul>
<li>要求第一个字符为大写字母。</li>
<li>允许在后续空格中使用特殊字符和数字。 “PG-13”对“分级”有效，但对于“分类”无效。</li>
</ul>
</li>
<li><p><code>Range</code> 特性将值限制在指定范围内。</p>
</li>
<li><p><code>StringLength</code> 特性可以设置字符串属性的最大长度，以及可选的最小长度。</p>
</li>
<li><p>从本质上来说，需要值类型（如 <code>decimal</code>、<code>int</code>、<code>float</code>、<code>DateTime</code>），但不需要 <code>[Required]</code> 特性。</p>
</li>
</ul>
<p><code>Movie</code> 模型的“创建”页面显示无效值错误：</p>
<p><img src="../tutorials/razor-pages/validation/_static/val.png" alt="带有多个 jQuery 客户端验证错误的电影视图表单"></p>
<p>有关详情，请参阅：</p>
<ul>
<li><a class="xref" href="../tutorials/razor-pages/validation.html">将验证添加到电影应用</a></li>
<li><a class="xref" href="../mvc/models/validation.html">ASP.NET Core 中的模型验证</a>.</li>
</ul>
<h2 id="handle-head-requests-with-an-onget-handler-fallback">使用 OnGet 处理程序回退来处理 HEAD 请求</h2>
<p><code>HEAD</code> 请求可检索特定资源的标头。 与 <code>GET</code> 请求不同，<code>HEAD</code> 请求不返回响应正文。</p>
<p>通常，针对 <code>HEAD</code> 请求创建和调用 <code>OnHead</code> 处理程序：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>如果未定义 <code>OnHead</code> 处理程序，则 Razor Pages 会回退到调用 <code>OnGet</code> 处理程序。</p>
<p><a name="xsrf"></a></p>
<h2 id="xsrfcsrf-and-no-locrazor-pages">XSRF/CSRF 和 Razor Pages</h2>
<p>Razor Pages 由 <a class="xref" href="../security/anti-request-forgery.html">防伪造验证</a>保护。 <a class="xref" href="../mvc/views/working-with-forms.html#the-form-tag-helper">FormTagHelper</a> 将防伪造令牌注入 HTML 窗体元素。</p>
<p><a name="layout"></a></p>
<h2 id="using-layouts-partials-templates-and-tag-helpers-with-no-locrazor-pages">将布局、分区、模板和标记帮助程序用于 Razor Pages</h2>
<p>页面可使用 Razor 视图引擎的所有功能。 布局、分区、模板、标记帮助程序、_ViewStart.cshtml 和 _ViewImports.cshtml 的工作方式与它们在传统的 Razor 视图中的工作方式相同。</p>
<p>让我们使用其中的一些功能来整理此页面。</p>
<p>向 Pages/Shared/_Layout.cshtml 添加<a class="xref" href="../mvc/views/layout.html">布局页面</a>：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><a class="xref" href="../mvc/views/layout.html">布局</a>：</p>
<ul>
<li>控制每个页面的布局（页面选择退出布局时除外）。</li>
<li>导入 HTML 结构，例如 JavaScript 和样式表。</li>
<li>调用 <code>@RenderBody()</code> 时，呈现 Razor Page 的内容。</li>
</ul>
<p>有关详细信息，请参阅<a class="xref" href="../mvc/views/layout.html">布局页面</a>。</p>
<p>在 Pages/_ViewStart.cshtml 中设置 <a class="xref" href="../mvc/views/layout.html#specifying-a-layout">Layout</a> 属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>布局位于“页面/共享”文件夹中。 页面按层次结构从当前页面的文件夹开始查找其他视图（布局、模板、分区）。 可以从“Pages”文件夹下的任意 Razor 页面使用“Pages/Shared”文件夹中的布局。</p>
<p>布局文件应位于 Pages/Shared 文件夹中。</p>
<p>建议不要将布局文件放在“视图/共享”文件夹中。 视图/共享 是一种 MVC 视图模式。 Razor Pages 旨在依赖文件夹层次结构，而非路径约定。</p>
<p>Razor Page 中的视图搜索包含“Pages”文件夹。 用于 MVC 控制器和传统 Razor 视图的布局、模板和分区可正常运行。</p>
<p>添加 Pages/_ViewImports.cshtml 文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>本教程的后续部分中将介绍 <code>@namespace</code>。 <code>@addTagHelper</code> 指令将<a class="xref" href="../mvc/views/tag-helpers/built-in/index.html">内置标记帮助程序</a>引入“页面”文件夹中的所有页面。</p>
<p><a name="namespace"></a></p>
<p>页面上设置的 <code>@namespace</code> 指令：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>@namespace</code> 指令将为页面设置命名空间。 <code>@model</code> 指令无需包含命名空间。</p>
<p>_ViewImports.cshtml 中包含 <code>@namespace</code> 指令后，指定的命名空间将为在导入 <code>@namespace</code> 指令的页面中生成的命名空间提供前缀。 生成的命名空间的剩余部分（后缀部分）是包含 _ViewImports.cshtml 的文件夹与包含页面的文件夹之间以点分隔的相对路径。</p>
<p>例如，<code>PageModel</code> 类 Pages/Customers/Edit.cshtml.cs 显式设置命名空间：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/_ViewImports.cshtml 文件设置以下命名空间：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>为 Pages/Customers/Edit.cshtml Razor Page 生成的命名空间与 <code>PageModel</code> 类相同。</p>
<p><code>@namespace</code>  <em>也适用于传统 Razor 视图。</em></p>
<p>考虑 Pages/Create.cshtml 视图文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>包含 _ViewImports.cshtml 的已更新的 Pages/Create.cshtml 视图文件和前面的布局文件 ：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>在前面的代码中，_ViewImports.cshtml 导入了命名空间和标记帮助程序。 布局文件导入了 JavaScript 文件。</p>
<p><a href="#rpvs17">Razor Pages 初学者项目</a>包含 Pages/_ValidationScriptsPartial.cshtml，它与客户端验证联合。</p>
<p>有关分部视图的详细信息，请参阅 <a class="xref" href="../mvc/views/partial.html">ASP.NET Core 中的分部视图</a>。</p>
<p><a name="url_gen"></a></p>
<h2 id="url-generation-for-pages">页面的 URL 生成</h2>
<p>之前显示的 <code>Create</code> 页面使用 <code>RedirectToPage</code>：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>应用具有以下文件/文件夹结构：</p>
<ul>
<li><p>/Pages</p>
<ul>
<li><p><em>Index.cshtml</em></p>
</li>
<li><p>Privacy.cshtml</p>
</li>
<li><p>/Customers</p>
<ul>
<li>Create.cshtml</li>
<li>Edit.cshtml</li>
<li><em>Index.cshtml</em></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>成功后，Pages/Customers/Create.cshtml and Pages/Customers/Edit.cshtml 页面将重定向到 Pages/Customers/Index.cshtml  。 字符串 <code>./Index</code> 是用于访问前一页的相对页名称。 它用于生成 <em>Pages/Customers/Index.cshtml</em> 页面的 URL。 例如：</p>
<ul>
<li><code>Url.Page(&quot;./Index&quot;, ...)</code></li>
<li><code>&lt;a asp-page=&quot;./Index&quot;&gt;Customers Index Page&lt;/a&gt;</code></li>
<li><code>RedirectToPage(&quot;./Index&quot;)</code></li>
</ul>
<p>绝对页名称 <code>/Index</code> 用于生成 <em>Pages/Index. cshtml</em> 页面的 URL。 例如：</p>
<ul>
<li><code>Url.Page(&quot;/Index&quot;, ...)</code></li>
<li><code>&lt;a asp-page=&quot;/Index&quot;&gt;Home Index Page&lt;/a&gt;</code></li>
<li><code>RedirectToPage(&quot;/Index&quot;)</code></li>
</ul>
<p>页面名称是从根“/Pages”文件夹到页面的路径（包含前导 <code>/</code>，例如 <code>/Index</code>）。 与硬编码 URL 相比，前面的 URL 生成示例提供了改进的选项和功能。 URL 生成使用<a class="xref" href="../mvc/controllers/routing.html">路由</a>，并且可以根据目标路径定义路由的方式生成参数并对参数编码。</p>
<p>页面的 URL 生成支持相对名称。 下表显示了 Pages/Customers/Create.cshtml 中不同的 <code>RedirectToPage</code> 参数选择的索引页。</p>
<table>
<thead>
<tr>
<th>RedirectToPage(x)</th>
<th>页面</th>
</tr>
</thead>
<tbody>
<tr>
<td>RedirectToPage(&quot;/Index&quot;)</td>
<td><em>Pages/Index</em></td>
</tr>
<tr>
<td>RedirectToPage(&quot;./Index&quot;);</td>
<td><em>Pages/Customers/Index</em></td>
</tr>
<tr>
<td>RedirectToPage(&quot;../Index&quot;)</td>
<td><em>Pages/Index</em></td>
</tr>
<tr>
<td>RedirectToPage(&quot;Index&quot;)</td>
<td><em>Pages/Customers/Index</em></td>
</tr>
</tbody>
</table>
<!-- Test via ~/razor-pages/index/3.0sample/RazorPagesContacts/Pages/Customers/Details.cshtml.cs -->
<p><code>RedirectToPage(&quot;Index&quot;)</code>、<code>RedirectToPage(&quot;./Index&quot;)</code> 和 <code>RedirectToPage(&quot;../Index&quot;)</code> 是相对名称。 结合<code>RedirectToPage</code> 参数与当前页的路径来计算目标页面的名称。</p>
<p>构建结构复杂的站点时，相对名称链接很有用。 如果使用相对名称链接文件夹中的页面：</p>
<ul>
<li>重命名文件夹不会破坏相对链接。</li>
<li>链接不会中断，因为它们不包含文件夹名称。</li>
</ul>
<p>若要重定向到不同<a class="xref" href="../mvc/controllers/areas.html">区域</a>中的页面，请指定区域：</p>
<pre><code class="lang-csharp">RedirectToPage(&quot;/Index&quot;, new { area = &quot;Services&quot; });
</code></pre>
<p>有关详细信息，请参阅 <a class="xref" href="../mvc/controllers/areas.html">ASP.NET Core 中的区域</a> 和 <a class="xref" href="razor-pages-conventions.html">ASP.NET Core 中的 Razor Pages 路由和应用约定</a>。</p>
<h2 id="viewdata-attribute">ViewData 特性</h2>
<p>可以通过 &lt;xref:Microsoft.AspNetCore.Mvc.ViewDataAttribute&gt; 将数据传递到页面。 具有 <code>[ViewData]</code> 特性的属性从 &lt;xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ViewDataDictionary&gt; 保存和加载值。</p>
<p>在下面的示例中，<code>AboutModel</code> 将 <code>[ViewData]</code> 特性应用于 <code>Title</code> 属性：</p>
<pre><code class="lang-csharp">public class AboutModel : PageModel
{
    [ViewData]
    public string Title { get; } = &quot;About&quot;;

    public void OnGet()
    {
    }
}
</code></pre>
<p>在“关于”页面中，以模型属性的形式访问 <code>Title</code> 属性：</p>
<pre><code class="lang-cshtml">&lt;h1&gt;@Model.Title&lt;/h1&gt;
</code></pre>
<p>在布局中，从 ViewData 字典读取标题：</p>
<pre><code class="lang-cshtml">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;title&gt;@ViewData[&quot;Title&quot;] - WebApplication&lt;/title&gt;
    ...
</code></pre>
<h2 id="tempdata">TempData</h2>
<p>ASP.NET Core 公开 &lt;xref:Microsoft.AspNetCore.Mvc.Controller.TempData&gt;。 此属性存储未读取的数据。 &lt;xref:Microsoft.AspNetCore.Mvc.ViewFeatures.TempDataDictionary.Keep*&gt; 和 &lt;xref:Microsoft.AspNetCore.Mvc.ViewFeatures.TempDataDictionary.Peek*&gt; 方法可用于检查数据，而不执行删除。 <code>TempData</code> 在多个请求需要数据的情况下对重定向很有用。</p>
<p>下面的代码使用 <code>TempData</code> 设置 <code>Message</code> 的值：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/Customers/Index.cshtml 文件中的以下标记使用 <code>TempData</code> 显示 <code>Message</code> 的值。</p>
<pre><code class="lang-cshtml">&lt;h3&gt;Msg: @Model.Message&lt;/h3&gt;
</code></pre>
<p>Pages/Customers/Index.cshtml.cs 页面模型将 <code>[TempData]</code> 属性应用到 <code>Message</code> 属性。</p>
<pre><code class="lang-csharp">[TempData]
public string Message { get; set; }
</code></pre>
<p>有关详细信息，请参阅 <a class="xref" href="../fundamentals/app-state.html#tempdata">TempData</a>。</p>
<p><a name="mhpp"></a></p>
<h2 id="multiple-handlers-per-page">针对一个页面的多个处理程序</h2>
<p>以下页面使用 <code>asp-page-handler</code> 标记帮助程序为两个处理程序生成标记：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面示例中的窗体包含两个提交按钮，每个提交按钮均使用 <code>FormActionTagHelper</code> 提交到不同的 URL。 <code>asp-page-handler</code> 是 <code>asp-page</code> 的配套属性。 <code>asp-page-handler</code> 生成提交到页面定义的各个处理程序方法的 URL。 未指定 <code>asp-page</code>，因为示例已链接到当前页面。</p>
<p>页面模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的代码使用已命名处理程序方法。 已命名处理程序方法通过采用名称中 <code>On&lt;HTTP Verb&gt;</code> 之后及 <code>Async</code> 之前的文本（如果有）创建。 在前面的示例中，页面方法是 OnPost <strong>JoinList</strong> Async 和 OnPost <strong>JoinListUC</strong> Async。 删除 OnPost 和 Async 后，处理程序名称为 <code>JoinList</code> 和 <code>JoinListUC</code>。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>使用前面的代码时，提交到 <code>OnPostJoinListAsync</code> 的 URL 路径为 <code>https://localhost:5001/Customers/CreateFATH?handler=JoinList</code>。 提交到 <code>OnPostJoinListUCAsync</code> 的 URL 路径为 <code>https://localhost:5001/Customers/CreateFATH?handler=JoinListUC</code>。</p>
<h2 id="custom-routes">自定义路由</h2>
<p>使用 <code>@page</code> 指令，执行以下操作：</p>
<ul>
<li>指定页面的自定义路由。 例如，使用 <code>@page &quot;/Some/Other/Path&quot;</code> 将“关于”页面的路由设置为 <code>/Some/Other/Path</code>。</li>
<li>将段追加到页面的默认路由。 例如，可使用 <code>@page &quot;item&quot;</code> 将“item”段添加到页面的默认路由。</li>
<li>将参数追加到页面的默认路由。 例如，<code>@page &quot;{id}&quot;</code> 页面需要 ID 参数 <code>id</code>。</li>
</ul>
<p>支持开头处以波形符 (<code>~</code>) 指定的相对于根目录的路径。 例如，<code>@page &quot;~/Some/Other/Path&quot;</code> 和 <code>@page &quot;/Some/Other/Path&quot;</code> 相同。</p>
<p>如果你不喜欢 URL 中的查询字符串 <code>?handler=JoinList</code>，请更改路由，将处理程序名称放在 URL 的路径部分。 可以通过在 <code>@page</code> 指令后面添加使用双引号括起来的路由模板来自定义路由。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>使用前面的代码时，提交到 <code>OnPostJoinListAsync</code> 的 URL 路径为 <code>https://localhost:5001/Customers/CreateFATH/JoinList</code>。 提交到 <code>OnPostJoinListUCAsync</code> 的 URL 路径为 <code>https://localhost:5001/Customers/CreateFATH/JoinListUC</code>。</p>
<p><code>handler</code> 前面的 <code>?</code> 表示路由参数为可选。</p>
<h2 id="advanced-configuration-and-settings">高级配置和设置</h2>
<p>大多数应用不需要以下部分中的配置和设置。</p>
<p>要配置高级选项，请使用 &lt;xref:Microsoft.Extensions.DependencyInjection.MvcServiceCollectionExtensions.AddRazorPages%2A&gt; 重载，该重载配置 &lt;xref:Microsoft.AspNetCore.Mvc.RazorPages.RazorPagesOptions&gt;：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>使用 &lt;xref:Microsoft.AspNetCore.Mvc.RazorPages.RazorPagesOptions&gt; 设置页面的根目录，或者为页面添加应用程序模型约定。 有关约定的详细信息，请参阅 <a class="xref" href="../security/authorization/razor-pages-authorization.html">Razor Pages 授权约定</a>.</p>
<p>若要预编译视图，请参阅 <a class="xref" href="../mvc/views/view-compilation.html">Razor 视图编译</a>。</p>
<h3 id="specify-that-no-locrazor-pages-are-at-the-content-root">指定 Razor Pages 位于内容根目录中</h3>
<p>默认情况下，Razor Pages 位于 /Pages 目录的根位置。 添加 &lt;xref:Microsoft.Extensions.DependencyInjection.MvcRazorPagesMvcBuilderExtensions.WithRazorPagesAtContentRoot*&gt; 以指定 Razor Pages 位于应用的<a class="xref" href="../fundamentals/index.html#content-root">内容根</a> (&lt;xref:Microsoft.AspNetCore.Hosting.IHostingEnvironment.ContentRootPath&gt;)：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><h3 id="specify-that-no-locrazor-pages-are-at-a-custom-root-directory">指定 Razor Pages 位于自定义根目录中</h3>
<p>添加 &lt;xref:Microsoft.Extensions.DependencyInjection.MvcRazorPagesMvcCoreBuilderExtensions.WithRazorPagesRoot*&gt;，以指定 Razor Pages 位于应用中自定义根目录位置（提供相对路径）：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><h2 id="additional-resources">其他资源</h2>
<ul>
<li>请参阅 <a class="xref" href="../tutorials/razor-pages/razor-pages-start.html">Razor Pages 入门</a>这篇文章以本文为基础撰写。</li>
<li><a class="xref" href="../security/authorization/simple.html#aarp">授权属性和 Razor Pages</a></li>
<li><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/razor-pages/index/3.0sample">下载或查看示例代码</a></li>
<li><a class="xref" href="../introduction-to-aspnet-core.html">ASP.NET Core 简介</a></li>
<li><a class="xref" href="../mvc/views/razor.html">razor 语法参考 ASP.NET Core</a></li>
<li><a class="xref" href="../mvc/controllers/areas.html">ASP.NET Core 中的区域</a></li>
<li><a class="xref" href="../tutorials/razor-pages/razor-pages-start.html">教程：在 ASP.NET Core 中开始使用 Razor Pages</a></li>
<li><a class="xref" href="../security/authorization/razor-pages-authorization.html">Razor 页面中的授权约定 ASP.NET Core</a></li>
<li><a class="xref" href="razor-pages-conventions.html">ASP.NET Core 中的 Razor Pages 路由和应用约定</a></li>
<li><a class="xref" href="../test/razor-pages-tests.html">ASP.NET Core 中的 Razor Pages 单元测试</a></li>
<li><a class="xref" href="../mvc/views/partial.html">ASP.NET Core 中的分部视图</a></li>
<li><a class="xref" href="../blazor/components/integrate-components.html">将 ASP.NET Core Razor 组件集成到 Razor Pages 和 MVC 应用</a></li>
</ul>
</div>
<div range="&lt; aspnetcore-3.0">
<p>作者：<a href="https://twitter.com/RickAndMSFT">Rick Anderson</a> 和 <a href="https://github.com/rynowak">Ryan Nowak</a></p>
<p>Razor Pages 是 ASP.NET Core MVC 的一个新特性，它可以使基于页面的编码方式更简单高效。</p>
<p>若要查找使用模型视图控制器方法的教程，请参阅 <a class="xref" href="../tutorials/first-mvc-app/start-mvc.html">ASP.NET Core MVC 入门</a>。</p>
<p>本文档介绍 Razor Pages。 它并不是分步教程。 如果认为某些部分过于复杂，请参阅 <a class="xref" href="../tutorials/razor-pages/razor-pages-start.html">Razor Pages 入门</a>。 有关 ASP.NET Core 的概述，请参阅 <a class="xref" href="../introduction-to-aspnet-core.html">ASP.NET Core 简介</a>。</p>
<h2 id="prerequisites">先决条件</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-2_visual-studio" role="tabpanel" data-tab="visual-studio">
<ul>
<li>带有 ASP.NET 和 Web 开发工作负荷的 <a href="https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&amp;utm_source=docs.microsoft.com&amp;utm_campaign=inline+link&amp;utm_content=download+vs2019">Visual Studio 2019</a></li>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK 2.2 或更高版本</a></li>
</ul>
<div class="WARNING">
<h5>Warning</h5>
<p>如果使用 Visual Studio 2017，请参阅 <a href="https://github.com/dotnet/sdk/issues/3124">dotnet/sdk 问题 #3124</a>，以了解无法与 Visual Studio 一起使用的 .NET Core SDK 版本的信息。</p>
</div>
</section>
<section id="tabpanel_CeZOj-G++Q-2_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">
<ul>
<li><a href="https://code.visualstudio.com/download">Visual Studio Code</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp">用于 Visual Studio Code 的 C#（最新版本）</a></li>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK 2.2 或更高版本</a></li>
</ul>
<p>Visual Studio Code 说明使用用于 ASP.NET Core 的 .NET Core CLI 开发功能，如项目创建。 可在任何平台（macOS、Linux 或 Windows）上或在任何代码编辑器中遵循这些说明。 如果使用 Visual Studio Code 以外的其他内容，则可能需要进行少量更改。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-2_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">
<ul>
<li><a href="https://visualstudio.microsoft.com/downloads/">Visual Studio for Mac 版本 8.0 或更高版本</a></li>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK 2.2 或更高版本</a></li>
</ul>
</section>
</div>

<p><a name="rpvs17"></a></p>
<h2 id="create-a-no-locrazor-pages-project">创建 Razor Pages 项目</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-3_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-3_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-3_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-3_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-3_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-3_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-3_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>请参阅 <a class="xref" href="../tutorials/razor-pages/razor-pages-start.html">Razor Pages 入门</a>，获取关于如何创建 Razor Pages 项目的详细说明。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-3_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<p>在命令行中运行 <code>dotnet new webapp</code>。</p>
<p>在 Visual Studio for Mac 中打开生成的 .csproj 文件。</p>
</section>
<section id="tabpanel_CeZOj-G++Q-3_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<p>在命令行中运行 <code>dotnet new webapp</code>。</p>
</section>
</div>
<h2 id="no-locrazor-pages">Razor Pages</h2>
<p>Startup.cs 中已启用 Razor 页面：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>请考虑一个基本页面：<a name="OnGet"></a></p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的代码与具有控制器和视图的 ASP.NET Core 应用中使用的 <a class="xref" href="../tutorials/first-mvc-app/adding-view.html">Razor 视图文件</a>非常相似。 不同之处在于 <code>@page</code> 指令。 <code>@page</code> 使文件转换为一个 MVC 操作 ，这意味着它将直接处理请求，而无需通过控制器处理。 <code>@page</code> 必须是页面上的第一个 Razor 指令。 <code>@page</code> 会影响其他 Razor 构造的行为。</p>
<p>将在以下两个文件中显示使用 <code>PageModel</code> 类的类似页面。 Pages/Index2.cshtml 文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/Index2.cshtml.cs 页面模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>按照惯例，<code>PageModel</code> 类文件的名称与追加 .cs 的 Razor Page 文件名称相同。 例如，前面的 Razor Page 的名称为 Pages/Index2.cshtml。 包含 <code>PageModel</code> 类的文件的名称为 Pages/Index2.cshtml.cs。</p>
<p>页面的 URL 路径的关联由页面在文件系统中的位置决定。 下表显示了 Razor Page 路径及匹配的 URL：</p>
<table>
<thead>
<tr>
<th>文件名和路径</th>
<th>匹配的 URL</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>/Pages/Index.cshtml</em></td>
<td><code>/</code> 或 <code>/Index</code></td>
</tr>
<tr>
<td><em>/Pages/Contact.cshtml</em></td>
<td><code>/Contact</code></td>
</tr>
<tr>
<td><em>/Pages/Store/Contact.cshtml</em></td>
<td><code>/Store/Contact</code></td>
</tr>
<tr>
<td><em>/Pages/Store/Index.cshtml</em></td>
<td><code>/Store</code> 或 <code>/Store/Index</code></td>
</tr>
</tbody>
</table>
<p>注意：</p>
<ul>
<li>默认情况下，运行时在“Pages”文件夹中查找 Razor Pages 文件。</li>
<li>URL 未包含页面时，<code>Index</code> 为默认页面。</li>
</ul>
<h2 id="write-a-basic-form">编写基本窗体</h2>
<p>由于 Razor Pages 的设计，在构建应用时可轻松实施用于 Web 浏览器的常用模式。 <a class="xref" href="../mvc/models/model-binding.html">模型绑定</a>、<a class="xref" href="../mvc/views/tag-helpers/intro.html">标记帮助程序</a>和 HTML 帮助程序均只可用于 Razor Page 类中定义的属性。 请参考为 <code>Contact</code> 模型实现的基本的“联系我们”窗体页面：</p>
<p>在本文档中的示例中，<code>DbContext</code> 在 <a href="https://github.com/dotnet/AspNetCore.Docs/blob/master/aspnetcore/razor-pages/index/sample/RazorPagesContacts/Startup.cs#L15-L16">Startup.cs</a> 文件中进行初始化。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>数据模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>数据库上下文：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/Create.cshtml 视图文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/Create.cshtml.cs 页面模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>按照惯例，<code>PageModel</code> 类命名为 <code>&lt;PageName&gt;Model</code>并且它与页面位于同一个命名空间中。</p>
<p>使用 <code>PageModel</code> 类，可以将页面的逻辑与其展示分离开来。 它定义了页面处理程序，用于处理发送到页面的请求和用于呈现页面的数据。 这种隔离可实现：</p>
<ul>
<li>通过<a class="xref" href="../fundamentals/dependency-injection.html">依赖关系注入</a>管理页面依赖项。</li>
<li>对页面执行<a class="xref" href="../test/razor-pages-tests.html">单元测试</a>。</li>
</ul>
<p>页面包含 <code>OnPostAsync</code> 处理程序方法，它在 <code>POST</code> 请求上运行（当用户发布窗体时）。 可以为任何 HTTP 谓词添加处理程序方法。 最常见的处理程序是：</p>
<ul>
<li><code>OnGet</code>，用于初始化页面所需的状态。 <a href="#OnGet">OnGet</a> 示例。</li>
<li><code>OnPost</code>，用于处理窗体提交。</li>
</ul>
<p><code>Async</code> 命名后缀为可选，但是按照惯例通常会将它用于异步函数。 前面的代码通常用于 Razor Pages。</p>
<p>如果你熟悉使用控制器和视图的 ASP.NET 应用：</p>
<ul>
<li>前面示例中的 <code>OnPostAsync</code> 代码类似于典型的控制器代码。</li>
<li>多数 MVC 基元（例如<a class="xref" href="../mvc/models/model-binding.html">模型绑定</a>、<a class="xref" href="../mvc/models/validation.html">验证</a>、<a class="xref" href="../mvc/models/validation.html">验证</a>和操作结果）都是共享的。</li>
</ul>
<p>之前的 <code>OnPostAsync</code> 方法：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>OnPostAsync</code> 的基本流：</p>
<p>检查验证错误。</p>
<ul>
<li>如果没有错误，则保存数据并重定向。</li>
<li>如果有错误，则再次显示页面并附带验证消息。 客户端验证与传统的 ASP.NET Core MVC 应用程序相同。 很多情况下，都会在客户端上检测到验证错误，并且从不将它们提交到服务器。</li>
</ul>
<p>成功输入数据后，<code>OnPostAsync</code> 处理程序方法调用 <code>RedirectToPage</code> 帮助程序方法来返回 <code>RedirectToPageResult</code> 的实例。 <code>RedirectToPage</code> 是新的操作结果，类似于 <code>RedirectToAction</code> 或 <code>RedirectToRoute</code>，但是已针对页面进行自定义。 在前面的示例中，它将重定向到根索引页 (<code>/Index</code>)。 <a href="#url_gen">页面 URL 生成</a>部分中详细介绍了 <code>RedirectToPage</code>。</p>
<p>提交的窗体存在（已传递到服务器的）验证错误时，<code>OnPostAsync</code> 处理程序方法调用 <code>Page</code> 帮助程序方法。 <code>Page</code> 返回 <code>PageResult</code> 的实例。 返回 <code>Page</code> 的过程与控制器中的操作返回 <code>View</code> 的过程相似。 <code>PageResult</code> 是处理程序方法的默认返回类型。 返回 <code>void</code> 的处理程序方法将显示页面。</p>
<p><code>Customer</code> 属性使用 <code>[BindProperty]</code> 特性来选择加入模型绑定。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Razor Pages 只绑定带有非 <code>GET</code> 谓词的属性。 绑定属性可以减少需要编写的代码量。 绑定通过使用相同的属性显示窗体字段 (<code>&lt;input asp-for=&quot;Customer.Name&quot;&gt;</code>) 来减少代码，并接受输入。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>出于安全原因，必须选择绑定 <code>GET</code> 请求数据以对模型属性进行分页。 请在将用户输入映射到属性前对其进行验证。 当处理依赖查询字符串或路由值的方案时，选择加入 <code>GET</code> 绑定非常有用。</p>
<p>若要将属性绑定在 <code>GET</code> 请求上，请将 <a href="xref:Microsoft.AspNetCore.Mvc.BindPropertyAttribute"><code>[BindProperty]</code></a> 特性的 <code>SupportsGet</code> 属性设置为 <code>true</code>：</p>
<pre><code class="lang-csharp">[BindProperty(SupportsGet = true)]
</code></pre>
<p>有关详细信息，请参阅 <a href="https://www.youtube.com/watch?v=p7iHB9V-KVU&amp;feature=youtu.be&amp;t=54m27s">ASP.NET Core Community Standup:Bind on GET discussion (YouTube)</a>（绑定 GET 讨论）。</p>
</div>

<p>主页 (Index.cshtml)：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>关联的 <code>PageModel</code> 类 (Index.cshtml.cs)：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Index.cshtml 文件包含以下标记来创建每个联系人项的编辑链接：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>&lt;a asp-page=&quot;./Edit&quot; asp-route-id=&quot;@contact.Id&quot;&gt;Edit&lt;/a&gt;</code> <a class="xref" href="../mvc/views/tag-helpers/built-in/anchor-tag-helper.html">定位点标记帮助程序</a>使用 <code>asp-route-{value}</code> 属性生成“编辑”页面的链接。 此链接包含路由数据及联系人 ID。 例如 <code>https://localhost:5001/Edit/1</code>。 <a class="xref" href="../mvc/views/tag-helpers/intro.html">标记帮助程序</a>使服务器端代码可以在 Razor 文件中参与创建和呈现 HTML 元素。 标记帮助程序由 <code>@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers</code> 启动</p>
<p>Pages/Edit.cshtml 文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>第一行包含 <code>@page &quot;{id:int}&quot;</code> 指令。 路由约束 <code>&quot;{id:int}&quot;</code> 告诉页面接受包含 <code>int</code> 路由数据的页面请求。 如果页面请求未包含可转换为 <code>int</code> 的路由数据，则运行时返回 HTTP 404（未找到）错误。 若要使 ID 可选，请将 <code>?</code> 追加到路由约束：</p>
<pre><code class="lang-cshtml">@page &quot;{id:int?}&quot;
</code></pre>
<p>Pages/Edit.cshtml.cs 文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Index.cshtml 文件还包含用于为每个客户联系人创建删除按钮的标记：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>删除按钮采用 HTML 呈现，其 <code>formaction</code> 包括参数：</p>
<ul>
<li><code>asp-route-id</code> 属性指定的客户联系人 ID。</li>
<li><code>asp-page-handler</code> 属性指定的 <code>handler</code>。</li>
</ul>
<p>下面是呈现的删除按钮的示例，其中客户联系人 ID 为 <code>1</code>：</p>
<pre><code class="lang-html">&lt;button type=&quot;submit&quot; formaction=&quot;/?id=1&amp;amp;handler=delete&quot;&gt;delete&lt;/button&gt;
</code></pre>
<p>选中按钮时，向服务器发送窗体 <code>POST</code> 请求。 按照惯例，根据方案 <code>OnPost[handler]Async</code> 基于 <code>handler</code> 参数的值来选择处理程序方法的名称。</p>
<p>因为本示例中 <code>handler</code> 是 <code>delete</code>，因此 <code>OnPostDeleteAsync</code> 处理程序方法用于处理 <code>POST</code> 请求。 如果 <code>asp-page-handler</code> 设置为其他值（如 <code>remove</code>），则选择名称为 <code>OnPostRemoveAsync</code> 的处理程序方法。 以下代码显示了 <code>OnPostDeleteAsync</code> 处理程序：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>OnPostDeleteAsync</code> 方法：</p>
<ul>
<li>接受来自查询字符串的 <code>id</code>。 如果 Index.cshtml 页面指令包含路由约束 <code>&quot;{id:int?}&quot;</code>，则 <code>id</code> 来自路由数据。 <code>id</code> 的路由数据在 <code>https://localhost:5001/Customers/2</code> 等 URI 中指定。</li>
<li>使用 <code>FindAsync</code> 查询客户联系人的数据库。</li>
<li>如果找到客户联系人，则从客户联系人列表将其删除。 数据库将更新。</li>
<li>调用 <code>RedirectToPage</code>，重定向到根索引页 (<code>/Index</code>)。</li>
</ul>
<h2 id="mark-page-properties-as-required">按需标记页面属性</h2>
<p><code>PageModel</code> 上的属性可通过 <a href="/dotnet/api/system.componentmodel.dataannotations.requiredattribute">Required</a> 特性进行标记：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>有关详细信息，请参阅<a class="xref" href="../mvc/models/validation.html">模型验证</a>。</p>
<h2 id="handle-head-requests-with-an-onget-handler-fallback">使用 OnGet 处理程序回退来处理 HEAD 请求</h2>
<p><code>HEAD</code> 请求可检索特定资源的标头。 与 <code>GET</code> 请求不同，<code>HEAD</code> 请求不返回响应正文。</p>
<p>通常，针对 <code>HEAD</code> 请求创建和调用 <code>OnHead</code> 处理程序：</p>
<pre><code class="lang-csharp">public void OnHead()
{
    HttpContext.Response.Headers.Add(&quot;HandledBy&quot;, &quot;Handled by OnHead!&quot;);
}
</code></pre>
<p>在 ASP.NET Core 2.1 或更高版本中，如果未定义 <code>OnHead</code> 处理程序，则 Razor Pages 会回退到调用 <code>OnGet</code> 处理程序。 此行为是通过在 <code>Startup.ConfigureServices</code> 中调用 <a class="xref" href="../mvc/compatibility-version.html">SetCompatibilityVersion</a> 而启用的：</p>
<pre><code class="lang-csharp">services.AddMvc()
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_1);
</code></pre>
<p>默认模板在 ASP.NET Core 2.1 和 2.2 中生成 <code>SetCompatibilityVersion</code> 调用。 <code>SetCompatibilityVersion</code> 有效地将 Razor Pages 选项 <code>AllowMappingHeadRequestsToGetHandler</code> 设置为 <code>true</code>。</p>
<p>可显式选择使用特定行为，而不是通过 <code>SetCompatibilityVersion</code> 选择使用所有行为。 通过下列代码，可选择允许将 <code>HEAD</code> 请求映射到 <code>OnGet</code> 处理程序：</p>
<pre><code class="lang-csharp">services.AddMvc()
    .AddRazorPagesOptions(options =&gt;
    {
        options.AllowMappingHeadRequestsToGetHandler = true;
    });
</code></pre>
<p><a name="xsrf"></a></p>
<h2 id="xsrfcsrf-and-no-locrazor-pages">XSRF/CSRF 和 Razor Pages</h2>
<p>无需为<a class="xref" href="../security/anti-request-forgery.html">防伪验证</a>编写任何代码。 Razor Pages 自动将防伪标记生成过程和验证过程包含在内。</p>
<p><a name="layout"></a></p>
<h2 id="using-layouts-partials-templates-and-tag-helpers-with-no-locrazor-pages">将布局、分区、模板和标记帮助程序用于 Razor Pages</h2>
<p>页面可使用 Razor 视图引擎的所有功能。 布局、分区、模板、标记帮助程序、_ViewStart.cshtml 和 _ViewImports.cshtml 的工作方式与它们在传统的 Razor 视图中的工作方式相同。</p>
<p>让我们使用其中的一些功能来整理此页面。</p>
<p>向 Pages/Shared/_Layout.cshtml 添加<a class="xref" href="../mvc/views/layout.html">布局页面</a>：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><a class="xref" href="../mvc/views/layout.html">布局</a>：</p>
<ul>
<li>控制每个页面的布局（页面选择退出布局时除外）。</li>
<li>导入 HTML 结构，例如 JavaScript 和样式表。</li>
</ul>
<p>请参阅<a class="xref" href="../mvc/views/layout.html">布局页面</a>了解详细信息。</p>
<p>在 Pages/_ViewStart.cshtml 中设置 <a class="xref" href="../mvc/views/layout.html#specifying-a-layout">Layout</a> 属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>布局位于“页面/共享”文件夹中。 页面按层次结构从当前页面的文件夹开始查找其他视图（布局、模板、分区）。 可以从“Pages”文件夹下的任意 Razor 页面使用“Pages/Shared”文件夹中的布局。</p>
<p>布局文件应位于 Pages/Shared 文件夹中。</p>
<p>建议不要将布局文件放在“视图/共享”文件夹中。 视图/共享 是一种 MVC 视图模式。 Razor Pages 旨在依赖文件夹层次结构，而非路径约定。</p>
<p>Razor Page 中的视图搜索包含“Pages”文件夹。 要用于 MVC 控制器和传统 Razor 视图的布局、模板和分区可正常运行。</p>
<p>添加 Pages/_ViewImports.cshtml 文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>本教程的后续部分中将介绍 <code>@namespace</code>。 <code>@addTagHelper</code> 指令将<a class="xref" href="../mvc/views/tag-helpers/built-in/index.html">内置标记帮助程序</a>引入“页面”文件夹中的所有页面。</p>
<p><a name="namespace"></a></p>
<p>页面上显式使用 <code>@namespace</code> 指令后：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>此指令将为页面设置命名空间。 <code>@model</code> 指令无需包含命名空间。</p>
<p>_ViewImports.cshtml 中包含 <code>@namespace</code> 指令后，指定的命名空间将为在导入 <code>@namespace</code> 指令的页面中生成的命名空间提供前缀。 生成的命名空间的剩余部分（后缀部分）是包含 _ViewImports.cshtml 的文件夹与包含页面的文件夹之间以点分隔的相对路径。</p>
<p>例如，<code>PageModel</code> 类 Pages/Customers/Edit.cshtml.cs 显式设置命名空间：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/_ViewImports.cshtml 文件设置以下命名空间：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>为 Pages/Customers/Edit.cshtml Razor Page 生成的命名空间与 <code>PageModel</code> 类相同。</p>
<p><code>@namespace</code>  <em>也适用于传统 Razor 视图。</em></p>
<p>原始的 Pages/Create.cshtml 视图文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>更新后的 Pages/Create.cshtml 视图文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><a href="#rpvs17">Razor Pages 初学者项目</a>包含 Pages/_ValidationScriptsPartial.cshtml，它与客户端验证联合。</p>
<p>有关分部视图的详细信息，请参阅 <a class="xref" href="../mvc/views/partial.html">ASP.NET Core 中的分部视图</a>。</p>
<p><a name="url_gen"></a></p>
<h2 id="url-generation-for-pages">页面的 URL 生成</h2>
<p>之前显示的 <code>Create</code> 页面使用 <code>RedirectToPage</code>：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>应用具有以下文件/文件夹结构：</p>
<ul>
<li><p>/Pages</p>
<ul>
<li><p><em>Index.cshtml</em></p>
</li>
<li><p>/Customers</p>
<ul>
<li>Create.cshtml</li>
<li>Edit.cshtml</li>
<li><em>Index.cshtml</em></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>成功后，Pages/Customers/Create.cshtml 和 Pages/Customers/Edit.cshtml 页面将重定向到 Pages/Index.cshtml。 字符串 <code>/Index</code> 是用于访问上一页的 URI 的组成部分。 可以使用字符串 <code>/Index</code> 生成 Pages/Index.cshtml 页面的 URI。 例如：</p>
<ul>
<li><code>Url.Page(&quot;/Index&quot;, ...)</code></li>
<li><code>&lt;a asp-page=&quot;/Index&quot;&gt;My Index Page&lt;/a&gt;</code></li>
<li><code>RedirectToPage(&quot;/Index&quot;)</code></li>
</ul>
<p>页面名称是从根“/Pages”文件夹到页面的路径（包含前导 <code>/</code>，例如 <code>/Index</code>）。 与硬编码 URL 相比，前面的 URL 生成示例提供了改进的选项和功能。 URL 生成使用<a class="xref" href="../mvc/controllers/routing.html">路由</a>，并且可以根据目标路径定义路由的方式生成参数并对参数编码。</p>
<p>页面的 URL 生成支持相对名称。 下表显示了 Pages/Customers/Create.cshtml 中不同的 <code>RedirectToPage</code> 参数选择的索引页：</p>
<table>
<thead>
<tr>
<th>RedirectToPage(x)</th>
<th>页面</th>
</tr>
</thead>
<tbody>
<tr>
<td>RedirectToPage(&quot;/Index&quot;)</td>
<td><em>Pages/Index</em></td>
</tr>
<tr>
<td>RedirectToPage(&quot;./Index&quot;);</td>
<td><em>Pages/Customers/Index</em></td>
</tr>
<tr>
<td>RedirectToPage(&quot;../Index&quot;)</td>
<td><em>Pages/Index</em></td>
</tr>
<tr>
<td>RedirectToPage(&quot;Index&quot;)</td>
<td><em>Pages/Customers/Index</em></td>
</tr>
</tbody>
</table>
<p><code>RedirectToPage(&quot;Index&quot;)</code>、<code>RedirectToPage(&quot;./Index&quot;)</code> 和 <code>RedirectToPage(&quot;../Index&quot;)</code> 是相对名称。 结合<code>RedirectToPage</code> 参数与当前页的路径来计算目标页面的名称。  <!-- Review: Original had The provided string is combined with the page name of the current page to compute the name of the destination page.  page name, not page path --></p>
<p>构建结构复杂的站点时，相对名称链接很有用。 如果使用相对名称链接文件夹中的页面，则可以重命名该文件夹。 所有链接仍然有效（因为这些链接未包含此文件夹名称）。</p>
<p>若要重定向到不同<a class="xref" href="../mvc/controllers/areas.html">区域</a>中的页面，请指定区域：</p>
<pre><code class="lang-csharp">RedirectToPage(&quot;/Index&quot;, new { area = &quot;Services&quot; });
</code></pre>
<p>有关详细信息，请参阅 <a class="xref" href="../mvc/controllers/areas.html">ASP.NET Core 中的区域</a>。</p>
<h2 id="viewdata-attribute">ViewData 特性</h2>
<p>可以通过 <a href="/dotnet/api/microsoft.aspnetcore.mvc.viewdataattribute">ViewDataAttribute</a> 将数据传递到页面。 控制器或 Razor Pages 模型上使用 <code>[ViewData]</code> 属性的属性将其值存储在 <a href="/dotnet/api/microsoft.aspnetcore.mvc.viewfeatures.viewdatadictionary">ViewDataDictionary</a> 中并从此处进行加载。</p>
<p>在下面的示例中，<code>AboutModel</code> 包含使用 <code>[ViewData]</code> 标记的 <code>Title</code> 属性。 <code>Title</code> 属性设置为“关于”页面的标题：</p>
<pre><code class="lang-csharp">public class AboutModel : PageModel
{
    [ViewData]
    public string Title { get; } = &quot;About&quot;;

    public void OnGet()
    {
    }
}
</code></pre>
<p>在“关于”页面中，以模型属性的形式访问 <code>Title</code> 属性：</p>
<pre><code class="lang-cshtml">&lt;h1&gt;@Model.Title&lt;/h1&gt;
</code></pre>
<p>在布局中，从 ViewData 字典读取标题：</p>
<pre><code class="lang-cshtml">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;title&gt;@ViewData[&quot;Title&quot;] - WebApplication&lt;/title&gt;
    ...
</code></pre>
<h2 id="tempdata">TempData</h2>
<p>ASP.NET 在<a href="/dotnet/api/microsoft.aspnetcore.mvc.controller">控制器</a>上公开了 <a href="/dotnet/api/microsoft.aspnetcore.mvc.controller.tempdata?view=aspnetcore-2.0#Microsoft_AspNetCore_Mvc_Controller_TempData">TempData</a> 属性。 此属性存储未读取的数据。 <code>Keep</code> 和 <code>Peek</code> 方法可用于检查数据，而不执行删除。 多个请求需要数据时，<code>TempData</code> 有助于进行重定向。</p>
<p>下面的代码使用 <code>TempData</code> 设置 <code>Message</code> 的值：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Pages/Customers/Index.cshtml 文件中的以下标记使用 <code>TempData</code> 显示 <code>Message</code> 的值。</p>
<pre><code class="lang-cshtml">&lt;h3&gt;Msg: @Model.Message&lt;/h3&gt;
</code></pre>
<p>Pages/Customers/Index.cshtml.cs 页面模型将 <code>[TempData]</code> 属性应用到 <code>Message</code> 属性。</p>
<pre><code class="lang-csharp">[TempData]
public string Message { get; set; }
</code></pre>
<p>有关详细信息，请参阅 <a class="xref" href="../fundamentals/app-state.html#tempdata">TempData</a>。</p>
<p><a name="mhpp"></a></p>
<h2 id="multiple-handlers-per-page">针对一个页面的多个处理程序</h2>
<p>以下页面使用 <code>asp-page-handler</code> 标记帮助程序为两个处理程序生成标记：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><!-- Review: the FormActionTagHelper applies to all <form /> elements on a Razor page, even when there's no `asp-` attribute   -->
<p>前面示例中的窗体包含两个提交按钮，每个提交按钮均使用 <code>FormActionTagHelper</code> 提交到不同的 URL。 <code>asp-page-handler</code> 是 <code>asp-page</code> 的配套属性。 <code>asp-page-handler</code> 生成提交到页面定义的各个处理程序方法的 URL。 未指定 <code>asp-page</code>，因为示例已链接到当前页面。</p>
<p>页面模型：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的代码使用已命名处理程序方法。 已命名处理程序方法通过采用名称中 <code>On&lt;HTTP Verb&gt;</code> 之后及 <code>Async</code> 之前的文本（如果有）创建。 在前面的示例中，页面方法是 OnPost <strong>JoinList</strong> Async 和 OnPost <strong>JoinListUC</strong> Async。 删除 OnPost 和 Async 后，处理程序名称为 <code>JoinList</code> 和 <code>JoinListUC</code>。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>使用前面的代码时，提交到 <code>OnPostJoinListAsync</code> 的 URL 路径为 <code>https://localhost:5001/Customers/CreateFATH?handler=JoinList</code>。 提交到 <code>OnPostJoinListUCAsync</code> 的 URL 路径为 <code>https://localhost:5001/Customers/CreateFATH?handler=JoinListUC</code>。</p>
<h2 id="custom-routes">自定义路由</h2>
<p>使用 <code>@page</code> 指令，执行以下操作：</p>
<ul>
<li>指定页面的自定义路由。 例如，使用 <code>@page &quot;/Some/Other/Path&quot;</code> 将“关于”页面的路由设置为 <code>/Some/Other/Path</code>。</li>
<li>将段追加到页面的默认路由。 例如，可使用 <code>@page &quot;item&quot;</code> 将“item”段添加到页面的默认路由。</li>
<li>将参数追加到页面的默认路由。 例如，<code>@page &quot;{id}&quot;</code> 页面需要 ID 参数 <code>id</code>。</li>
</ul>
<p>支持开头处以波形符 (<code>~</code>) 指定的相对于根目录的路径。 例如，<code>@page &quot;~/Some/Other/Path&quot;</code> 和 <code>@page &quot;/Some/Other/Path&quot;</code> 相同。</p>
<p>如果你不喜欢 URL 中的查询字符串 <code>?handler=JoinList</code>，请更改路由，将处理程序名称放在 URL 的路径部分。 可以通过在 <code>@page</code> 指令后面添加使用双引号括起来的路由模板来自定义路由。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>使用前面的代码时，提交到 <code>OnPostJoinListAsync</code> 的 URL 路径为 <code>https://localhost:5001/Customers/CreateFATH/JoinList</code>。 提交到 <code>OnPostJoinListUCAsync</code> 的 URL 路径为 <code>https://localhost:5001/Customers/CreateFATH/JoinListUC</code>。</p>
<p><code>handler</code> 前面的 <code>?</code> 表示路由参数为可选。</p>
<h2 id="configuration-and-settings">配置和设置</h2>
<p>若要配置高级选项，请在 MVC 生成器上使用 <code>AddRazorPagesOptions</code> 扩展方法：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>目前，可以使用 <code>RazorPagesOptions</code> 设置页面的根目录，或者为页面添加应用程序模型约定。 通过这种方式，我们在将来会实现更多扩展功能。</p>
<p>若要预编译视图，请参阅 <a class="xref" href="../mvc/views/view-compilation.html">Razor 视图编译</a>。</p>
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/razor-pages/index/sample">下载或查看示例代码</a>.</p>
<p>请参阅 <a class="xref" href="../tutorials/razor-pages/razor-pages-start.html">Razor Pages 入门</a>这篇文章以本文为基础撰写。</p>
<h3 id="specify-that-no-locrazor-pages-are-at-the-content-root">指定 Razor Pages 位于内容根目录中</h3>
<p>默认情况下，Razor Pages 位于 /Pages 目录的根位置。 向 <a href="/dotnet/api/microsoft.extensions.dependencyinjection.mvcservicecollectionextensions.addmvc#Microsoft_Extensions_DependencyInjection_MvcServiceCollectionExtensions_AddMvc_Microsoft_Extensions_DependencyInjection_IServiceCollection_">AddMvc</a> 添加 <a href="/dotnet/api/microsoft.extensions.dependencyinjection.mvcrazorpagesmvcbuilderextensions.withrazorpagesatcontentroot">WithRazorPagesAtContentRoot</a>，以指定 Razor Pages 位于应用的<a class="xref" href="../fundamentals/index.html#content-root">根目录</a> (<a href="/dotnet/api/microsoft.aspnetcore.hosting.ihostingenvironment.contentrootpath">ContentRootPath</a>)：</p>
<pre><code class="lang-csharp">services.AddMvc()
    .AddRazorPagesOptions(options =&gt;
    {
        ...
    })
    .WithRazorPagesAtContentRoot();
</code></pre>
<h3 id="specify-that-no-locrazor-pages-are-at-a-custom-root-directory">指定 Razor Pages 位于自定义根目录中</h3>
<p>向 <a href="/dotnet/api/microsoft.extensions.dependencyinjection.mvcservicecollectionextensions.addmvc#Microsoft_Extensions_DependencyInjection_MvcServiceCollectionExtensions_AddMvc_Microsoft_Extensions_DependencyInjection_IServiceCollection_">AddMvc</a> 添加 <a href="/dotnet/api/microsoft.extensions.dependencyinjection.mvcrazorpagesmvccorebuilderextensions.withrazorpagesroot">WithRazorPagesRoot</a>，以指定 Razor Pages 位于应用中的自定义根目录（提供相对路径）：</p>
<pre><code class="lang-csharp">services.AddMvc()
    .AddRazorPagesOptions(options =&gt;
    {
        ...
    })
    .WithRazorPagesRoot(&quot;/path/to/razor/pages&quot;);
</code></pre>
<h2 id="additional-resources">其他资源</h2>
<ul>
<li><a class="xref" href="../security/authorization/simple.html#aarp">授权属性和 Razor Pages</a></li>
<li><a class="xref" href="../introduction-to-aspnet-core.html">ASP.NET Core 简介</a></li>
<li><a class="xref" href="../mvc/views/razor.html">razor 语法参考 ASP.NET Core</a></li>
<li><a class="xref" href="../mvc/controllers/areas.html">ASP.NET Core 中的区域</a></li>
<li><a class="xref" href="../tutorials/razor-pages/razor-pages-start.html">教程：在 ASP.NET Core 中开始使用 Razor Pages</a></li>
<li><a class="xref" href="../security/authorization/razor-pages-authorization.html">Razor 页面中的授权约定 ASP.NET Core</a></li>
<li><a class="xref" href="razor-pages-conventions.html">ASP.NET Core 中的 Razor Pages 路由和应用约定</a></li>
<li><a class="xref" href="../test/razor-pages-tests.html">ASP.NET Core 中的 Razor Pages 单元测试</a></li>
<li><a class="xref" href="../mvc/views/partial.html">ASP.NET Core 中的分部视图</a></li>
</ul>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
