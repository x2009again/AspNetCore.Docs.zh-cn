<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ASP.NET Core 2.1 &#30340;&#26032;&#22686;&#21151;&#33021; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ASP.NET Core 2.1 &#30340;&#26032;&#22686;&#21151;&#33021; ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="aspnetcore-2.1">
<h1 id="whats-new-in-aspnet-core-21">ASP.NET Core 2.1 的新增功能</h1>

<p>本文重点介绍 ASP.NET Core 2.1 中最重要的更改，并提供相关文档的链接。</p>
<h2 id="signalr">SignalR</h2>
<p>已针对 ASP.NET Core 2.1 重新编写 SignalR。 ASP.NET Core SignalR 包含大量改进：</p>
<ul>
<li>简化横向扩展模型。</li>
<li>新 JavaScript 客户端不具有 jQuery 依赖项。</li>
<li>新紧凑型二进制协议基于 MessagePack。</li>
<li>支持自定义协议。</li>
<li>新的流式处理响应模型。</li>
<li>支持基于裸机 WebSocket 的客户端。</li>
</ul>
<p>有关详细信息，请参阅 <a class="xref" href="../signalr/introduction.html">ASP.NET Core SignalR</a>。</p>
<h2 id="no-locrazor-class-libraries">Razor 类库</h2>
<p>通过 ASP.NET Core 2.1 可以更容易地在库中生成和包含基于 Razor 的 UI，并跨多个项目共享 UI。 新 Razor SDK 支持将 Razor 文件生成到可打包为 NuGet 包的类库项目中。 应用可以自动发现和覆盖库中的视图和页面。 通过将 Razor 编译集成到生成中：</p>
<ul>
<li>应用启动时间可显著加快。</li>
<li>在迭代开发工作流过程中，仍可在运行时快速更新 Razor 视图和页面。</li>
</ul>
<p>有关详细信息，请参阅<a class="xref" href="../razor-pages/ui-class.html">使用 Razor 类库项目创建可重用 UI</a>。</p>
<h2 id="no-locidentity-ui-library--scaffolding">Identity UI 库和基架</h2>
<p>ASP.NET Core 2.1 提供 <a class="xref" href="../security/authentication/identity.html">ASP.NET Core Identity</a> 作为 <a class="xref" href="../razor-pages/ui-class.html">Razor 类库</a>。 包含 Identity 的应用可以应用新的 Identity 基架，以便有选择地添加 Identity Razor 类库 (RCL) 中包含的源代码。 建议生成源代码，以便修改代码和更改行为。 例如，可以指示基架生成在注册过程中使用的代码。 生成的代码优先于 Identity RCL 中的相同代码。</p>
<p>不包含身份验证的应用可以应用 Identity 基架来添加 RCL Identity 包。 可以选择要生成的 Identity 代码。</p>
<p>有关详细信息，请参阅 <a class="xref" href="../security/authentication/scaffold-identity.html">ASP.NET Core 项目中的基架 Identity</a>。</p>
<h2 id="https">HTTPS</h2>
<p>随着对安全和隐私的关注度日益增加，为 Web 应用启用 HTTPS 变得非常重要。 Web 上强制使用 HTTPS 的要求日趋严格。 不使用 HTTPS 的站点被视为不安全的站点。 浏览器（Chromium、Mozilla）开始强制要求必须在安全的上下文中使用 Web 功能。 <a class="xref" href="../security/gdpr.html">GDPR</a> 要求使用 HTTPS 保护用户隐私。 不仅在生产环境中使用 HTTPS 至关重要，而且在开发环境中使用 HTTPS 还可以帮助防止部署中的各种问题（例如，不安全的链接）。 ASP.NET Core 2.1 包含大量改进，更方便在开发环境使用 HTTPS 和在生产环境配置 HTTPS。 有关详细信息，请参阅<a class="xref" href="../security/enforcing-ssl.html">强制使用 HTTPS</a>。</p>
<h3 id="on-by-default">默认开启</h3>
<p>为了提高网站开发的安全性，现在默认启用 HTTPS。 从 2.1 开始，当本地具有开发证书时，Kestrel 将侦听 <code>https://localhost:5001</code>。 关于开发证书的创建：</p>
<ul>
<li>首次使用 SDK 时，在首次运行 .NET Core SDK 时会创建开发证书。</li>
<li>手动使用新 <code>dev-certs</code> 工具。</li>
</ul>
<p>运行 <code>dotnet dev-certs https --trust</code> 以信任证书。</p>
<h3 id="https-redirection-and-enforcement">HTTPS 重定向和强制使用</h3>
<p>Web 应用通常需要侦听 HTTP 和 HTTPS，但随后会将所有 HTTP 流量重定向到 HTTPS。 在 2.1 中，引入了专用的 HTTPS 重定向中间件，可根据配置或绑定服务器端口的存在智能执行重定向。</p>
<p>使用 <a class="xref" href="../security/enforcing-ssl.html#http-strict-transport-security-protocol-hsts">HTTP 严格传输安全协议 (HSTS)</a> 可进一步强制使用 HTTPS。 HSTS 指示浏览器始终通过 HTTPS 访问站点。 ASP.NET Core 2.1 添加 HSTS 中间件，该中间件支持选择最大年限、子域和 HSTS 预加载列表。</p>
<h3 id="configuration-for-production">适用于生产环境的配置</h3>
<p>在生产环境中，必须显式配置 HTTPS。 在 2.1 中，添加了针对 Kestrel 配置 HTTPS 的默认配置架构。 可以将应用配置为使用：</p>
<ul>
<li>多个终结点（包括 URL）。 有关详细信息，请参阅 <a class="xref" href="../fundamentals/servers/kestrel.html#endpoint-configuration">Kestrel Web 服务器实现：终结点配置</a>。</li>
<li>来自于磁盘上的文件或证书存储中的用于 HTTPS 的证书。</li>
</ul>
<h2 id="gdpr">GDPR</h2>
<p>ASP.NET Core 提供 API 和模板，帮助满足<a href="https://www.eugdpr.org/">欧盟一般数据保护条例 (GDPR)</a> 的部分要求。 有关详细信息，请参阅 <a class="xref" href="../security/gdpr.html">ASP.NET Core 中的 GDPR 支持</a>。 <a href="https://github.com/dotnet/AspNetCore.Docs/tree/live/aspnetcore/security/gdpr/sample">示例应用</a>演示如何使用并允许测试已添加到 ASP.NET Core 2.1 模板中的大多数 GDPR 扩展点和 API。</p>
<h2 id="integration-tests">集成测试</h2>
<p>引入了可简化创建和执行测试的新包。 <a href="https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing/">Microsoft.AspNetCore.Mvc.Testing</a> 包可处理以下任务：</p>
<ul>
<li>将依赖项文件 (*.deps) 从已测试的应用复制到测试项目的 bin 文件夹中 。</li>
<li>将内容根目录设置为已测试应用的项目根目录，以便可在执行测试时找到静态文件和页面/视图。</li>
<li>提供 <a href="/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1">WebApplicationFactory</a> 类，以简化已测试应用在 <a href="/dotnet/api/microsoft.aspnetcore.testhost.testserver">TestServer</a> 中的启动过程。</li>
</ul>
<p>以下测试使用 <a href="https://xunit.github.io/">xUnit</a> 检查索引页是否加载了成功状态代码和正确的 Content-Type 标头：</p>
<pre><code class="lang-csharp">public class BasicTests
    : IClassFixture&lt;WebApplicationFactory&lt;RazorPagesProject.Startup&gt;&gt;
{
    private readonly HttpClient _client;

    public BasicTests(WebApplicationFactory&lt;RazorPagesProject.Startup&gt; factory)
    {
        _client = factory.CreateClient();
    }

    [Fact]
    public async Task GetHomePage()
    {
        // Act
        var response = await _client.GetAsync(&quot;/&quot;);

        // Assert
        response.EnsureSuccessStatusCode(); // Status Code 200-299
        Assert.Equal(&quot;text/html; charset=utf-8&quot;,
            response.Content.Headers.ContentType.ToString());
    }
}
</code></pre>
<p>有关详细信息，请参阅<a class="xref" href="../test/integration-tests.html">集成测试</a>主题。</p>
<h2 id="apicontroller-actionresultt">[ApiController], ActionResult&lt;T&gt;</h2>
<p>ASP.NET Core 2.1 添加了新编程约定，方便构建简洁的说明性 Web API。 <code>ActionResult&lt;T&gt;</code> 是一个新增类型，可允许应用返回响应类型，或返回任何其他操作结果（与 IActionResult 相似），同时仍然指示响应类型。 此外还添加了 <code>[ApiController]</code> 特性，作为选择加入特定于 Web API 的约定和行为的方式。</p>
<p>有关详细信息，请参阅<a class="xref" href="../web-api/index.html">使用 ASP.NET Core 构建 Web API</a>。</p>
<h2 id="ihttpclientfactory">IHttpClientFactory</h2>
<p>ASP.NET Core 2.1 引入了新的 <code>IHttpClientFactory</code> 服务，方便在应用中配置和使用 <code>HttpClient</code> 的实例。 <code>HttpClient</code> 已经具有委托处理程序的概念，这些委托处理程序可以链接在一起，处理出站 HTTP 请求。 工厂可以：</p>
<ul>
<li>使根据已命名客户端注册 <code>HttpClient</code> 的实例变得更直观。</li>
<li>实现一个 Polly 处理程序，允许将 Polly 策略用于 Retry、CircuitBreakers 等。</li>
</ul>
<p>有关详细信息，请参阅<a class="xref" href="../fundamentals/http-requests.html">启动 HTTP 请求</a>。</p>
<h2 id="kestrel-transport-configuration">Kestrel 传输配置</h2>
<p>对于 ASP.NET Core 2.1 版，Kestrel 默认传输不再基于 Libuv，而是基于托管的套接字。 有关详细信息，请参阅 <a class="xref" href="../fundamentals/servers/kestrel.html#transport-configuration">Kestrel Web 服务器实现：传输配置</a>。</p>
<h2 id="generic-host-builder">通用主机生成器</h2>
<p>引入了通用主机生成器 (<code>HostBuilder</code>)。 此生成器可用于不处理 HTTP 请求（消息传送、后台任务等等）的应用。</p>
<p>有关详细信息，请参阅 <a class="xref" href="../fundamentals/host/generic-host.html">.NET 通用主机</a>。</p>
<h2 id="updated-spa-templates">更新的 SPA 模板</h2>
<p>更新了适用于 Angular、React 和 React 结合 Redux 的单页应用程序模板，以使用标准项目结构和为每个框架构建系统。</p>
<p>Angular 模板基于 Angular CLI，而 React 模板基于 create-react-app。</p>
<p>有关详情，请参阅：</p>
<ul>
<li><a class="xref" href="../client-side/spa/angular.html">通过 ASP.NET Core 使用 Angular 项目模板</a></li>
<li><a class="xref" href="../client-side/spa/react.html">通过 ASP.NET Core 使用 React 项目模板</a></li>
<li><a class="xref" href="../client-side/spa/react-with-redux.html">通过 ASP.NET Core 使用带 Redux 的 React 项目模板</a></li>
</ul>
<h2 id="no-locrazor-pages-search-for-no-locrazor-assets">Razor Pages 搜索 Razor 资产</h2>
<p>在 2.1 中，Razor Pages 按所列顺序搜索以下目录中的 Razor 资产（例如布局和分区）：</p>
<ol>
<li>当前 Pages 文件夹。</li>
<li>/Pages/Shared/</li>
<li>/Views/Shared/</li>
</ol>
<h2 id="no-locrazor-pages-in-an-area">某个区域内的 Razor Pages</h2>
<p>Razor Pages 现在支持<a class="xref" href="../mvc/controllers/areas.html">区域</a>。 要查看区域示例，请使用个人用户帐户创建新 Razor Pages Web 应用。 使用个人用户帐户的 Razor Pages Web 应用包括 /Areas/Identity/Pages。</p>
<h2 id="mvc-compatibility-version">MVC 兼容性版本</h2>
<p>&lt;xref:Microsoft.Extensions.DependencyInjection.MvcCoreMvcBuilderExtensions.SetCompatibilityVersion*&gt; 方法允许应用选择加入或退出 ASP.NET Core MVC 2.1 或更高版本中引入的潜在中断行为变更。</p>
<p>有关详细信息，请参阅 <a class="xref" href="../mvc/compatibility-version.html">ASP.NET Core MVC 的兼容性版本</a>。</p>
<h2 id="migrate-from-20-to-21">从 2.0 迁移到 2.1</h2>
<p>请参阅<a class="xref" href="../migration/20_21.html">从 ASP.NET Core 2.0 迁移到 2.1</a>。</p>
<h2 id="additional-information">其他信息</h2>
<p>要获取完整的更改列表，请参阅 <a href="https://github.com/dotnet/aspnetcore/releases/tag/2.1.0">ASP.NET Core 2.1 发行说明</a>。</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
