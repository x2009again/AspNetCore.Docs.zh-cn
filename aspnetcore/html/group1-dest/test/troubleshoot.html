<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ASP.NET Core &#39033;&#30446;&#25925;&#38556;&#25490;&#38500;&#21644;&#35843;&#35797; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ASP.NET Core &#39033;&#30446;&#25925;&#38556;&#25490;&#38500;&#21644;&#35843;&#35797; ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="test/troubleshoot">
<h1 id="troubleshoot-and-debug-aspnet-core-projects">ASP.NET Core 项目故障排除和调试</h1>

<p>作者：<a href="https://twitter.com/RickAndMSFT">Rick Anderson</a></p>
<p>以下链接提供了故障排除指南：</p>
<ul>
<li><a class="xref" href="troubleshoot-azure-iis.html">对 Azure 应用服务和 IIS 上的 ASP.NET Core 进行故障排除</a></li>
<li><a class="xref" href="../host-and-deploy/azure-iis-errors-reference.html">Azure 应用服务和 IIS 上 ASP.NET Core 的常见错误参考</a></li>
<li><a href="https://www.youtube.com/watch?v=RYI0DHoIVaA">NDC 会议（伦敦，2018 年）：诊断 ASP.NET Core 应用程序中的问题</a></li>
<li><a href="https://blogs.msdn.microsoft.com/webdev/2018/05/23/asp-net-core-performance-improvements/">ASP.NET 博客：解决 ASP.NET Core 性能问题</a></li>
</ul>
<h2 id="net-core-sdk-warnings">.NET Core SDK 警告</h2>
<h3 id="both-the-32-bit-and-64-bit-versions-of-the-net-core-sdk-are-installed">同时安装了 .NET Core SDK 的 32 位和 64 位版本</h3>
<p>在 ASP.NET Core 的“新建项目”对话框中，可能会显示以下警告：</p>
<blockquote>
<p>同时安装了 .NET Core SDK 的 32 位和 64 位版本。 仅显示安装在 C:\Program Files\dotnet\sdk\ 的 64 位版本的模板。</p>
</blockquote>
<p>如果同时安装了 <a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK</a> 的 32 位 (x86) 和 64 位 (x64) 版本，则会出现此警告。 可能同时安装两个版本的常见原因包括：</p>
<ul>
<li>最初使用 32 位计算机下载了 .NET Core SDK 安装程序，然后将其复制并安装到 64 位计算机上。</li>
<li>32 位 .NET Core SDK 是由另一个应用程序安装的。</li>
<li>下载并安装了错误的版本。</li>
</ul>
<p>卸载 32 位 .NET Core SDK 以避免出现此警告。 从“控制面板” &gt; “程序和功能” &gt; “卸载或更改程序”卸载  。 如果了解警告出现的原因及其含义，可以忽略此警告。</p>
<h3 id="the-net-core-sdk-is-installed-in-multiple-locations">.NET Core SDK 安装在多个位置</h3>
<p>在 ASP.NET Core 的“新建项目”对话框中，可能会显示以下警告：</p>
<blockquote>
<p>.NET Core SDK 安装在多个位置。 仅显示安装在 C:\Program Files\dotnet\sdk\ 的 SDK 的模板。</p>
</blockquote>
<p>如果在 C:\Program Files\dotnet\sdk\ 之外的目录中至少安装了一个 .NET Core SDK，则会看到此消息。 发生这种情况，通常是由于使用复制/粘贴而不是 MSI 安装程序在计算机上部署了 .NET Core SDK。</p>
<p>卸载所有 32 位 .NET Core SDK 和运行时，以防出现此警告。 从“控制面板” &gt; “程序和功能” &gt; “卸载或更改程序”卸载  。 如果了解警告出现的原因及其含义，可以忽略此警告。</p>
<h3 id="no-net-core-sdks-were-detected">未检测到 .NET Core SDK</h3>
<ul>
<li><p>在 Visual Studio 中，ASP.NET Core 的“新建项目”对话框中可能会显示以下警告：</p>
<blockquote>
<p>未检测到任何 .NET Core SDK，请确保它们包含在环境变量 <code>PATH</code> 中。</p>
</blockquote>
</li>
<li><p>执行 <code>dotnet</code> 命令时，警告显示为：</p>
<blockquote>
<p>找不到任何已安装的 dotnet SDK。</p>
</blockquote>
</li>
</ul>
<p>如果环境变量 <code>PATH</code> 不指向计算机上的任何 .NET Core SDK，则会出现这些警告。 若要解决此问题，请执行以下操作:</p>
<ul>
<li>安装 .NET Core SDK。 从 <a href="https://dotnet.microsoft.com/download">.NET 下载</a>获取最新的安装程序。</li>
<li>验证 <code>PATH</code> 环境变量是否指向安装 SDK 的位置（对于 64 位/x64，为 <code>C:\Program Files\dotnet\</code>，对于 32 位/x86，为 <code>C:\Program Files (x86)\dotnet\</code>）。 SDK 安装程序通常会设置 <code>PATH</code>。 始终在同一台计算机上安装相同位数的 SDK 和运行时。</li>
</ul>
<h3 id="missing-sdk-after-installing-the-net-core-hosting-bundle">安装 .NET Core 托管捆绑包后缺少 SDK</h3>
<p>如果安装了 .NET Core 运行时以指向 32 位 (x86) 版本的 .NET Core (<code>C:\Program Files (x86)\dotnet\</code>)，那么安装 <a class="xref" href="../host-and-deploy/iis/index.html#install-the-net-core-hosting-bundle">.NET Core 托管捆绑包</a>会修改 <code>PATH</code>。 当使用 32 位 (x86) .NET Core <code>dotnet</code> 命令时，这可能会导致缺少 SDK（<a href="#no-net-core-sdks-were-detected">未检测到 .NET Core SDK</a>）。 若要解决此问题，请将 <code>C:\Program Files\dotnet\</code> 移到 <code>PATH</code> 上 <code>C:\Program Files (x86)\dotnet\</code> 之前的位置。</p>
<h2 id="obtain-data-from-an-app">从应用中获取数据</h2>
<p>如果某个应用能够响应请求，则可以使用中间件从应用获取以下数据：</p>
<ul>
<li>请求：方法、方案、主机、基路径、路径、查询字符串、标头</li>
<li>连接: 远程 IP 地址、远程端口、本地 IP 地址、本地端口、客户端证书</li>
<li>Identity：名称、显示名称</li>
<li>配置设置</li>
<li>环境变量</li>
</ul>
<p>将以下<a class="xref" href="../fundamentals/middleware/index.html#create-a-middleware-pipeline-with-iapplicationbuilder">中间件</a>代码置于 <code>Startup.Configure</code> 方法的请求处理管道的开头。 在运行中间件之前会检查环境，以确保仅在开发环境中执行代码。</p>
<p>若要获取环境，请使用以下方法之一：</p>
<ul>
<li><p>将 <code>IHostingEnvironment</code> 插入到 <code>Startup.Configure</code> 方法中，并检查带有本地变量的环境。 下面的示例代码对此方法进行了演示。</p>
</li>
<li><p>将环境分配到 <code>Startup</code> 类中的属性。 使用属性（例如 <code>if (Environment.IsDevelopment())</code>）检查环境。</p>
</li>
</ul>
<pre><code class="lang-csharp">public void Configure(IApplicationBuilder app, IHostingEnvironment env, 
    IConfiguration config)
{
    if (env.IsDevelopment())
    {
        app.Run(async (context) =&gt;
        {
            var sb = new StringBuilder();
            var nl = System.Environment.NewLine;
            var rule = string.Concat(nl, new string('-', 40), nl);
            var authSchemeProvider = app.ApplicationServices
                .GetRequiredService&lt;IAuthenticationSchemeProvider&gt;();

            sb.Append($&quot;Request{rule}&quot;);
            sb.Append($&quot;{DateTimeOffset.Now}{nl}&quot;);
            sb.Append($&quot;{context.Request.Method} {context.Request.Path}{nl}&quot;);
            sb.Append($&quot;Scheme: {context.Request.Scheme}{nl}&quot;);
            sb.Append($&quot;Host: {context.Request.Headers[&quot;Host&quot;]}{nl}&quot;);
            sb.Append($&quot;PathBase: {context.Request.PathBase.Value}{nl}&quot;);
            sb.Append($&quot;Path: {context.Request.Path.Value}{nl}&quot;);
            sb.Append($&quot;Query: {context.Request.QueryString.Value}{nl}{nl}&quot;);

            sb.Append($&quot;Connection{rule}&quot;);
            sb.Append($&quot;RemoteIp: {context.Connection.RemoteIpAddress}{nl}&quot;);
            sb.Append($&quot;RemotePort: {context.Connection.RemotePort}{nl}&quot;);
            sb.Append($&quot;LocalIp: {context.Connection.LocalIpAddress}{nl}&quot;);
            sb.Append($&quot;LocalPort: {context.Connection.LocalPort}{nl}&quot;);
            sb.Append($&quot;ClientCert: {context.Connection.ClientCertificate}{nl}{nl}&quot;);

            sb.Append($&quot;Identity{rule}&quot;);
            sb.Append($&quot;User: {context.User.Identity.Name}{nl}&quot;);
            var scheme = await authSchemeProvider
                .GetSchemeAsync(IISDefaults.AuthenticationScheme);
            sb.Append($&quot;DisplayName: {scheme?.DisplayName}{nl}{nl}&quot;);

            sb.Append($&quot;Headers{rule}&quot;);
            foreach (var header in context.Request.Headers)
            {
                sb.Append($&quot;{header.Key}: {header.Value}{nl}&quot;);
            }
            sb.Append(nl);

            sb.Append($&quot;Websockets{rule}&quot;);
            if (context.Features.Get&lt;IHttpUpgradeFeature&gt;() != null)
            {
                sb.Append($&quot;Status: Enabled{nl}{nl}&quot;);
            }
            else
            {
                sb.Append($&quot;Status: Disabled{nl}{nl}&quot;);
            }

            sb.Append($&quot;Configuration{rule}&quot;);
            foreach (var pair in config.AsEnumerable())
            {
                sb.Append($&quot;{pair.Path}: {pair.Value}{nl}&quot;);
            }
            sb.Append(nl);

            sb.Append($&quot;Environment Variables{rule}&quot;);
            var vars = System.Environment.GetEnvironmentVariables();
            foreach (var key in vars.Keys.Cast&lt;string&gt;().OrderBy(key =&gt; key, 
                StringComparer.OrdinalIgnoreCase))
            {
                var value = vars[key];
                sb.Append($&quot;{key}: {value}{nl}&quot;);
            }

            context.Response.ContentType = &quot;text/plain&quot;;
            await context.Response.WriteAsync(sb.ToString());
        });
    }
}
</code></pre>
<h2 id="debug-aspnet-core-apps">调试 ASP.NET Core 应用</h2>
<p>以下链接提供有关调试 ASP.NET Core 应用的信息。</p>
<ul>
<li><a href="https://devblogs.microsoft.com/premier-developer/debugging-asp-core-on-linux-with-visual-studio-2017/">在 Linux 上调试 ASP Core</a></li>
<li><a href="https://devblogs.microsoft.com/devops/debugging-net-core-on-unix-over-ssh/">通过 SSH 在 Unix 上调试 .NET Core</a></li>
<li><a href="/visualstudio/debugger/quickstart-debug-aspnet">快速入门：使用 Visual Studio 调试程序调试 ASP.NET</a></li>
<li>有关更多调试信息，请参阅<a href="https://github.com/dotnet/AspNetCore.Docs/issues/2960">此 GitHub 问题</a>。</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
