<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#20351;&#29992; ASP.NET Core &#21644; MongoDB &#21019;&#24314; Web API </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#20351;&#29992; ASP.NET Core &#21644; MongoDB &#21019;&#24314; Web API ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="tutorials/first-mongo-app">
<h1 id="create-a-web-api-with-aspnet-core-and-mongodb">使用 ASP.NET Core 和 MongoDB 创建 Web API</h1>

<p>作者 <a href="https://twitter.com/K2Prk">Pratik Khandelwal</a> 和 <a href="https://twitter.com/Scott_Addie">Scott Addie</a></p>
<div range="&gt;= aspnetcore-3.0">
<p>本教程创建对 <a href="https://www.mongodb.com/what-is-mongodb">MongoDB</a> NoSQL 数据库执行创建、读取、更新和删除 (CRUD) 操作的 Web API。</p>
<p>在本教程中，你将了解：</p>
<div class="checklist">
<ul>
<li>配置 MongoDB</li>
<li>创建 MongoDB 数据库</li>
<li>定义 MongoDB 集合和架构</li>
<li>从 Web API 执行 MongoDB CRUD 操作</li>
<li>自定义 JSON 序列化</li>
</ul>
</div>
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/tutorials/first-mongo-app/samples">查看或下载示例代码</a>（<a class="xref" href="../introduction-to-aspnet-core.html#how-to-download-a-sample">如何下载</a>）</p>
<h2 id="prerequisites">先决条件</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_visual-studio" role="tabpanel" data-tab="visual-studio">

<ul>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK 3.0 或更高版本</a></li>
<li><a href="https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&amp;utm_source=docs.microsoft.com&amp;utm_campaign=inline+link&amp;utm_content=download+vs2019">Visual Studio 2019</a> 与 ASP.NET 和 Web 开发工作负载</li>
<li><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-windows/">MongoDB</a></li>
</ul>
</section>
<section id="tabpanel_CeZOj-G++Q_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<ul>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK 3.0 或更高版本</a></li>
<li><a href="https://code.visualstudio.com/download">Visual Studio Code</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp">用于 Visual Studio Code 的 C#</a></li>
<li><a href="https://docs.mongodb.com/manual/administration/install-community/">MongoDB</a></li>
</ul>
</section>
<section id="tabpanel_CeZOj-G++Q_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<ul>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK 3.0 或更高版本</a></li>
<li><a href="https://visualstudio.microsoft.com/downloads/">Visual Studio for Mac 版本 7.7 或更高版本</a></li>
<li><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/">MongoDB</a></li>
</ul>
</section>
</div>
<h2 id="configure-mongodb">配置 MongoDB</h2>
<p>如果使用的是 Windows，MongoDB 将默认安装在 C:\Program Files\MongoDB 中。 将 C:\Program Files\MongoDB\Server\&lt;version_number&gt;\bin 添加到 <code>Path</code> 环境变量中。 通过此更改可以从开发计算机上的任意位置访问 MongoDB。</p>
<p>使用以下步骤中的 mongo Shell 可以创建数据库、创建集合和存储文档。 有关 mongo Shell 命令的详细信息，请参阅<a href="https://docs.mongodb.com/manual/mongo/#working-with-the-mongo-shell">使用 mongo Shell</a>。</p>
<ol>
<li><p>选择开发计算机上用于存储数据的目录。 例如，Windows 上的 C:\BooksData。 创建目录（如果不存在）。 mongo Shell 不会创建新目录。</p>
</li>
<li><p>打开命令行界面。 运行以下命令以连接到默认端口 27017 上的 MongoDB。 请记得将 <code>&lt;data_directory_path&gt;</code> 替换为上一步中选择的目录。</p>
<pre><code class="lang-console">mongod --dbpath &lt;data_directory_path&gt;
</code></pre>
</li>
<li><p>打开另一个命令行界面实例。 通过运行以下命令来连接到默认测试数据库：</p>
<pre><code class="lang-console">mongo
</code></pre>
</li>
<li><p>在命令行界面中运行下面的命令：</p>
<pre><code class="lang-console">use BookstoreDb
</code></pre>
<p>如果它不存在，则将创建名为 BookstoreDb 的数据库。 如果该数据库存在，则将为事务打开其连接。</p>
</li>
<li><p>使用以下命令创建 <code>Books</code> 集合：</p>
<pre><code class="lang-console">db.createCollection('Books')
</code></pre>
<p>显示以下结果：</p>
<pre><code class="lang-console">{ &quot;ok&quot; : 1 }
</code></pre>
</li>
<li><p>使用以下命令定义 <code>Books</code> 集合的架构并插入两个文档：</p>
<pre><code class="lang-console">db.Books.insertMany([{'Name':'Design Patterns','Price':54.93,'Category':'Computers','Author':'Ralph Johnson'}, {'Name':'Clean Code','Price':43.15,'Category':'Computers','Author':'Robert C. Martin'}])
</code></pre>
<p>显示以下结果：</p>
<pre><code class="lang-console">{
  &quot;acknowledged&quot; : true,
  &quot;insertedIds&quot; : [
    ObjectId(&quot;5bfd996f7b8e48dc15ff215d&quot;),
    ObjectId(&quot;5bfd996f7b8e48dc15ff215e&quot;)
  ]
}
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>本文所示的 ID 与运行此示例时的 ID 不匹配。</p>
</div>
</li>
<li><p>使用以下命令查看数据库中的文档：</p>
<pre><code class="lang-console">db.Books.find({}).pretty()
</code></pre>
<p>显示以下结果：</p>
<pre><code class="lang-console">{
  &quot;_id&quot; : ObjectId(&quot;5bfd996f7b8e48dc15ff215d&quot;),
  &quot;Name&quot; : &quot;Design Patterns&quot;,
  &quot;Price&quot; : 54.93,
  &quot;Category&quot; : &quot;Computers&quot;,
  &quot;Author&quot; : &quot;Ralph Johnson&quot;
}
{
  &quot;_id&quot; : ObjectId(&quot;5bfd996f7b8e48dc15ff215e&quot;),
  &quot;Name&quot; : &quot;Clean Code&quot;,
  &quot;Price&quot; : 43.15,
  &quot;Category&quot; : &quot;Computers&quot;,
  &quot;Author&quot; : &quot;Robert C. Martin&quot;
}
</code></pre>
<p>该架构将为每个文档添加类型 <code>ObjectId</code> 的自动生成的 <code>_id</code> 属性。</p>
</li>
</ol>
<p>数据库可供使用了。 你可以开始创建 ASP.NET Core Web API。</p>
<h2 id="create-the-aspnet-core-web-api-project">创建 ASP.NET Core Web API 项目</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio" role="tabpanel" data-tab="visual-studio">

<ol>
<li><p>转到“文件”&gt;“新建”&gt;“项目”  。</p>
</li>
<li><p>选择“ASP.NET Core Web 应用程序”项目类型，然后选择“下一步” 。</p>
</li>
<li><p>将项目命名为“BooksApi”，然后选择“创建”。</p>
</li>
<li><p>选择“.NET Core”目标框架和“ASP.NET Core 3.0”。 选择“API”项目模板，然后选择“创建” 。</p>
</li>
<li><p>访问 <a href="https://www.nuget.org/packages/MongoDB.Driver/">NuGet 库：MongoDB.Driver</a> 来确定适用于 MongoDB 的 .NET 驱动程序的最新稳定版本。 在“包管理器控制台”窗口中，导航到项目根。 运行以下命令以安装适用于 MongoDB 的 .NET 驱动程序：</p>
<pre><code class="lang-powershell">Install-Package MongoDB.Driver -Version {VERSION}
</code></pre>
</li>
</ol>
</section>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<ol>
<li><p>在命令行界面中运行以下命令：</p>
<pre><code class="lang-dotnetcli">dotnet new webapi -o BooksApi
code BooksApi
</code></pre>
<p>将在 Visual Studio Code 中生成并打开以 .NET Core 为目标的新 ASP.NET Core Web API 项目。</p>
</li>
<li><p>状态栏的 OmniSharp 火焰图标变绿后，对话框将询问“'BooksApi' 缺少生成和调试所需的资产。是否添加它们?”。 选择 <strong>“是”</strong> 。</p>
</li>
<li><p>访问 <a href="https://www.nuget.org/packages/MongoDB.Driver/">NuGet 库：MongoDB.Driver</a> 来确定适用于 MongoDB 的 .NET 驱动程序的最新稳定版本。 打开“集成终端”并导航到项目根。 运行以下命令以安装适用于 MongoDB 的 .NET 驱动程序：</p>
<pre><code class="lang-dotnetcli">dotnet add BooksApi.csproj package MongoDB.Driver -v {VERSION}
</code></pre>
</li>
</ol>
</section>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<ol>
<li>在早于版本 8.6 的 Visual Studio for Mac 中，从边栏中依次选择“文件” &gt; “新建解决方案” &gt; “.NET Core” &gt; “应用”。    在版本 8.6 或更高版本中，从边栏中依次选择“文件” &gt; “新建解决方案” &gt; “Web 和控制台” &gt; “应用”。</li>
<li>依次选择“ASP.NET Core”&gt;“API”C# 项目模板，然后选择“下一步”。</li>
<li>从“目标框架”下拉列表中选择“.NET Core 3.1”，然后选择“下一步”  。</li>
<li>输入“BooksApi”作为“项目名称”，然后选择“创建” 。</li>
<li>在“解决方案”面板中，右键单击项目的“依赖项”节点，然后选择“添加包”。</li>
<li>在搜索框中输入“MongoDB.Driver”，选择“MongoDB.Driver”包，然后选择“添加包” 。</li>
<li>在“许可证接受”对话框中，选择“接受”按钮 。</li>
</ol>
</section>
</div>
<h2 id="add-an-entity-model">添加实体模型</h2>
<ol>
<li><p>将 Models 目录添加到项目根。</p>
</li>
<li><p>使用以下代码将 <code>Book</code> 类添加到 Models 目录：</p>
<pre><code class="lang-csharp">using MongoDB.Bson;
using MongoDB.Bson.Serialization.Attributes;

namespace BooksApi.Models
{
    public class Book
    {
        [BsonId]
        [BsonRepresentation(BsonType.ObjectId)]
        public string Id { get; set; }

        [BsonElement(&quot;Name&quot;)]
        public string BookName { get; set; }

        public decimal Price { get; set; }

        public string Category { get; set; }

        public string Author { get; set; }
    }
}
</code></pre>
<p>在前面的类中，<code>Id</code>属性：</p>
<ul>
<li>需要在将公共语言运行时 (CLR) 对象映射到 MongoDB 集合时使用。</li>
<li>使用 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Bson_Serialization_Attributes_BsonIdAttribute.htm"><code>[BsonId]</code></a> 进行批注，以将此属性指定为文档的主键。</li>
<li>使用 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Bson_Serialization_Attributes_BsonRepresentationAttribute.htm"><code>[BsonRepresentation(BsonType.ObjectId)]</code></a> 进行批注，以允许将参数作为类型 <code>string</code> 而非 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Bson_ObjectId.htm">ObjectId</a> 结构传递。 Mongo 处理从 <code>string</code> 到 <code>ObjectId</code> 的转换。</li>
</ul>
<p><code>BookName</code> 属性使用 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Bson_Serialization_Attributes_BsonElementAttribute.htm"><code>[BsonElement]</code></a> 特性进行批注。 <code>Name</code> 的属性值表示 MongoDB 集合中的属性名称。</p>
</li>
</ol>
<h2 id="add-a-configuration-model">添加配置模型</h2>
<ol>
<li><p>向 appsettings.json 添加以下数据库配置值：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
<li><p>使用以下代码将 BookstoreDatabaseSettings.cs 文件添加到 Models 目录 ：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的 <code>BookstoreDatabaseSettings</code> 类用于存储 appsettings.json 文件的 <code>BookstoreDatabaseSettings</code> 属性值。 JSON 和 C# 具有相同的属性名称，目的是简化映射过程。</p>
</li>
<li><p>将以下突出显示的代码添加到 <code>Startup.ConfigureServices</code>：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>在上述代码中：</p>
<ul>
<li>appsettings.json 文件的 <code>BookstoreDatabaseSettings</code> 部分绑定到的配置实例在依赖关系注入 (DI) 容器中注册。 例如，<code>BookstoreDatabaseSettings</code> 对象的 <code>ConnectionString</code> 属性使用 appsettings.json 中的 <code>BookstoreDatabaseSettings:ConnectionString</code> 属性进行填充。</li>
<li><code>IBookstoreDatabaseSettings</code> 接口使用单一实例<a class="xref" href="../fundamentals/dependency-injection.html#service-lifetimes">服务生存期</a>在 DI 中注册。 在注入时，接口实例时将解析为 <code>BookstoreDatabaseSettings</code> 对象。</li>
</ul>
</li>
<li><p>在 Startup.cs 顶部添加以下代码，以解析 <code>BookstoreDatabaseSettings</code> 和 <code>IBookstoreDatabaseSettings</code> 引用：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
</ol>
<h2 id="add-a-crud-operations-service">添加 CRUD 操作服务</h2>
<ol>
<li><p>将 Services 目录添加到项目根。</p>
</li>
<li><p>使用以下代码将 <code>BookService</code> 类添加到 Services 目录：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>上面的代码通过构造函数注入从 DI 检索 <code>IBookstoreDatabaseSettings</code> 实例。 使用此方法可访问在<a href="#add-a-configuration-model">添加配置模型</a>部分添加的 appsettings.json 配置值。</p>
</li>
<li><p>将以下突出显示的代码添加到 <code>Startup.ConfigureServices</code>：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>上面的代码向 DI 注册了 <code>BookService</code> 类，以支持消费类中的构造函数注入。 单一实例服务生存期是最合适的，因为 <code>BookService</code> 直接依赖于 <code>MongoClient</code>。 根据官方 <a href="https://mongodb.github.io/mongo-csharp-driver/2.8/reference/driver/connecting/#re-use">Mongo Client 重用准则</a>，应使用单一实例服务生存期在 DI 中注册 <code>MongoClient</code>。</p>
</li>
<li><p>在 Startup.cs 顶部添加以下代码，以解析 <code>BookService</code> 引用：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
</ol>
<p><code>BookService</code> 类使用以下 <code>MongoDB.Driver</code> 成员对数据库执行 CRUD 操作：</p>
<ul>
<li><p><a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Driver_MongoClient.htm">MongoClient</a>：读取用于执行数据库操作的服务器实例。 此类的构造函数提供了 MongoDB 连接字符串：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
<li><p><a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Driver_IMongoDatabase.htm">IMongoDatabase</a>：表示用于执行操作的 Mongo 数据库。 本教程在界面上使用泛型 <a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoDatabase_GetCollection__1.htm">GetCollection&lt;TDocument&gt;(collection)</a> 方法来获取对特定集合中的数据的访问权限。 调用此方法后，对集合执行 CRUD 操作。 在 <code>GetCollection&lt;TDocument&gt;(collection)</code> 方法调用中：</p>
<ul>
<li><code>collection</code> 表示集合名称。</li>
<li><code>TDocument</code> 表示存储在集合中的 CLR 对象类型。</li>
</ul>
</li>
</ul>
<p><code>GetCollection&lt;TDocument&gt;(collection)</code> 返回表示集合的 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Driver_MongoCollection.htm">MongoCollection</a> 对象。 在本教程中，对集合调用以下方法：</p>
<ul>
<li><a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoCollection_1_DeleteOne.htm">DeleteOne</a>：删除与提供的搜索条件匹配的单个文档。</li>
<li><a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoCollectionExtensions_Find__1_1.htm">Find&lt;TDocument&gt;</a>：返回集合中与提供的搜索条件匹配的所有文档。</li>
<li><a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoCollection_1_InsertOne.htm">InsertOne</a>：插入提供的对象作为集合中的新文档。</li>
<li><a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoCollection_1_ReplaceOne.htm">ReplaceOne</a>：将与提供的搜索条件匹配的单个文档替换为提供的对象。</li>
</ul>
<h2 id="add-a-controller">添加控制器</h2>
<p>使用以下代码将 <code>BooksController</code> 类添加到 Controllers 目录：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的 Web API 控制器：</p>
<ul>
<li>使用 <code>BookService</code> 类执行 CRUD 操作。</li>
<li>包含操作方法以支持 GET、POST、PUT 和 DELETE HTTP 请求。</li>
<li>在 <code>Create</code> 操作方法中调用 &lt;xref:System.Web.Http.ApiController.CreatedAtRoute*&gt;，以返回 <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP 201</a> 响应。 状态代码 201 是在服务器上创建新资源的 HTTP POST 方法的标准响应。 <code>CreatedAtRoute</code> 还会将 <code>Location</code> 标头添加到响应中。 <code>Location</code> 标头指定新建书籍的 URI。</li>
</ul>
<h2 id="test-the-web-api">测试 Web API</h2>
<ol>
<li><p>生成并运行应用。</p>
</li>
<li><p>导航到 <code>http://localhost:&lt;port&gt;/api/books</code>，测试控制器的无参数 <code>Get</code> 操作方法。 将显示下面的 JSON 响应：</p>
<pre><code class="lang-json">[
  {
    &quot;id&quot;:&quot;5bfd996f7b8e48dc15ff215d&quot;,
    &quot;bookName&quot;:&quot;Design Patterns&quot;,
    &quot;price&quot;:54.93,
    &quot;category&quot;:&quot;Computers&quot;,
    &quot;author&quot;:&quot;Ralph Johnson&quot;
  },
  {
    &quot;id&quot;:&quot;5bfd996f7b8e48dc15ff215e&quot;,
    &quot;bookName&quot;:&quot;Clean Code&quot;,
    &quot;price&quot;:43.15,
    &quot;category&quot;:&quot;Computers&quot;,
    &quot;author&quot;:&quot;Robert C. Martin&quot;
  }
]
</code></pre>
</li>
<li><p>导航到 <code>http://localhost:&lt;port&gt;/api/books/{id here}</code>，测试控制器的重载 <code>Get</code> 操作方法。 将显示下面的 JSON 响应：</p>
<pre><code class="lang-json">{
  &quot;id&quot;:&quot;{ID}&quot;,
  &quot;bookName&quot;:&quot;Clean Code&quot;,
  &quot;price&quot;:43.15,
  &quot;category&quot;:&quot;Computers&quot;,
  &quot;author&quot;:&quot;Robert C. Martin&quot;
}
</code></pre>
</li>
</ol>
<h2 id="configure-json-serialization-options">配置 JSON 序列化选项</h2>
<p>关于在<a href="#test-the-web-api">测试 Web API</a> 部分中返回的 JSON 响应，有两个细节需要更改：</p>
<ul>
<li>应更改属性名称的默认驼峰式大小写风格，以匹配 CLR 对象属性名称的 Pascal 大小写。</li>
<li><code>bookName</code> 属性应作为 <code>Name</code> 返回。</li>
</ul>
<p>为满足上述要求，请进行以下更改：</p>
<ol>
<li><p>JSON.NET 已从 ASP.NET 共享框架中删除。 将包引用添加到 <a href="https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson"><code>Microsoft.AspNetCore.Mvc.NewtonsoftJson</code></a>。</p>
</li>
<li><p>在 <code>Startup.ConfigureServices</code> 中，将以下突出显示的代码链接到 <code>AddControllers</code> 方法调用：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>通过上述更改，Web API 的序列化 JSON 响应中的属性名称与 CLR 对象类型中其相应的属性名称匹配。 例如，<code>Book</code> 类的 <code>Author</code> 属性序列化为 <code>Author</code>。</p>
</li>
<li><p>在 Models/Book.cs 中，使用以下 <a href="https://www.newtonsoft.com/json/help/html/T_Newtonsoft_Json_JsonPropertyAttribute.htm"><code>[JsonProperty]</code></a> 特性批注 <code>BookName</code> 属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>[JsonProperty]</code> 属性的 <code>Name</code> 值表示 Web API 的序列化 JSON 响应中的属性名称。</p>
</li>
<li><p>在 Models/Book.cs 顶部添加以下代码，以解析 <code>[JsonProperty]</code> 属性引用：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
<li><p>重复<a href="#test-the-web-api">测试 Web API</a> 部分中定义的步骤。 注意 JSON 属性名称中的区别。</p>
</li>
</ol>
</div>
<div range="&lt; aspnetcore-3.0">
<p>本教程创建对 <a href="https://www.mongodb.com/what-is-mongodb">MongoDB</a> NoSQL 数据库执行创建、读取、更新和删除 (CRUD) 操作的 Web API。</p>
<p>在本教程中，你将了解：</p>
<div class="checklist">
<ul>
<li>配置 MongoDB</li>
<li>创建 MongoDB 数据库</li>
<li>定义 MongoDB 集合和架构</li>
<li>从 Web API 执行 MongoDB CRUD 操作</li>
<li>自定义 JSON 序列化</li>
</ul>
</div>
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/tutorials/first-mongo-app/samples">查看或下载示例代码</a>（<a class="xref" href="../introduction-to-aspnet-core.html#how-to-download-a-sample">如何下载</a>）</p>
<h2 id="prerequisites">先决条件</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-2_visual-studio" role="tabpanel" data-tab="visual-studio">

<ul>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK 2.2</a></li>
<li><a href="https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&amp;utm_source=docs.microsoft.com&amp;utm_campaign=inline+link&amp;utm_content=download+vs2019">Visual Studio 2019</a> 与 ASP.NET 和 Web 开发工作负载</li>
<li><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-windows/">MongoDB</a></li>
</ul>
</section>
<section id="tabpanel_CeZOj-G++Q-2_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<ul>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK 2.2</a></li>
<li><a href="https://code.visualstudio.com/download">Visual Studio Code</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp">用于 Visual Studio Code 的 C#</a></li>
<li><a href="https://docs.mongodb.com/manual/administration/install-community/">MongoDB</a></li>
</ul>
</section>
<section id="tabpanel_CeZOj-G++Q-2_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<ul>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core">.NET Core SDK 2.2</a></li>
<li><a href="https://visualstudio.microsoft.com/downloads/">Visual Studio for Mac 版本 7.7 或更高版本</a></li>
<li><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/">MongoDB</a></li>
</ul>
</section>
</div>
<h2 id="configure-mongodb">配置 MongoDB</h2>
<p>如果使用的是 Windows，MongoDB 将默认安装在 C:\Program Files\MongoDB 中。 将 C:\Program Files\MongoDB\Server\&lt;version_number&gt;\bin 添加到 <code>Path</code> 环境变量中。 通过此更改可以从开发计算机上的任意位置访问 MongoDB。</p>
<p>使用以下步骤中的 mongo Shell 可以创建数据库、创建集合和存储文档。 有关 mongo Shell 命令的详细信息，请参阅<a href="https://docs.mongodb.com/manual/mongo/#working-with-the-mongo-shell">使用 mongo Shell</a>。</p>
<ol>
<li><p>选择开发计算机上用于存储数据的目录。 例如，Windows 上的 C:\BooksData。 创建目录（如果不存在）。 mongo Shell 不会创建新目录。</p>
</li>
<li><p>打开命令行界面。 运行以下命令以连接到默认端口 27017 上的 MongoDB。 请记得将 <code>&lt;data_directory_path&gt;</code> 替换为上一步中选择的目录。</p>
<pre><code class="lang-console">mongod --dbpath &lt;data_directory_path&gt;
</code></pre>
</li>
<li><p>打开另一个命令行界面实例。 通过运行以下命令来连接到默认测试数据库：</p>
<pre><code class="lang-console">mongo
</code></pre>
</li>
<li><p>在命令行界面中运行下面的命令：</p>
<pre><code class="lang-console">use BookstoreDb
</code></pre>
<p>如果它不存在，则将创建名为 BookstoreDb 的数据库。 如果该数据库存在，则将为事务打开其连接。</p>
</li>
<li><p>使用以下命令创建 <code>Books</code> 集合：</p>
<pre><code class="lang-console">db.createCollection('Books')
</code></pre>
<p>显示以下结果：</p>
<pre><code class="lang-console">{ &quot;ok&quot; : 1 }
</code></pre>
</li>
<li><p>使用以下命令定义 <code>Books</code> 集合的架构并插入两个文档：</p>
<pre><code class="lang-console">db.Books.insertMany([{'Name':'Design Patterns','Price':54.93,'Category':'Computers','Author':'Ralph Johnson'}, {'Name':'Clean Code','Price':43.15,'Category':'Computers','Author':'Robert C. Martin'}])
</code></pre>
<p>显示以下结果：</p>
<pre><code class="lang-console">{
  &quot;acknowledged&quot; : true,
  &quot;insertedIds&quot; : [
    ObjectId(&quot;5bfd996f7b8e48dc15ff215d&quot;),
    ObjectId(&quot;5bfd996f7b8e48dc15ff215e&quot;)
  ]
}
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>本文所示的 ID 与运行此示例时的 ID 不匹配。</p>
</div>
</li>
<li><p>使用以下命令查看数据库中的文档：</p>
<pre><code class="lang-console">db.Books.find({}).pretty()
</code></pre>
<p>显示以下结果：</p>
<pre><code class="lang-console">{
  &quot;_id&quot; : ObjectId(&quot;5bfd996f7b8e48dc15ff215d&quot;),
  &quot;Name&quot; : &quot;Design Patterns&quot;,
  &quot;Price&quot; : 54.93,
  &quot;Category&quot; : &quot;Computers&quot;,
  &quot;Author&quot; : &quot;Ralph Johnson&quot;
}
{
  &quot;_id&quot; : ObjectId(&quot;5bfd996f7b8e48dc15ff215e&quot;),
  &quot;Name&quot; : &quot;Clean Code&quot;,
  &quot;Price&quot; : 43.15,
  &quot;Category&quot; : &quot;Computers&quot;,
  &quot;Author&quot; : &quot;Robert C. Martin&quot;
}
</code></pre>
<p>该架构将为每个文档添加类型 <code>ObjectId</code> 的自动生成的 <code>_id</code> 属性。</p>
</li>
</ol>
<p>数据库可供使用了。 你可以开始创建 ASP.NET Core Web API。</p>
<h2 id="create-the-aspnet-core-web-api-project">创建 ASP.NET Core Web API 项目</h2>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-3_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-3_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-3_visual-studio-code" role="tab" aria-controls="tabpanel_CeZOj-G++Q-3_visual-studio-code" data-tab="visual-studio-code" tabindex="-1">Visual Studio Code</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-3_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-3_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-3_visual-studio" role="tabpanel" data-tab="visual-studio">

<ol>
<li><p>转到“文件”&gt;“新建”&gt;“项目”  。</p>
</li>
<li><p>选择“ASP.NET Core Web 应用程序”项目类型，然后选择“下一步” 。</p>
</li>
<li><p>将项目命名为“BooksApi”，然后选择“创建”。</p>
</li>
<li><p>选择“.NET Core”目标框架和“ASP.NET Core 2.2”。 选择“API”项目模板，然后选择“创建” 。</p>
</li>
<li><p>访问 <a href="https://www.nuget.org/packages/MongoDB.Driver/">NuGet 库：MongoDB.Driver</a> 来确定适用于 MongoDB 的 .NET 驱动程序的最新稳定版本。 在“包管理器控制台”窗口中，导航到项目根。 运行以下命令以安装适用于 MongoDB 的 .NET 驱动程序：</p>
<pre><code class="lang-powershell">Install-Package MongoDB.Driver -Version {VERSION}
</code></pre>
</li>
</ol>
</section>
<section id="tabpanel_CeZOj-G++Q-3_visual-studio-code" role="tabpanel" data-tab="visual-studio-code" aria-hidden="true" hidden="hidden">

<ol>
<li><p>在命令行界面中运行以下命令：</p>
<pre><code class="lang-dotnetcli">dotnet new webapi -o BooksApi
code BooksApi
</code></pre>
<p>将在 Visual Studio Code 中生成并打开以 .NET Core 为目标的新 ASP.NET Core Web API 项目。</p>
</li>
<li><p>状态栏的 OmniSharp 火焰图标变绿后，对话框将询问“'BooksApi' 缺少生成和调试所需的资产。是否添加它们?”。 选择 <strong>“是”</strong> 。</p>
</li>
<li><p>访问 <a href="https://www.nuget.org/packages/MongoDB.Driver/">NuGet 库：MongoDB.Driver</a> 来确定适用于 MongoDB 的 .NET 驱动程序的最新稳定版本。 打开“集成终端”并导航到项目根。 运行以下命令以安装适用于 MongoDB 的 .NET 驱动程序：</p>
<pre><code class="lang-dotnetcli">dotnet add BooksApi.csproj package MongoDB.Driver -v {VERSION}
</code></pre>
</li>
</ol>
</section>
<section id="tabpanel_CeZOj-G++Q-3_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<ol>
<li>在早于版本 8.6 的 Visual Studio for Mac 中，从边栏中依次选择“文件” &gt; “新建解决方案” &gt; “.NET Core” &gt; “应用”。    在版本 8.6 或更高版本中，从边栏中依次选择“文件” &gt; “新建解决方案” &gt; “Web 和控制台” &gt; “应用”。</li>
<li>选择“ASP.NET Core Web API”C# 项目模板，然后选择“下一步” 。</li>
<li>从“目标框架”下拉列表中选择“.NET Core 2.2”，然后选择“下一步”  。</li>
<li>输入“BooksApi”作为“项目名称”，然后选择“创建” 。</li>
<li>在“解决方案”面板中，右键单击项目的“依赖项”节点，然后选择“添加包”。</li>
<li>在搜索框中输入“MongoDB.Driver”，选择“MongoDB.Driver”包，然后选择“添加包” 。</li>
<li>在“许可证接受”对话框中，选择“接受”按钮 。</li>
</ol>
</section>
</div>
<h2 id="add-an-entity-model">添加实体模型</h2>
<ol>
<li><p>将 Models 目录添加到项目根。</p>
</li>
<li><p>使用以下代码将 <code>Book</code> 类添加到 Models 目录：</p>
<pre><code class="lang-csharp">using MongoDB.Bson;
using MongoDB.Bson.Serialization.Attributes;

namespace BooksApi.Models
{
    public class Book
    {
        [BsonId]
        [BsonRepresentation(BsonType.ObjectId)]
        public string Id { get; set; }

        [BsonElement(&quot;Name&quot;)]
        public string BookName { get; set; }

        public decimal Price { get; set; }

        public string Category { get; set; }

        public string Author { get; set; }
    }
}
</code></pre>
<p>在前面的类中，<code>Id</code>属性：</p>
<ul>
<li>需要在将公共语言运行时 (CLR) 对象映射到 MongoDB 集合时使用。</li>
<li>使用 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Bson_Serialization_Attributes_BsonIdAttribute.htm"><code>[BsonId]</code></a> 进行批注，以将此属性指定为文档的主键。</li>
<li>使用 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Bson_Serialization_Attributes_BsonRepresentationAttribute.htm"><code>[BsonRepresentation(BsonType.ObjectId)]</code></a> 进行批注，以允许将参数作为类型 <code>string</code> 而非 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Bson_ObjectId.htm">ObjectId</a> 结构传递。 Mongo 处理从 <code>string</code> 到 <code>ObjectId</code> 的转换。</li>
</ul>
<p><code>BookName</code> 属性使用 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Bson_Serialization_Attributes_BsonElementAttribute.htm"><code>[BsonElement]</code></a> 特性进行批注。 <code>Name</code> 的属性值表示 MongoDB 集合中的属性名称。</p>
</li>
</ol>
<h2 id="add-a-configuration-model">添加配置模型</h2>
<ol>
<li><p>向 appsettings.json 添加以下数据库配置值：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
<li><p>使用以下代码将 BookstoreDatabaseSettings.cs 文件添加到 Models 目录 ：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的 <code>BookstoreDatabaseSettings</code> 类用于存储 appsettings.json 文件的 <code>BookstoreDatabaseSettings</code> 属性值。 JSON 和 C# 具有相同的属性名称，目的是简化映射过程。</p>
</li>
<li><p>将以下突出显示的代码添加到 <code>Startup.ConfigureServices</code>：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>在上述代码中：</p>
<ul>
<li>appsettings.json 文件的 <code>BookstoreDatabaseSettings</code> 部分绑定到的配置实例在依赖关系注入 (DI) 容器中注册。 例如，<code>BookstoreDatabaseSettings</code> 对象的 <code>ConnectionString</code> 属性使用 appsettings.json 中的 <code>BookstoreDatabaseSettings:ConnectionString</code> 属性进行填充。</li>
<li><code>IBookstoreDatabaseSettings</code> 接口使用单一实例<a class="xref" href="../fundamentals/dependency-injection.html#service-lifetimes">服务生存期</a>在 DI 中注册。 在注入时，接口实例时将解析为 <code>BookstoreDatabaseSettings</code> 对象。</li>
</ul>
</li>
<li><p>在 Startup.cs 顶部添加以下代码，以解析 <code>BookstoreDatabaseSettings</code> 和 <code>IBookstoreDatabaseSettings</code> 引用：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
</ol>
<h2 id="add-a-crud-operations-service">添加 CRUD 操作服务</h2>
<ol>
<li><p>将 Services 目录添加到项目根。</p>
</li>
<li><p>使用以下代码将 <code>BookService</code> 类添加到 Services 目录：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>上面的代码通过构造函数注入从 DI 检索 <code>IBookstoreDatabaseSettings</code> 实例。 使用此方法可访问在<a href="#add-a-configuration-model">添加配置模型</a>部分添加的 appsettings.json 配置值。</p>
</li>
<li><p>将以下突出显示的代码添加到 <code>Startup.ConfigureServices</code>：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>上面的代码向 DI 注册了 <code>BookService</code> 类，以支持消费类中的构造函数注入。 单一实例服务生存期是最合适的，因为 <code>BookService</code> 直接依赖于 <code>MongoClient</code>。 根据官方 <a href="https://mongodb.github.io/mongo-csharp-driver/2.8/reference/driver/connecting/#re-use">Mongo Client 重用准则</a>，应使用单一实例服务生存期在 DI 中注册 <code>MongoClient</code>。</p>
</li>
<li><p>在 Startup.cs 顶部添加以下代码，以解析 <code>BookService</code> 引用：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
</ol>
<p><code>BookService</code> 类使用以下 <code>MongoDB.Driver</code> 成员对数据库执行 CRUD 操作：</p>
<ul>
<li><p><a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Driver_MongoClient.htm">MongoClient</a>：读取用于执行数据库操作的服务器实例。 此类的构造函数提供了 MongoDB 连接字符串：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
<li><p><a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Driver_IMongoDatabase.htm">IMongoDatabase</a>：表示用于执行操作的 Mongo 数据库。 本教程在界面上使用泛型 <a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoDatabase_GetCollection__1.htm">GetCollection&lt;TDocument&gt;(collection)</a> 方法来获取对特定集合中的数据的访问权限。 调用此方法后，对集合执行 CRUD 操作。 在 <code>GetCollection&lt;TDocument&gt;(collection)</code> 方法调用中：</p>
<ul>
<li><code>collection</code> 表示集合名称。</li>
<li><code>TDocument</code> 表示存储在集合中的 CLR 对象类型。</li>
</ul>
</li>
</ul>
<p><code>GetCollection&lt;TDocument&gt;(collection)</code> 返回表示集合的 <a href="https://api.mongodb.com/csharp/current/html/T_MongoDB_Driver_MongoCollection.htm">MongoCollection</a> 对象。 在本教程中，对集合调用以下方法：</p>
<ul>
<li><a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoCollection_1_DeleteOne.htm">DeleteOne</a>：删除与提供的搜索条件匹配的单个文档。</li>
<li><a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoCollectionExtensions_Find__1_1.htm">Find&lt;TDocument&gt;</a>：返回集合中与提供的搜索条件匹配的所有文档。</li>
<li><a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoCollection_1_InsertOne.htm">InsertOne</a>：插入提供的对象作为集合中的新文档。</li>
<li><a href="https://api.mongodb.com/csharp/current/html/M_MongoDB_Driver_IMongoCollection_1_ReplaceOne.htm">ReplaceOne</a>：将与提供的搜索条件匹配的单个文档替换为提供的对象。</li>
</ul>
<h2 id="add-a-controller">添加控制器</h2>
<p>使用以下代码将 <code>BooksController</code> 类添加到 Controllers 目录：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>前面的 Web API 控制器：</p>
<ul>
<li>使用 <code>BookService</code> 类执行 CRUD 操作。</li>
<li>包含操作方法以支持 GET、POST、PUT 和 DELETE HTTP 请求。</li>
<li>在 <code>Create</code> 操作方法中调用 &lt;xref:System.Web.Http.ApiController.CreatedAtRoute*&gt;，以返回 <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP 201</a> 响应。 状态代码 201 是在服务器上创建新资源的 HTTP POST 方法的标准响应。 <code>CreatedAtRoute</code> 还会将 <code>Location</code> 标头添加到响应中。 <code>Location</code> 标头指定新建书籍的 URI。</li>
</ul>
<h2 id="test-the-web-api">测试 Web API</h2>
<ol>
<li><p>生成并运行应用。</p>
</li>
<li><p>导航到 <code>http://localhost:&lt;port&gt;/api/books</code>，测试控制器的无参数 <code>Get</code> 操作方法。 将显示下面的 JSON 响应：</p>
<pre><code class="lang-json">[
  {
    &quot;id&quot;:&quot;5bfd996f7b8e48dc15ff215d&quot;,
    &quot;bookName&quot;:&quot;Design Patterns&quot;,
    &quot;price&quot;:54.93,
    &quot;category&quot;:&quot;Computers&quot;,
    &quot;author&quot;:&quot;Ralph Johnson&quot;
  },
  {
    &quot;id&quot;:&quot;5bfd996f7b8e48dc15ff215e&quot;,
    &quot;bookName&quot;:&quot;Clean Code&quot;,
    &quot;price&quot;:43.15,
    &quot;category&quot;:&quot;Computers&quot;,
    &quot;author&quot;:&quot;Robert C. Martin&quot;
  }
]
</code></pre>
</li>
<li><p>导航到 <code>http://localhost:&lt;port&gt;/api/books/{id here}</code>，测试控制器的重载 <code>Get</code> 操作方法。 将显示下面的 JSON 响应：</p>
<pre><code class="lang-json">{
  &quot;id&quot;:&quot;{ID}&quot;,
  &quot;bookName&quot;:&quot;Clean Code&quot;,
  &quot;price&quot;:43.15,
  &quot;category&quot;:&quot;Computers&quot;,
  &quot;author&quot;:&quot;Robert C. Martin&quot;
}
</code></pre>
</li>
</ol>
<h2 id="configure-json-serialization-options">配置 JSON 序列化选项</h2>
<p>关于在<a href="#test-the-web-api">测试 Web API</a> 部分中返回的 JSON 响应，有两个细节需要更改：</p>
<ul>
<li>应更改属性名称的默认驼峰式大小写风格，以匹配 CLR 对象属性名称的 Pascal 大小写。</li>
<li><code>bookName</code> 属性应作为 <code>Name</code> 返回。</li>
</ul>
<p>为满足上述要求，请进行以下更改：</p>
<ol>
<li><p>在 <code>Startup.ConfigureServices</code> 中，将以下突出显示的代码链接到 <code>AddMvc</code> 方法调用：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>通过上述更改，Web API 的序列化 JSON 响应中的属性名称与 CLR 对象类型中其相应的属性名称匹配。 例如，<code>Book</code> 类的 <code>Author</code> 属性序列化为 <code>Author</code>。</p>
</li>
<li><p>在 Models/Book.cs 中，使用以下 <a href="https://www.newtonsoft.com/json/help/html/T_Newtonsoft_Json_JsonPropertyAttribute.htm"><code>[JsonProperty]</code></a> 特性批注 <code>BookName</code> 属性：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>[JsonProperty]</code> 属性的 <code>Name</code> 值表示 Web API 的序列化 JSON 响应中的属性名称。</p>
</li>
<li><p>在 Models/Book.cs 顶部添加以下代码，以解析 <code>[JsonProperty]</code> 属性引用：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></li>
<li><p>重复<a href="#test-the-web-api">测试 Web API</a> 部分中定义的步骤。 注意 JSON 属性名称中的区别。</p>
</li>
</ol>
</div>
<h2 id="add-authentication-support-to-a-web-api">向 Web API 添加身份验证支持</h2>
<p>ASP.NET Core 标识将用户界面 (UI) 登录功能添加到 ASP.NET Core Web 应用。 若要保护 Web API 和 SPA，请使用以下项之一：</p>
<ul>
<li><a href="/azure/api-management/api-management-howto-protect-backend-with-aad">Azure Active Directory</a></li>
<li><a href="/azure/active-directory-b2c/active-directory-b2c-custom-rest-api-netfw">Azure Active Directory B2C</a> (Azure AD B2C)</li>
<li><a href="https://identityserver.io">IdentityServer4</a></li>
</ul>
<p>IdentityServer4 是适用于 ASP.NET Core 的 OpenID Connect 和 OAuth 2.0 框架。 IdentityServer4 支持以下安全功能：</p>
<ul>
<li>身份验证即服务 (AaaS)</li>
<li>跨多个应用程序类型的单一登录/注销 (SSO)</li>
<li>API 的访问控制</li>
<li>Federation Gateway</li>
</ul>
<p>有关详细信息，请参阅<a href="https://docs.identityserver.io/en/latest/index.html">欢迎使用 IdentityServer4</a>。</p>
<h2 id="next-steps">后续步骤</h2>
<p>有关构建 ASP.NET Core Web API 的详细信息，请参阅以下资源：</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=7uJt_sOenyo&amp;feature=youtu.be">本文的 YouTube 版本</a></li>
<li><a class="xref" href="../web-api/index.html">使用 ASP.NET Core 创建 Web API</a></li>
<li><a class="xref" href="../web-api/action-return-types.html">ASP.NET Core Web API 中控制器操作的返回类型</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
