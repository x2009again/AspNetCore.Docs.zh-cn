<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>NSwag &#21644; ASP.NET Core &#20837;&#38376; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="NSwag &#21644; ASP.NET Core &#20837;&#38376; ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="tutorials/get-started-with-nswag">
<h1 id="get-started-with-nswag-and-aspnet-core">NSwag 和 ASP.NET Core 入门</h1>

<p>作者：<a href="https://twitter.com/zuckerthoben">Christoph Nienaber</a>、<a href="https://rsuter.com">Rico Suter</a> 和 <a href="https://twitter.com/daveabrock">Dave Brock</a></p>
<div range="&gt;= aspnetcore-2.1">
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/tutorials/web-api-help-pages-using-swagger/samples/2.1/TodoApi.NSwag">查看或下载示例代码</a>（<a class="xref" href="../introduction-to-aspnet-core.html#how-to-download-a-sample">如何下载</a>）</p>
</div>
<div range="&lt;= aspnetcore-2.0">
<p><a href="https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/tutorials/web-api-help-pages-using-swagger/samples/2.0/TodoApi.NSwag">查看或下载示例代码</a>（<a class="xref" href="../introduction-to-aspnet-core.html#how-to-download-a-sample">如何下载</a>）</p>
</div>
<p>NSwag 提供了下列功能：</p>
<ul>
<li>能够使用 Swagger UI 和 Swagger 生成器。</li>
<li>灵活的代码生成功能。</li>
</ul>
<p>借助 NSwag，无需使用现有 API。也就是说，可使用包含 Swagger 的第三方 API，并生成客户端实现。 使用 NSwag，可以加快开发周期，并轻松适应 API 更改。</p>
<h2 id="register-the-nswag-middleware">注册 NSwag 中间件</h2>
<p>注册 NSwag 中间件即可：</p>
<ul>
<li>生成已实现的 Web API 的 Swagger 规范。</li>
<li>为 Swagger UI 提供服务以浏览和测试 Web API。</li>
</ul>
<p>若要使用 <a href="https://github.com/RicoSuter/NSwag">NSwag</a> ASP.NET Core 中间件，请安装 <a href="https://www.nuget.org/packages/NSwag.AspNetCore/">NSwag.AspNetCore</a> NuGet 包。 此包内的中间件可用于生成并提供Swagger 规范、Swagger UI（v2 和 v3）和 <a href="https://github.com/Rebilly/ReDoc">ReDoc UI</a>。</p>
<p>若要安装 NSwag NuGet 包，请使用以下方法之一：</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_netcore-cli" role="tab" aria-controls="tabpanel_CeZOj-G++Q_netcore-cli" data-tab="netcore-cli" tabindex="-1">.NET Core CLI</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_visual-studio" role="tabpanel" data-tab="visual-studio">

<ul>
<li><p>从“程序包管理器控制台”窗口：</p>
<ul>
<li><p>转到“视图” &gt; “其他窗口” &gt; “程序包管理器控制台”</p>
</li>
<li><p>导航到包含 TodoApi.csproj 文件的目录</p>
</li>
<li><p>请执行以下命令：</p>
<pre><code class="lang-powershell">Install-Package NSwag.AspNetCore
</code></pre>
</li>
</ul>
</li>
<li><p>从“管理 NuGet 程序包”对话框中：</p>
<ul>
<li>右键单击“解决方案资源管理器” &gt; “管理 NuGet 包”中的项目</li>
<li>将“包源”设置为“nuget.org”</li>
<li>在搜索框中输入“NSwag.AspNetCore”</li>
<li>从“浏览”选项卡中选择“NSwag.AspNetCore”包，然后单击“安装”</li>
</ul>
</li>
</ul>
</section>
<section id="tabpanel_CeZOj-G++Q_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">

<ul>
<li>右键单击“Solution Pad” &gt; “添加包...”中的“包”文件夹</li>
<li>将“添加包”窗口的“源”下拉列表设置为“nuget.org”</li>
<li>在搜索框中输入“NSwag.AspNetCore”</li>
<li>从结果窗格中选择“NSwag.AspNetCore”包，然后单击“添加包”</li>
</ul>
</section>
<section id="tabpanel_CeZOj-G++Q_netcore-cli" role="tabpanel" data-tab="netcore-cli" aria-hidden="true" hidden="hidden">

<p>运行下面的命令：</p>
<pre><code class="lang-dotnetcli">dotnet add TodoApi.csproj package NSwag.AspNetCore
</code></pre>
</section>
</div>
<h2 id="add-and-configure-swagger-middleware">添加并配置 Swagger 中间件</h2>
<p>通过执行以下步骤，在 ASP.NET Core 应用中添加和配置 Swagger：</p>
<ul>
<li>在 <code>Startup.ConfigureServices</code> 方法中，注册所需的 Swagger 服务：</li>
</ul>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<ul>
<li>在 <code>Startup.Configure</code> 方法中，启用中间件为生成的 Swagger 规范和 Swagger UI 提供服务：</li>
</ul>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<ul>
<li>启动应用。 转到：
<ul>
<li><code>http://localhost:&lt;port&gt;/swagger</code>，以查看 Swagger UI。</li>
<li><code>http://localhost:&lt;port&gt;/swagger/v1/swagger.json</code>，以查看 Swagger 规范。</li>
</ul>
</li>
</ul>
<h2 id="code-generation">代码生成</h2>
<p>若要利用 NSwag 的代码生成功能，可选择以下选项之一：</p>
<ul>
<li><a href="https://github.com/RicoSuter/NSwag/wiki/NSwagStudio">NSwagStudio</a>：一款 Windows 桌面应用，用于在 C# 或 TypeScript 中生成 API 客户端代码。</li>
<li><a href="https://www.nuget.org/packages/NSwag.CodeGeneration.CSharp/">NSwag.CodeGeneration.CSharp</a> 或 <a href="https://www.nuget.org/packages/NSwag.CodeGeneration.TypeScript/">NSwag.CodeGeneration.TypeScript</a> NuGet 包 - 用于在项目中生成代码。</li>
<li>通过<a href="https://github.com/RicoSuter/NSwag/wiki/CommandLine">命令行</a>使用 NSwag。</li>
<li><a href="https://github.com/RicoSuter/NSwag/wiki/NSwag.MSBuild">NSwag.MSBuild</a> NuGet 包。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=Unchase.unchaseopenapiconnectedservice">Unchase OpenAPI (Swagger) Connected Service</a>（Unchase OpenAPI (Swagger) 连接服务）：一种 Visual Studio 连接服务，用于在 C# 或 TypeScript 中生成 API 客户端代码。 还可以使用 NSwag 为 OpenAPI 服务生成 C# 控制器。</li>
</ul>
<h3 id="generate-code-with-nswagstudio">使用 NSwagStudio 生成代码</h3>
<ul>
<li><p>按照 <a href="https://github.com/RicoSuter/NSwag/wiki/NSwagStudio">NSwagStudio GitHub 存储库</a>中的说明操作，以安装 NSwagStudio。 在 NSwag 发布页面上，可以下载无需安装和管理员权限即可启动的 xcopy 版本。</p>
</li>
<li><p>启动 NSwagStudio，并在“Swagger 规范 URL”文本框中输入 swagger.json 文件 URL。 例如， <em>http://localhost:44354/swagger/v1/swagger.json</em> 。</p>
</li>
<li><p>单击“创建本地副本”按钮，以生成 Swagger 规范的 JSON 表示形式。</p>
<p><img src="web-api-help-pages-using-swagger/_static/CreateLocalCopy-NSwagStudio.PNG" alt="创建 Swagger 规范的本地副本"></p>
</li>
<li><p>在“输出”区域中，单击选中“C# 客户端”复选框。 也可以选中“TypeScript 客户端”或“C# Web API 控制器”，具体视项目而定。 如果选中“C# Web API 控制器”，服务规范会重新生成服务，起到反向生成的作用。</p>
</li>
<li><p>单击“生成输出”，以生成 TodoApi.NSwag 项目的完整 C# 客户端实现。 若要查看生成的客户端代码，请单击“C# 客户端”选项卡：</p>
</li>
</ul>
<pre><code class="lang-csharp">//----------------------
// &lt;auto-generated&gt;
//     Generated using the NSwag toolchain v12.0.9.0 (NJsonSchema v9.13.10.0 (Newtonsoft.Json v11.0.0.0)) (http://NSwag.org)
// &lt;/auto-generated&gt;
//----------------------

namespace MyNamespace
{
    #pragma warning disable

    [System.CodeDom.Compiler.GeneratedCode(&quot;NSwag&quot;, &quot;12.0.9.0 (NJsonSchema v9.13.10.0 (Newtonsoft.Json v11.0.0.0))&quot;)]
    public partial class TodoClient
    {
        private string _baseUrl = &quot;https://localhost:44354&quot;;
        private System.Net.Http.HttpClient _httpClient;
        private System.Lazy&lt;Newtonsoft.Json.JsonSerializerSettings&gt; _settings;

        public TodoClient(System.Net.Http.HttpClient httpClient)
        {
            _httpClient = httpClient;
            _settings = new System.Lazy&lt;Newtonsoft.Json.JsonSerializerSettings&gt;(() =&gt;
            {
                var settings = new Newtonsoft.Json.JsonSerializerSettings();
                UpdateJsonSerializerSettings(settings);
                return settings;
            });
        }

        public string BaseUrl
        {
            get { return _baseUrl; }
            set { _baseUrl = value; }
        }

        // code omitted for brevity
</code></pre>
<div class="TIP">
<h5>Tip</h5>
<p>C# 客户端代码的生成依据是，“设置”选项卡中的选择。修改设置以执行任务，例如默认命名空间重命名和同步方法生成。</p>
</div>
<ul>
<li>将生成的 C# 代码复制到使用 API 的客户端项目内的文件中。</li>
<li>开始使用 Web API：</li>
</ul>
<pre><code class="lang-csharp"> var todoClient = new TodoClient();

// Gets all to-dos from the API
 var allTodos = await todoClient.GetAllAsync();

 // Create a new TodoItem, and save it via the API.
var createdTodo = await todoClient.CreateAsync(new TodoItem());

// Get a single to-do by ID
var foundTodo = await todoClient.GetByIdAsync(1);
</code></pre>
<h2 id="customize-api-documentation">自定义 API 文档</h2>
<p>Swagger 提供用于记录对象模型以便于使用 Web API 的选项。</p>
<h3 id="api-info-and-description">API 信息和说明</h3>
<p>在 <code>Startup.ConfigureServices</code> 方法中，传递给 <code>AddSwaggerDocument</code> 方法的配置操作会添加诸如作者、许可证和说明的信息：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Swagger UI 显示版本的信息：</p>
<p><img src="web-api-help-pages-using-swagger/_static/custom-info-nswag.png" alt="带有版本信息的 Swagger UI"></p>
<h3 id="xml-comments">XML 注释</h3>
<p>若要启用 XML 注释，请执行以下步骤：</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_visual-studio-mac" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_visual-studio-mac" data-tab="visual-studio-mac" tabindex="-1">Visual Studio for Mac</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_netcore-cli" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_netcore-cli" data-tab="netcore-cli" tabindex="-1">.NET Core CLI</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio" role="tabpanel" data-tab="visual-studio">
<div range="&gt;= aspnetcore-2.0">
<ul>
<li>在“解决方案资源管理器”中右键单击该项目，然后选择“编辑 &lt;project_name&gt;.csproj” 。</li>
<li>手动将突出显示的行添加到 .csproj 文件：</li>
</ul>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></div>
<div range="&lt;= aspnetcore-1.1">
<ul>
<li>右键单击“解决方案资源管理器”中的项目，然后选择“属性”</li>
<li>查看“生成”选项卡的“输出”部分下的“XML 文档文件”框</li>
</ul>
</div>
</section>
<section id="tabpanel_CeZOj-G++Q-1_visual-studio-mac" role="tabpanel" data-tab="visual-studio-mac" aria-hidden="true" hidden="hidden">
<div range="&gt;= aspnetcore-2.0">
<ul>
<li>在 Solution Pad 中，按 control 并单击项目名称。 导航到“工具” &gt; “编辑文件” 。</li>
<li>手动将突出显示的行添加到 .csproj 文件：</li>
</ul>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></div>
<div range="&lt;= aspnetcore-1.1">
<ul>
<li>打开“项目选项”对话框 &gt;“生成”&gt;“编译器”</li>
<li>查看“常规选项”部分下的“生成 xml 文档”框</li>
</ul>
</div>
</section>
<section id="tabpanel_CeZOj-G++Q-1_netcore-cli" role="tabpanel" data-tab="netcore-cli" aria-hidden="true" hidden="hidden">

<p>手动将突出显示的行添加到 .csproj 文件：</p>
<div range="&gt;= aspnetcore-2.0">
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></div>
<div range="&lt;= aspnetcore-1.1">
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></div>
</section>
</div>
<h3 id="data-annotations">数据注释</h3>
<div range="&lt;= aspnetcore-2.0">
<p>由于 NSwag 使用<a href="/dotnet/csharp/programming-guide/concepts/reflection">反射</a>，且建议的 Web API 操作返回类型为 <a href="xref:Microsoft.AspNetCore.Mvc.IActionResult">IActionResult</a>，因此无法推断正在执行的操作和返回的内容。</p>
<p>请看下面的示例：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>上述操作返回 <code>IActionResult</code>，但在操作内部返回 <a href="xref:System.Web.Http.ApiController.CreatedAtRoute*">CreatedAtRoute</a> 或 <a href="xref:System.Web.Http.ApiController.BadRequest*">BadRequest</a>。 使用数据注释告知客户端，已知此操作会返回哪些 HTTP 状态代码。 使用以下属性标记该操作：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div></div>
<div range="&gt;= aspnetcore-2.1">
<p>由于 NSwag 使用<a href="/dotnet/csharp/programming-guide/concepts/reflection">反射</a>，且建议的 Web API 操作返回类型为 <a href="xref:Microsoft.AspNetCore.Mvc.ActionResult%601">ActionResult&lt;T&gt;</a>，因此只能推断 <code>T</code> 定义的返回类型。 无法自动推断其他可能的返回类型。</p>
<p>请看下面的示例：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>上述操作将返回 <code>ActionResult&lt;T&gt;</code>。 在操作中，它将返回 <a href="xref:System.Web.Http.ApiController.CreatedAtRoute*">CreatedAtRoute</a>。 由于控制器具有 <a href="xref:Microsoft.AspNetCore.Mvc.ApiControllerAttribute"><code>[ApiController]</code></a> 属性，所以也可能出现 <a href="xref:System.Web.Http.ApiController.BadRequest*">BadRequest</a> 响应。 有关详细信息，请参阅<a class="xref" href="../web-api/index.html#automatic-http-400-responses">自动 HTTP 400 响应</a>。 使用数据注释告知客户端，已知此操作会返回哪些 HTTP 状态代码。 使用以下属性标记该操作：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>在 ASP.NET Core 2.2 或更高版本中，可使用约定，而不是使用 <code>[ProducesResponseType]</code> 显式修饰各操作。 有关详细信息，请参阅 <a class="xref" href="../web-api/advanced/conventions.html">使用 Web API 约定</a>。</p>
</div>
<p>Swagger 生成器现在可准确地描述此操作，且生成的客户端知道调用终结点时收到的内容。 建议使用这些属性来标记所有操作。</p>
<p>有关 API 操作应返回的 HTTP 响应的指导原则，请参阅 <a href="https://tools.ietf.org/html/rfc7231#section-4.3">RFC 7231 规范</a>。</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
