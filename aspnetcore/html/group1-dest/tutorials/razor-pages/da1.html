<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#31532; 5 &#37096;&#20998;&#65292;&#22312; ASP.NET Core &#24212;&#29992;&#20013;&#26356;&#26032;&#29983;&#25104;&#30340;&#39029;&#38754; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#31532; 5 &#37096;&#20998;&#65292;&#22312; ASP.NET Core &#24212;&#29992;&#20013;&#26356;&#26032;&#29983;&#25104;&#30340;&#39029;&#38754; ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="tutorials/razor-pages/da1">
<h1 id="part-5-update-the-generated-pages-in-an-aspnet-core-app">第 5 部分，在 ASP.NET Core 应用中更新生成的页面</h1>

<p>作者：<a href="https://twitter.com/RickAndMSFT">Rick Anderson</a></p>
<div range="&gt;= aspnetcore-3.0">
<p>构架的电影应用有个不错的开始，但是展示效果还不够理想。 ReleaseDate 应是 Release Date（两个词）。</p>
<p><img src="sql/_static/m55.png" alt="在 Chrome 中打开的电影应用程序"></p>
<h2 id="update-the-generated-code">更新生成的代码</h2>
<p>打开 Models/Movie.cs 文件，并添加以下代码中突出显示的行：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>[Column(TypeName = &quot;decimal(18, 2)&quot;)]</code> 数据注释使 Entity Framework Core 可以将 <code>Price</code> 正确映射到数据库中的货币。 有关详细信息，请参阅<a href="/ef/core/modeling/relational/data-types">数据类型</a>。</p>
<p><a href="/aspnet/mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-6">DataAnnotations</a> 未包括在下一个教程中。 <a href="/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.metadata.displaymetadata">Display</a> 特性指定要显示的字段名称的内容（本例中应为“Release Date”，而不是“ReleaseDate”）。 <a href="/dotnet/api/microsoft.aspnetcore.mvc.dataannotations.internal.datatypeattributeadapter">DataType</a> 属性指定数据的类型（日期），使字段中存储的时间信息不会显示。</p>
<p>浏览到 Pages/Movies，并将鼠标悬停在“编辑”链接上以查看目标 URL。</p>
<p><img src="da1/edit7.png" alt="鼠标悬停在“编辑”链接上的浏览器窗口，显示了 http://localhost:1234/Movies/Edit/5 的链接 URL"></p>
<p>“编辑”、“详细信息”和“删除”链接是在 Pages/Movies/Index.cshtml 文件中由<a class="xref" href="../../mvc/views/tag-helpers/built-in/anchor-tag-helper.html">定位标记帮助程序</a>生成的  。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><a class="xref" href="../../mvc/views/tag-helpers/intro.html">标记帮助程序</a>使服务器端代码可以在 Razor 文件中参与创建和呈现 HTML 元素。 在前面的代码中，<code>AnchorTagHelper</code> 从 Razor 页面（路由是相对的）、<code>asp-page</code> 和路由 ID (<code>asp-route-id</code>) 动态生成 HTML <code>href</code> 特性值。 有关详细信息，请参阅<a class="xref" href="../../razor-pages/index.html#url-generation-for-pages">页面的 URL 生成</a>。</p>
<p>在最喜欢的浏览器中使用“查看源”来检查生成的标记。 生成的 HTML 的一部分如下所示：</p>
<pre><code class="lang-html">&lt;td&gt;
  &lt;a href=&quot;/Movies/Edit?id=1&quot;&gt;Edit&lt;/a&gt; |
  &lt;a href=&quot;/Movies/Details?id=1&quot;&gt;Details&lt;/a&gt; |
  &lt;a href=&quot;/Movies/Delete?id=1&quot;&gt;Delete&lt;/a&gt;
&lt;/td&gt;
</code></pre>
<p>动态生成的链接通过查询字符串传递电影 ID（例如，<code>https://localhost:5001/Movies/Details?id=1</code> 中的 <code>?id=1</code>）。</p>
<h3 id="add-route-template">添加路由模板</h3>
<p>更新“编辑”、“详细信息”和“删除”Razor Pages 以使用“{id:int?}”路由模板。 将上述每个页面的页面指令从 <code>@page</code> 更改为 <code>@page &quot;{id:int}&quot;</code>。 运行应用，然后查看源。 生成的 HTML 会将 ID 添加到 URL 的路径部分：</p>
<pre><code class="lang-html">&lt;td&gt;
  &lt;a href=&quot;/Movies/Edit/1&quot;&gt;Edit&lt;/a&gt; |
  &lt;a href=&quot;/Movies/Details/1&quot;&gt;Details&lt;/a&gt; |
  &lt;a href=&quot;/Movies/Delete/1&quot;&gt;Delete&lt;/a&gt;
&lt;/td&gt;
</code></pre>
<p>如果对具有“{id: int}” 路由模板的页面进行的请求中不包含整数，则将返回 HTTP 404（未找到）错误。 例如，<code>http://localhost:5000/Movies/Details</code> 将返回 404 错误。 若要使 ID 可选，请将 <code>?</code> 追加到路由约束：</p>
<pre><code class="lang-cshtml">@page &quot;{id:int?}&quot;
</code></pre>
<p>若要测试 <code>@page &quot;{id:int?}&quot;</code> 的行为：</p>
<ul>
<li>在 Pages/Movies/Details.cshtml 中将 page 指令设置为 <code>@page &quot;{id:int?}&quot;</code>。</li>
<li>在 <code>public async Task&lt;IActionResult&gt; OnGetAsync(int? id)</code> 中（位于 Pages/Movies/Details.cshtml.cs 中）设置断点。</li>
<li>导航到 <code>https://localhost:5001/Movies/Details/</code>。</li>
</ul>
<p>使用 <code>@page &quot;{id:int}&quot;</code> 指令时，永远不会命中断点。 路由引擎返回 HTTP 404。 使用 <code>@page &quot;{id:int?}&quot;</code> 时，<code>OnGetAsync</code> 方法返回 <code>NotFound</code> (HTTP 404)。</p>
<h3 id="review-concurrency-exception-handling">查看并发异常处理</h3>
<p>查看 Pages/Movies/Edit.cshtml.cs 文件中的 <code>OnPostAsync</code> 方法：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>当一个客户端删除电影并且另一个客户端对电影发布更改时，前面的代码会检测并发异常。</p>
<p>测试 <code>catch</code> 块：</p>
<ul>
<li>在 <code>catch (DbUpdateConcurrencyException)</code>上设置断点</li>
<li>对电影选择“编辑”，进行更改，但不要输入“保存”。</li>
<li>在其他浏览器窗口中，选择同一电影的“删除”链接，然后删除此电影。</li>
<li>在之前的浏览器窗口中，将更改发布到电影。</li>
</ul>
<p>生产代码可能要检测并发冲突。 有关详细信息，请参阅<a class="xref" href="../../data/ef-rp/concurrency.html">处理并发冲突</a>。</p>
<h3 id="posting-and-binding-review">发布和绑定审阅</h3>
<p>检查 Pages/Movies/Edit.cshtml.cs 文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>当对 Movies/Edit 页面进行 HTTP GET 请求时（例如 <code>http://localhost:5000/Movies/Edit/2</code>）：</p>
<ul>
<li><code>OnGetAsync</code> 方法从数据库提取电影并返回 <code>Page</code> 方法。</li>
<li><code>Page</code> 方法呈现 Pages/Movies/Edit.cshtml Razor 页面。 Pages/Movies/Edit.cshtml 文件包含模型指令 (<code>@model RazorPagesMovie.Pages.Movies.EditModel</code>)，这使电影模型在页面上可用。</li>
<li>“编辑”表单中会显示电影的值。</li>
</ul>
<p>当发布 Movies/Edit 页面时：</p>
<ul>
<li><p>此页面上的表单值将绑定到 <code>Movie</code> 属性。 <code>[BindProperty]</code> 特性会启用<a class="xref" href="../../mvc/models/model-binding.html">模型绑定</a>。</p>
<pre><code class="lang-csharp">[BindProperty]
public Movie Movie { get; set; }
</code></pre>
</li>
<li><p>如果模型状态中存在错误（例如，<code>ReleaseDate</code> 无法被转换为日期），则会使用已提交的值重新显示表单。</p>
</li>
<li><p>如果没有模型错误，则电影已保存。</p>
</li>
</ul>
<p>“索引”、“创建”和“删除”Razor 页面中的 HTTP GET 方法遵循一个类似的模式。 “创建”Razor 页面中的 HTTP POST <code>OnPostAsync</code> 方法遵循的模式类似于“编辑”Razor 页面中的 <code>OnPostAsync</code> 方法所遵循的模式。</p>
<h2 id="additional-resources">其他资源</h2>
<div class="step-by-step">
<p><a class="xref" href="sql.html">上一篇：使用数据库</a>
<a class="xref" href="search.html">下一篇：添加搜索</a></p>
</div>
</div>
<div range="&lt; aspnetcore-3.0">
<p>构架的电影应用有个不错的开始，但是展示效果还不够理想。 ReleaseDate 应是 Release Date（两个词）。</p>
<p><img src="sql/_static/m55.png" alt="在 Chrome 中打开的电影应用程序"></p>
<h2 id="update-the-generated-code">更新生成的代码</h2>
<p>打开 Models/Movie.cs 文件，并添加以下代码中突出显示的行：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><code>[Column(TypeName = &quot;decimal(18, 2)&quot;)]</code> 数据注释使 Entity Framework Core 可以将 <code>Price</code> 正确映射到数据库中的货币。 有关详细信息，请参阅<a href="/ef/core/modeling/relational/data-types">数据类型</a>。</p>
<p><a href="/aspnet/mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-6">DataAnnotations</a> 未包括在下一个教程中。 <a href="/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.metadata.displaymetadata">Display</a> 特性指定要显示的字段名称的内容（本例中应为“Release Date”，而不是“ReleaseDate”）。 <a href="/dotnet/api/microsoft.aspnetcore.mvc.dataannotations.internal.datatypeattributeadapter">DataType</a> 属性指定数据的类型（日期），使字段中存储的时间信息不会显示。</p>
<p>浏览到 Pages/Movies，并将鼠标悬停在“编辑”链接上以查看目标 URL。</p>
<p><img src="da1/edit7.png" alt="鼠标悬停在“编辑”链接上的浏览器窗口，显示了 http://localhost:1234/Movies/Edit/5 的链接 URL"></p>
<p>“编辑”、“详细信息”和“删除”链接是在 Pages/Movies/Index.cshtml 文件中由<a class="xref" href="../../mvc/views/tag-helpers/built-in/anchor-tag-helper.html">定位标记帮助程序</a>生成的  。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p><a class="xref" href="../../mvc/views/tag-helpers/intro.html">标记帮助程序</a>使服务器端代码可以在 Razor 文件中参与创建和呈现 HTML 元素。 在前面的代码中，<code>AnchorTagHelper</code> 从 Razor 页面（路由是相对的）、<code>asp-page</code> 和路由 ID (<code>asp-route-id</code>) 动态生成 HTML <code>href</code> 特性值。 有关详细信息，请参阅<a class="xref" href="../../razor-pages/index.html#url-generation-for-pages">页面的 URL 生成</a>。</p>
<p>在最喜欢的浏览器中使用“查看源”来检查生成的标记。 生成的 HTML 的一部分如下所示：</p>
<pre><code class="lang-html">&lt;td&gt;
  &lt;a href=&quot;/Movies/Edit?id=1&quot;&gt;Edit&lt;/a&gt; |
  &lt;a href=&quot;/Movies/Details?id=1&quot;&gt;Details&lt;/a&gt; |
  &lt;a href=&quot;/Movies/Delete?id=1&quot;&gt;Delete&lt;/a&gt;
&lt;/td&gt;
</code></pre>
<p>动态生成的链接通过查询字符串传递电影 ID（例如，<code>https://localhost:5001/Movies/Details?id=1</code> 中的 <code>?id=1</code>）。</p>
<p>更新“编辑”、“详细信息”和“删除”Razor Pages 以使用“{id:int?}”路由模板。 将上述每个页面的页面指令从 <code>@page</code> 更改为 <code>@page &quot;{id:int}&quot;</code>。 运行应用，然后查看源。 生成的 HTML 会将 ID 添加到 URL 的路径部分：</p>
<pre><code class="lang-html">&lt;td&gt;
  &lt;a href=&quot;/Movies/Edit/1&quot;&gt;Edit&lt;/a&gt; |
  &lt;a href=&quot;/Movies/Details/1&quot;&gt;Details&lt;/a&gt; |
  &lt;a href=&quot;/Movies/Delete/1&quot;&gt;Delete&lt;/a&gt;
&lt;/td&gt;
</code></pre>
<p>如果对具有“{id: int}” 路由模板的页面进行的请求中不包含整数，则将返回 HTTP 404（未找到）错误。 例如，<code>http://localhost:5000/Movies/Details</code> 将返回 404 错误。 若要使 ID 可选，请将 <code>?</code> 追加到路由约束：</p>
<pre><code class="lang-cshtml">@page &quot;{id:int?}&quot;
</code></pre>
<p>若要测试 <code>@page &quot;{id:int?}&quot;</code> 的行为：</p>
<ul>
<li>在 Pages/Movies/Details.cshtml 中将 page 指令设置为 <code>@page &quot;{id:int?}&quot;</code>。</li>
<li>在 <code>public async Task&lt;IActionResult&gt; OnGetAsync(int? id)</code> 中（位于 Pages/Movies/Details.cshtml.cs 中）设置断点。</li>
<li>导航到 <code>https://localhost:5001/Movies/Details/</code>。</li>
</ul>
<p>使用 <code>@page &quot;{id:int}&quot;</code> 指令时，永远不会命中断点。 路由引擎返回 HTTP 404。 使用 <code>@page &quot;{id:int?}&quot;</code> 时，<code>OnGetAsync</code> 方法返回 <code>NotFound</code> (HTTP 404)。</p>
<h3 id="review-concurrency-exception-handling">查看并发异常处理</h3>
<p>查看 Pages/Movies/Edit.cshtml.cs 文件中的 <code>OnPostAsync</code> 方法：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>当一个客户端删除电影并且另一个客户端对电影发布更改时，前面的代码会检测并发异常。</p>
<p>测试 <code>catch</code> 块：</p>
<ul>
<li>在 <code>catch (DbUpdateConcurrencyException)</code>上设置断点</li>
<li>对电影选择“编辑”，进行更改，但不要输入“保存”。</li>
<li>在其他浏览器窗口中，选择同一电影的“删除”链接，然后删除此电影。</li>
<li>在之前的浏览器窗口中，将更改发布到电影。</li>
</ul>
<p>生产代码可能要检测并发冲突。 有关详细信息，请参阅<a class="xref" href="../../data/ef-rp/concurrency.html">处理并发冲突</a>。</p>
<h3 id="posting-and-binding-review">发布和绑定审阅</h3>
<p>检查 Pages/Movies/Edit.cshtml.cs 文件：</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>当对 Movies/Edit 页面进行 HTTP GET 请求时（例如 <code>http://localhost:5000/Movies/Edit/2</code>）：</p>
<ul>
<li><code>OnGetAsync</code> 方法从数据库提取电影并返回 <code>Page</code> 方法。</li>
<li><code>Page</code> 方法呈现 Pages/Movies/Edit.cshtml Razor 页面。 Pages/Movies/Edit.cshtml 文件包含模型指令 (<code>@model RazorPagesMovie.Pages.Movies.EditModel</code>)，这使电影模型在页面上可用。</li>
<li>“编辑”表单中会显示电影的值。</li>
</ul>
<p>当发布 Movies/Edit 页面时：</p>
<ul>
<li><p>此页面上的表单值将绑定到 <code>Movie</code> 属性。 <code>[BindProperty]</code> 特性会启用<a class="xref" href="../../mvc/models/model-binding.html">模型绑定</a>。</p>
<pre><code class="lang-csharp">[BindProperty]
public Movie Movie { get; set; }
</code></pre>
</li>
<li><p>如果模型状态中存在错误（例如，<code>ReleaseDate</code> 无法被转换为日期），则会使用已提交的值显示表单。</p>
</li>
<li><p>如果没有模型错误，则电影已保存。</p>
</li>
</ul>
<p>“索引”、“创建”和“删除”Razor 页面中的 HTTP GET 方法遵循一个类似的模式。 “创建”Razor 页面中的 HTTP POST <code>OnPostAsync</code> 方法遵循的模式类似于“编辑”Razor 页面中的 <code>OnPostAsync</code> 方法所遵循的模式。</p>
<p>在下一教程中将添加搜索。</p>
<h2 id="additional-resources">其他资源</h2>
<ul>
<li><a href="https://youtu.be/yLnnleREMtQ">本教程的 YouTube 版本</a></li>
</ul>
<div class="step-by-step">
<p><a class="xref" href="sql.html">上一篇：使用数据库</a>
<a class="xref" href="search.html">下一篇：添加搜索</a></p>
</div>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
